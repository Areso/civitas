/*!
 * City-builder HTML5 engine/game
 *
 * @author sizeof(cat) <sizeofcat AT riseup.net>
 * @version 0.1.3152017
 * @license MIT
 */ "use strict";function get_random(e,t){return Math.floor(Math.random()*(t-e+1))+e}if(Array.prototype.findIndexM=function(e){for(var t=0;t<this.length;t++)if(this[t].handle===e)return t;return!1},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},void 0===city_builder)var city_builder={};city_builder.l=function(e){return void 0!==city_builder.lang[e]&&""!==city_builder.lang[e]?city_builder.lang[e]:e},city_builder.AUTOSTART_MUSIC=!1,city_builder.MAX_CITY_LEVEL=30,city_builder.ASSETS_URL="./",city_builder.YEARLY_INFLUENCE_LOSS=10,city_builder.AVATARS=36,city_builder.TRADES_ADDITION=10,city_builder.TRADES_DISCOUNT=20,city_builder.BLACK_MARKET_DISCOUNT=80,city_builder.TOOLBAR_RESOURCES=["coins","wood","stones","wheat","flour","bread","cattle","meat","iron","weapons"],city_builder.LEVELS=[0,100,500,1e3,2e3,3500,5e3,7e3,1e4,13e3,16e3,2e4,25e3,29e3,35e3,4e4,45e3,5e4,6e4,7e4,8e4,9e4,1e5,12e4,15e4,18e4,2e5,24e4,28e4,35e4,4e5,45e4,5e5,55e4,6e5,65e4,75e4,85e4,9e5,1e6,12e5,14e5,16e5,18e5,2e6,22e5,24e5,26e5,28e5,3e6],city_builder.VERSION="0.1.0",city_builder.DEBUG=!0,city_builder.STORAGE_KEY="city_builder",city_builder.lang={"World Market Trades":"",Imports:"",Exports:"",Mercenaries:"",BlackMarket:"","List goods on Black Market":"",list:"",Amount:"","Total price":"",select:"","Sell those goods":"",sell:"","View info on this mercenary army":"","Buy those goods":"",buy:"","Recruit this mercenary army":"","Below is a list of goods that the other cities in the world are looking to buy. The goods replenish yearly, so plan accordingly.":"","Below is a list of goods that the other cities in the world are looking to sell. The goods replenish yearly, so plan accordingly.":"","Below is a list of mercenary armies that are looking for hire. Mercenaries are available only for raiding and conquest missions, they do not join your city so they will not participate in defense.":"","% of the actual price). The goods will be taken immediately from your warehouses but you will receive the coins next month. Also, you get no prestige from Black Market trades.":"","The Black Market is a way to dump your excess materials when you`re in need of emptying your warehouses, but expect a steep price drop (you get ":"","Background Music":"","City of":"","City Storage":"","Total storage space":"","Total used space":"",Info:"",Army:"",Navy:"",Ruler:"",Climate:"",Personality:"",Nationality:"",Level:"",Prestige:"",Influence:"","Below are the goods this city will be buying this year.":"","Below are the goods this city will be selling this year.":"","City Buildings":"","You already have this building.":"","You already constructed this building.":"",Build:"",Coins:"",Building:"",Description:"",Cost:"",Materials:"",Production:"","Chance of extra materials":"",Storage:"",Taxes:"",Requirements:"","Your City Advisor":"",Diplomacy:"","Current date":"","Your City Advisor recommends you to:":"","Current Army":"","Current Navy":"","You will need to construct a Military Camp or Castle before recruiting soldiers in your city.":"","You will need to construct a Shipyard before being able to construct ships in your city.":"","Your influence on":"","is too low to propose a pact.":"","You will need to construct an Embassy before being able to propose treaties and pacts to other cities.":"","View info about this city.":"","Propose a pact to this city`s ruler.":"","Send goods to this city.":"","Declare war to this city.":"",view:"",pact:"","send goods":"","Send Goods":"","Declare War":"","declare war":"","You have no mercenary armies hired for your city. Go to the World Market Trades and hire one.":"",raid:"",campaign:"",release:"","View info on this mercenary army.":"","Send this mercenary army on a raiding mission. Depending on the success of the mission, they will return with coins and/or resources.":"","Disband this mercenary army? They will be available for hire later when you need them.":"","Send this mercenary arm on a campaign towards a city. Depending on the success of the mission, they will return with prisoniers (future soldiers for your army), coins and/or resources. Winning a campaign will grant you fame and prestige.":"",Recruit:"","Mercenary armies are available to hire for a fixed price, they do not cost additional resources but they are only available for raiding and campaign missions, they do not participate in the defense of your city.":"","Also, keep in mind that once a mercenary army is hired, they are at your disposal until the end of the current year.":"",Attack:"",Defense:"","Close this panel":"","Demolish this building":"","Control (start/pause) production":"","World Map":"",Total:"",soldiers:"",ships:"",Tax:"",Produces:"",Uses:"",Requires:"","Storage Space":"",Costs:"","In-game music control":"","Start Production":"","Stop Production":"",baskets:"","Black Market":"",received:"","coins from the Black Market for selling goods.":""},city_builder.API_VERSION="0.2.0",city_builder.API_ENTRY_POINT="http://localhost/api/",city_builder.API_VERSION_URL=city_builder.API_ENTRY_POINT+city_builder.API_VERSION+"/",city_builder.DIPLOMACY_TRUCE=1,city_builder.DIPLOMACY_WAR=2,city_builder.DIPLOMACY_PACT=3,city_builder.DIPLOMACY_ALLIANCE=4,city_builder.DIPLOMACY_CEASE_FIRE=5,city_builder.NATION_TYPES=["none","phoenician","carthaginian","greek","egyptian","assyrian","roman","thracian","sudanese","spanish","sumerian","chinese","indian","franks","russian"],city_builder.NATION_TYPE_PHOENICIAN=1,city_builder.NATION_TYPE_CARTHAGINIAN=2,city_builder.NATION_TYPE_GREEK=3,city_builder.NATION_TYPE_EGYPTIAN=4,city_builder.NATION_TYPE_ASSYRIAN=5,city_builder.NATION_TYPE_ROMAN=6,city_builder.NATION_TYPE_THRACIAN=7,city_builder.NATION_TYPE_SUDANESE=8,city_builder.NATION_TYPE_SPANISH=9,city_builder.NATION_TYPE_SUMERIAN=10,city_builder.NATION_TYPE_CHINESE=11,city_builder.NATION_TYPE_INDIAN=12,city_builder.NATION_TYPE_FRANKS=13,city_builder.NATION_TYPE_RUSSIAN=14,city_builder.CLIMATE_TYPES=["none","temperate","tropical","arid","continental","polar"],city_builder.CLIMATE_TYPE_TEMPERATE=1,city_builder.CLIMATE_TYPE_TROPICAL=2,city_builder.CLIMATE_TYPE_ARID=3,city_builder.CLIMATE_TYPE_CONTINENTAL=4,city_builder.CLIMATE_TYPE_POLAR=5,city_builder.CITY_LOCATION_TEMPERATE={x:530,y:300},city_builder.CITY_LOCATION_TROPICAL={x:45,y:400},city_builder.CITY_LOCATION_ARID={x:340,y:380},city_builder.CITY_LOCATION_CONTINENTAL={x:540,y:300},city_builder.CITY_LOCATION_POLAR={x:490,y:30},city_builder.PERSONALITY_TYPES=["none","balanced","diplomat","warlord"],city_builder.PERSONALITY_TYPE_BALANCED=1,city_builder.PERSONALITY_TYPE_DIPLOMAT=2,city_builder.PERSONALITY_TYPE_WARLORD=3,city_builder.SOLDIER_TYPES={Militia:{id:city_builder.SOLDIER_TYPE_MILITIA,attack:2,defense:1,cost:{coins:100,bread:1,meat:1,weapons:1}},Axeman:{id:city_builder.SOLDIER_TYPE_AXEMAN,attack:3,defense:2,cost:{coins:300,bread:1,meat:1,weapons:2}},Bowman:{id:city_builder.SOLDIER_TYPE_BOWMAN,attack:6,defense:1,cost:{coins:500,bread:1,meat:1,weapons:4}},Pikeman:{id:city_builder.SOLDIER_TYPE_PIKEMAN,attack:5,defense:4,cost:{coins:700,bread:1,meat:1,beer:1,iron:1,leather:1,weapons:5}},Crossbowman:{id:city_builder.SOLDIER_TYPE_CROSSBOWMAN,attack:7,defense:2,cost:{coins:1e3,bread:1,meat:1,beer:1,clothes:1,iron:1,weapons:7}},Knight:{id:city_builder.SOLDIER_TYPE_KNIGHT,attack:6,defense:9,cost:{coins:1500,bread:1,meat:1,wine:1,clothes:1,iron:1,weapons:9}}},city_builder.SOLDIER_TYPE_MILITIA=0,city_builder.SOLDIER_TYPE_AXEMAN=1,city_builder.SOLDIER_TYPE_KNIGHT=2,city_builder.SOLDIER_TYPE_BOWMAN=3,city_builder.SOLDIER_TYPE_CROSSBOWMAN=4,city_builder.SOLDIER_TYPE_PIKEMAN=5,city_builder.MERCENARIES=[{name:"Legio I Adiutrix",description:"Legio prima Adiutrix (First Auxiliary legion) is a Roman legion.",handle:"legio1",icon:1,army:{Axeman:300,Knight:100,Crossbowman:220,Pikeman:300},cost:12e3},{name:"Legio II Augusta",description:"Legio secunda Augusta (Second Augustan Legion) is a Roman legion.",handle:"legio2",icon:8,army:{Axeman:220,Knight:100,Crossbowman:300,Pikeman:140},cost:13e3},{name:"Legio III Cyrenaica",description:"Legio tertia Cyrenaica (Third Cyrenean legion) is a Roman legion.",handle:"legio3",icon:15,army:{Axeman:280,Crossbowman:500,Pikeman:180},cost:1e4},{name:"Legio IV Flavia Felix",description:"Legio quarta Flavia Felix (Fourth Lucky Flavian Legion) is a Roman legion.",handle:"legio4",icon:9,army:{Militia:140,Axeman:190,Knight:90,Bowman:120,Crossbowman:200,Pikeman:180},cost:19e3},{name:"Legio V Alaudae",description:"Legio quinta Alaudae (Fifth Larks Legion) is a Roman legion.",handle:"legio5",icon:16,army:{Militia:400,Axeman:200,Bowman:190},cost:11e3},{name:"Legio VI Victrix",description:"Legio sexta Victrix (Sixth Victorious Legion) is a Roman legion.",handle:"legio6",icon:22,army:{Militia:330,Axeman:230,Knight:100,Bowman:200},cost:14e3},{name:"Varangian Guard",description:"The Varangian Guard is an elite unit of the Byzantine Army.",handle:"varangian",icon:18,army:{Militia:410,Axeman:210,Bowman:190,Crossbowman:100,Pikeman:220},cost:12e3},{name:"Magna Societas Catalanorum",description:"The Catalan Company of the East, officially the Magna Societas Catalanorum is a company of mercenaries founded by Roger de Flor.",handle:"catalan",icon:23,army:{Axeman:310,Knight:120,Bowman:210,Pikeman:310},cost:1e4}],city_builder.SHIP_TYPES={Corsair:{id:city_builder.SHIP_TYPE_CORSAIR,attack:5,defense:5,cost:{coins:1e3,wood:200,leather:50,iron:50,bread:50,meat:50,wine:20,clothes:50,ropes:10,cannons:5}},Caravel:{id:city_builder.SHIP_TYPE_CARAVEL,attack:10,defense:10,cost:{coins:3e3,wood:400,leather:60,iron:80,bread:60,meat:60,wine:30,clothes:60,ropes:30,cannons:20,weapons:10}},Warship:{id:city_builder.SHIP_TYPE_WARSHIP,attack:35,defense:30,cost:{coins:1e4,wood:1e3,leather:200,iron:500,bread:200,meat:200,wine:200,clothes:200,ropes:100,cannons:50,weapons:20,carpets:10}}},city_builder.SHIP_TYPE_CORSAIR=0,city_builder.SHIP_TYPE_CARAVEL=1,city_builder.SHIP_TYPE_WARSHIP=2,city_builder.BUILDINGS_TROPICAL=["marketplace","warehouse","tradingpost","church","monastery","camp","castle","shipyard","embassy","house1","house2","house3","house4","house5","house6","house7","house8","house9","mill","bakery","butcher","coppermine","ironmine","saltmine","goldsmelter","coppersmelter","ironsmelter","lumberjack","stone","trapper","tannery","furrier","armory","coffeeroaster","quartzfactory","winery","saltworks","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","apiary","barrelcooperage","brewery","candlemakersworkshop","sugarmill","perfumery","weaver","almondsfarm","almondsfield","cattlefarm","cattlefield","coffeefarm","coffeefield","grainfarm","grainfield","grapesfarm","grapesfield","hempfarm","hempfield","pigfarm","pigfield","sugarfarm","sugarfield","indigofarm"],city_builder.CITY_BUILDINGS_POLAR=["marketplace","warehouse","tradingpost","church","monastery","camp","castle","shipyard","embassy","house1","house2","house3","house4","house5","house6","house7","mill","bakery","butcher","coppermine","goldmine","ironmine","goldsmelter","coppersmelter","ironsmelter","lumberjack","stone","trapper","tannery","furrier","armory","coffeeroaster","quartzfactory","winery","saltworks","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","apiary","barrelcooperage","brewery","candlemakersworkshop","sugarmill","perfumery","weaver"],city_builder.CITY_BUILDINGS_ARID=["marketplace","warehouse","tradingpost","church","monastery","camp","castle","shipyard","embassy","house1","house2","house3","house4","house5","house6","house7","mill","bakery","butcher","coppermine","goldmine","ironmine","saltmine","goldsmelter","coppersmelter","ironsmelter","lumberjack","stone","trapper","tannery","furrier","armory","coffeeroaster","quartzfactory","winery","saltworks","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","apiary","barrelcooperage","brewery","candlemakersworkshop","sugarmill","perfumery","weaver","cattlefarm","cattlefield","pigfarm","pigfield"],city_builder.CITY_BUILDINGS_CONTINENTAL=["marketplace","warehouse","tradingpost","church","monastery","camp","castle","shipyard","embassy","house1","house2","house3","house4","house5","house6","house7","house8","house9","mill","bakery","butcher","coppermine","goldmine","ironmine","saltmine","goldsmelter","coppersmelter","ironsmelter","lumberjack","stone","trapper","tannery","furrier","armory","coffeeroaster","quartzfactory","winery","saltworks","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","apiary","barrelcooperage","brewery","candlemakersworkshop","sugarmill","perfumery","weaver","cattlefarm","cattlefield","ciderfarm","ciderfield","grainfarm","grainfield","grapesfarm","grapesfield","hempfarm","hempfield","pigfarm","pigfield","silkfarm","silkfield","rosenursery"],city_builder.CITY_BUILDINGS_TEMPERATE=["marketplace","warehouse","tradingpost","church","monastery","camp","castle","shipyard","embassy","house1","house2","house3","house4","house5","house6","house7","house8","house9","mill","bakery","butcher","coppermine","goldmine","ironmine","saltmine","goldsmelter","coppersmelter","ironsmelter","lumberjack","stone","trapper","tannery","furrier","armory","coffeeroaster","quartzfactory","winery","saltworks","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","apiary","barrelcooperage","brewery","candlemakersworkshop","sugarmill","perfumery","weaver","cattlefarm","cattlefield","ciderfarm","ciderfield","grainfarm","grainfield","grapesfarm","grapesfield","hempfarm","hempfield","pigfarm","pigfield","indigofarm"],city_builder.BUILDINGS_START=["marketplace","lumberjack","stone","house1","house2"],city_builder.BUILDINGS_ALL=["marketplace","lumberjack","camp","warehouse","mill","castle","stone","ironmine","trapper","almondsfarm","almondsfield","shipyard","pigfarm","cattlefarm","pigfield","cattlefield","house1","house2","house3","house4","house5","house6","house7","house8","house9","church","bakery","butcher","grainfarm","grainfield","ironsmelter","tannery","furrier","saltmine","coppermine","goldmine","goldsmelter","coppersmelter","armory","coffeefarm","coffeefield","hempfarm","hempfield","sugarfarm","sugarfield","silkfarm","silkfield","coffeeroaster","quartzfactory","grapesfarm","grapesfield","winery","saltworks","charcoalburnerhut","monastery","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","apiary","barrelcooperage","brewery","candlemakersworkshop","indigofarm","ciderfarm","ciderfield","sugarmill","rosenursery","perfumery","tradingpost","weaver","embassy"],city_builder.BUILDINGS_CATEGORIES={Municipal:["church","embassy","marketplace","monastery","shipyard","tradingpost","warehouse"],Housing:["house1","house2","house3","house4","house5","house6","house7","house8","house9"],Food:["bakery","butcher","mill"],Mines:["coppermine","goldmine","ironmine","saltmine"],Farms:["almondsfarm","almondsfield","cattlefarm","cattlefield","ciderfarm","ciderfield","coffeefarm","coffeefield","grainfarm","grainfield","grapesfarm","grapesfield","hempfarm","hempfield","indigofarm","pigfarm","pigfield","silkfarm","silkfield","sugarfarm","sugarfield"],Industry:["apiary","armory","barrelcooperage","brewery","candlemakersworkshop","charcoalburnerhut","coffeeroaster","coppersmelter","furrier","glassworks","goldsmelter","ironsmelter","lumberjack","opticiansworkshop","papermill","perfumery","printingpress","quartzfactory","redsmithsworkshop","ropeyard","rosenursery","saltworks","stone","sugarmill","trapper","tannery","weaver","winery"],Military:["camp","castle"]},city_builder.BUILDINGS=[{name:"Marketplace",handle:"marketplace",description:"The marketplace is the main building of your city and provides a place for the inhabitants of your settlement to gather. It cannot be demolished.",storage:1e5,upgrades:4,visible_upgrades:!0,production:{fame:10},cost:{coins:1e5},position:{x:709,y:515},requires:{city_level:1}},{name:"Warehouse",handle:"warehouse",description:"The warehouse is a trade building that provides market carts that pick up goods from production buildings. A warehouse also adds extra storage space for the materials in your city.",storage:1e5,upgrades:3,visible_upgrades:!0,position:{x:1162,y:365},cost:{coins:5e3,wood:50,stones:50},requires:{city_level:10}},{name:"Church",handle:"church",description:"A church provides a massive fame boost to your settlement by using coins and converting them to fame.",is_municipal:!0,is_production:!0,production:{fame:50},materials:{coins:50},visible_upgrades:!0,position:{x:560,y:428},upgrades:3,cost:{coins:1e4,wood:10,stones:10},requires:{city_level:3}},{name:"Trading Post",handle:"tradingpost",description:"The Trading Post allows you to trade resources with other cities.",is_municipal:!0,position:{x:1740,y:330},upgrades:3,cost:{coins:3e3,wood:40,stones:40},requires:{city_level:6}},{name:"Embassy",handle:"embassy",description:"An Embassy is required to propose pacts, declare war, send goods to other cities.",is_municipal:!0,production:{fame:20},materials:{coins:20},position:{x:680,y:400},upgrades:3,cost:{coins:5e3,wood:100,stones:100},requires:{city_level:10}},{name:"Monastery",handle:"monastery",description:"Monastery provides fame for your city in exchange for coins.",is_municipal:!0,is_production:!0,production:{fame:20},materials:{coins:20},position:{x:680,y:400},upgrades:3,cost:{coins:5e3,wood:100,stones:100},requires:{city_level:16}},{name:"Shipyard",handle:"shipyard",description:"The shipyard helps you expand your settlement overseas by providing you with ships and an ultra-small chance to gather pearls.",is_production:!0,position:{x:1746,y:552},upgrades:3,chance:{pearls:.05},cost:{coins:1e4,wood:100,stones:100},production:{fish:4},requires:{city_level:10}},{name:"Military Camp",handle:"camp",description:"The military camp is your main base of defense and attack until you can develop a Castle.",upgrades:3,position:{x:1461,y:153},cost:{coins:5e3,wood:200,stones:160},requires:{city_level:6}},{name:"Castle",handle:"castle",description:"The castle is your main base of operations. It provides your city with soldiers and some extra fame.",is_production:!0,production:{fame:100},upgrades:2,visible_upgrades:!0,position:{x:982,y:77},materials:{coins:20},cost:{coins:2e5,wood:500,stones:500},requires:{city_level:20}},{name:"Lumberjack",handle:"lumberjack",description:"A lumberjack provides you with wood which you can use for creating additional buildings or sell.",is_production:!0,production:{wood:3},upgrades:3,position:{x:129,y:755},cost:{coins:2e3,stones:20},requires:{city_level:1}},{name:"Stone Quarry",handle:"stone",description:"Stone quarries produce stone blocks that are the basis of any buildings you wish to construct.",is_production:!0,production:{stones:1,clay:1},position:{x:469,y:243},upgrades:3,cost:{coins:2e3,wood:20},requires:{city_level:1}},{name:"Gold Mine",handle:"goldmine",description:"The gold mine extracts gold ores from the mountains you own (provided you own some).",is_production:!0,production:{goldores:4,clay:1},position:{x:342,y:253},upgrades:3,chance:{gems:.01},cost:{coins:3e3,wood:20,stones:20},requires:{city_level:6}},{name:"Iron Mine",handle:"ironmine",description:"The iron mine extracts iron ores from the mountains you own (provided you own some).",is_production:!0,production:{ironores:4,clay:1},position:{x:640,y:182},upgrades:3,chance:{gems:.01},cost:{coins:2e3,wood:20,stones:20},requires:{city_level:3}},{name:"Salt Mine",handle:"saltmine",description:"A salt mine extracts brine that can be processed further into salt in a Salt Works.",is_production:!0,production:{brine:1,clay:1},position:{x:172,y:258},upgrades:3,cost:{coins:1e3,wood:20,stones:20},requires:{city_level:3}},{name:"Copper Mine",handle:"coppermine",description:"The copper mine extracts copper from the mountains you own (provided you own some).",is_production:!0,production:{copper:4,clay:1},position:{x:732,y:133},upgrades:3,chance:{gems:.01},cost:{coins:2e3,wood:20,stones:20},requires:{city_level:5}},{name:"Salt Works",handle:"saltworks",description:"Salt Works requires coal and brine, and it produces salt. Salt is used for leather jerkins by the tannery, meat by the butcher`s shop and fur coats by the furrier`s workshop.",is_production:!0,production:{salt:4},materials:{coal:2,brine:2},position:{x:1234,y:418},upgrades:3,cost:{coins:3e3,wood:20,stones:20},requires:{city_level:3}},{name:"Mill",handle:"mill",description:"The Mill produces flour from the wheat cultivated by your farm(s).",is_production:!0,production:{flour:4},materials:{wheat:2},position:{x:1234,y:418},upgrades:3,cost:{coins:4e3,wood:20,stones:20},requires:{city_level:3}},{name:"Bakery",handle:"bakery",description:"The Bakery creates bread from flour, thus providing your settlers with basic food.",is_production:!0,production:{bread:5},materials:{flour:3},position:{x:1003,y:223},upgrades:3,cost:{coins:5e3,wood:30,stones:30},requires:{city_level:3}},{name:"Armory",handle:"armory",description:"The Armory is a major building that produces weapons. If you want to conquer others, you will need one.",is_production:!0,production:{weapons:1},materials:{iron:2,leather:1,brass:1},position:{x:863,y:131},upgrades:3,cost:{coins:6e3,wood:100,stones:100},requires:{city_level:6}},{name:"Butcher",handle:"butcher",description:"The butcher slaughters cattle for meat, providing food that is more nutritious. Hides will be processed at the Tannery.",is_production:!0,production:{meat:4,hides:2},materials:{cattle:1,salt:1},position:{x:1082,y:297},upgrades:3,cost:{coins:4e3,wood:40,stones:40},requires:{city_level:3}},{name:"Iron smelter",handle:"ironsmelter",description:"The iron smelter (or foundry) smelts iron ores into iron bars using coal, ready to be transformed into weapons.",is_production:!0,production:{iron:4},materials:{ironores:4,coal:1},position:{x:153,y:381},upgrades:3,cost:{coins:4e3,wood:40,stones:50},requires:{city_level:4}},{name:"Copper smelter",handle:"coppersmelter",description:"The copper smelter smelts copper into brass using coal.",is_production:!0,production:{brass:1},materials:{copper:4,coal:1},position:{x:483,y:327},upgrades:3,cost:{coins:4e3,wood:50,stones:50},requires:{city_level:6}},{name:"Gold smelter",handle:"goldsmelter",description:"The gold smelter transforms gold ores into gold bars using coal.",is_production:!0,production:{gold:1},materials:{goldores:4,coal:1},position:{x:628,y:292},upgrades:3,cost:{coins:4e3,wood:55,stones:55},requires:{city_level:6}},{name:"Trapper`s Lodge",handle:"trapper",description:"The trapper captures wild animals and uses the furs from them.",is_production:!0,production:{furs:4},position:{x:1238,y:131},upgrades:3,cost:{coins:2e3,wood:40,stones:40},requires:{city_level:6}},{name:"Furrier`s Workshop",handle:"furrier",description:"The furrier uses furs from the Trapper`s Lodge mixed with salt and processes them into fur coats that will help your settlers during the cold winters.",is_production:!0,production:{furcoats:1},materials:{furs:2,salt:2},position:{x:1355,y:496},upgrades:3,cost:{coins:3e3,wood:30,stones:40},requires:{city_level:6}},{name:"Weaver`s Hut",handle:"weaver",description:"The weaver uses hemp to produce linen clothes.",is_production:!0,production:{clothes:1},materials:{hemp:4},position:{x:1355,y:496},upgrades:3,cost:{coins:5e3,wood:40,stones:40},requires:{city_level:6}},{name:"Tannery",handle:"tannery",description:"The tannery produces leather clothes from animal hides.",is_production:!0,production:{leather:2},materials:{hides:2,salt:1},upgrades:3,position:{x:1490,y:552},cost:{coins:3e3,wood:35,stones:40},requires:{city_level:6}},{name:"Coffee roaster",handle:"coffeeroaster",description:"The coffee roaster uses the coffee beans from your Coffee Farm and processes them into coffee.",is_production:!0,production:{coffee:1},materials:{coffeebeans:4},position:{x:905,y:292},upgrades:3,cost:{coins:7e3,wood:80,stones:60},requires:{city_level:16}},{name:"Sugar Mill",handle:"sugarmill",description:"The Sugar Mill creates sugar from sugar cane.",is_production:!0,production:{sugar:1},materials:{sugarcane:4},position:{x:1260,y:740},upgrades:3,cost:{coins:7e3,wood:80,stones:60},requires:{city_level:16}},{name:"Winery",handle:"winery",description:"The Winery uses the grapes from your Grapes Farm and processes them into wine.",is_production:!0,production:{wine:1},materials:{grapes:4,barrels:1},position:{x:1020,y:380},upgrades:3,cost:{coins:5e3,wood:50,stones:40},requires:{city_level:10}},{name:"Optician`s Shop",handle:"opticiansworkshop",description:"The optician uses brass and quartz to create glasses for your settlers.",is_production:!0,production:{glasses:1},materials:{brass:2,quartz:2},position:{x:1160,y:820},upgrades:3,cost:{coins:8100,wood:70,stones:70},requires:{city_level:20}},{name:"Paper Mill",handle:"papermill",description:"The Paper Mill uses wood to produce paper, which is used along with indigo to produce books at the Printing House.",is_production:!0,production:{paper:2},materials:{wood:1},position:{x:1600,y:500},upgrades:3,cost:{coins:8300,wood:60,stones:50},requires:{city_level:16}},{name:"Printing Press",handle:"printingpress",description:"The printing press produces books using paper and indigo.",is_production:!0,production:{books:1},materials:{paper:8,indigo:1},position:{x:1260,y:900},upgrades:3,cost:{coins:8400,wood:100,stones:100},requires:{city_level:20}},{name:"Perfumery",handle:"perfumery",description:"The Perfumery processes the rose oil into perfume to satisfy the needs of your settlers.",is_production:!0,production:{perfume:1},materials:{roses:8},position:{x:920,y:660},upgrades:3,cost:{coins:8200,wood:80,stones:40},requires:{city_level:20}},{name:"Redsmith`s Workshop",handle:"redsmithsworkshop",description:"The Redsmith`s Workshop processes brass and candles into candlesticks.",is_production:!0,production:{candlesticks:1},materials:{brass:3,candles:2},position:{x:1020,y:730},upgrades:3,cost:{coins:7500,wood:70,stones:50},requires:{city_level:20}},{name:"Ropeyard",handle:"ropeyard",description:"The ropeyard produces ropes that are needed for your city`s ships.",is_production:!0,production:{ropes:1},materials:{hemp:1},position:{x:1700,y:700},upgrades:3,cost:{coins:4e3,wood:70,stones:60},requires:{city_level:10}},{name:"Glassworks",handle:"glassworks",description:"The Glassworks processes quartz into glass.",is_production:!0,production:{glass:1},materials:{quartz:2},position:{x:1380,y:340},upgrades:3,cost:{coins:5e3,wood:50,stones:80},requires:{city_level:16}},{name:"Quartz factory",handle:"quartzfactory",description:"The quartz factory provides your city with quartz.",is_production:!0,production:{quartz:3},position:{x:349,y:382},upgrades:3,cost:{coins:4e3,wood:50,stones:90},requires:{city_level:8}},{name:"Apiary",handle:"apiary",description:"The apiary produces bees wax for use in candles.",is_production:!0,production:{wax:3},position:{x:1700,y:340},upgrades:3,cost:{coins:4e3,wood:50,stones:40},requires:{city_level:10}},{name:"Barrel Cooperage",handle:"barrelcooperage",description:"The barrel cooperage creates barrels from wood and iron.",is_production:!0,production:{barrels:2},materials:{wood:3,iron:1},position:{x:1630,y:800},upgrades:3,cost:{coins:4100,wood:80,stones:70},requires:{city_level:9}},{name:"Brewery",handle:"brewery",description:"The Brewery brews beer from wheat. Beer is needed for bigger hourses or ships.",is_production:!0,production:{beer:2},materials:{barrels:1,wheat:2},position:{x:1020,y:600},upgrades:3,cost:{coins:4200,wood:60,stones:70},requires:{city_level:9}},{name:"Candlemaker`s Hut",handle:"candlemakersworkshop",description:"The Candlemaker Hut produces candles for your settlers` houses.",is_production:!0,production:{candles:1},materials:{wax:2,hemp:1},position:{x:770,y:250},upgrades:3,cost:{coins:6400,wood:80,stones:60},requires:{city_level:20}},{name:"Charcoal Burner`s Hut",handle:"charcoalburnerhut",description:"The Charcoal Burner`s Hut burns wood into coal that is needed by all your smelters.",is_production:!0,production:{coal:4},materials:{wood:1},position:{x:1480,y:250},upgrades:3,cost:{coins:5e3,wood:50,stones:50},requires:{city_level:3}},{name:"House",handle:"house1",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:5,cost:{wood:10,coins:1e3},materials:{bread:1},position:{x:790,y:340},upgrades:5,visible_upgrades:!0,requires:{city_level:1}},{name:"House",handle:"house2",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:10,cost:{wood:10,coins:2e3},materials:{bread:1},position:{x:849,y:412},upgrades:5,visible_upgrades:!0,requires:{city_level:1}},{name:"House",handle:"house3",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:15,cost:{wood:10,stones:20,coins:3e3},materials:{bread:1,meat:1},position:{x:945,y:480},upgrades:5,visible_upgrades:!0,requires:{city_level:3}},{name:"House",handle:"house4",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:20,cost:{wood:10,stones:20,coins:4e3},materials:{bread:1,meat:1},position:{x:860,y:552},upgrades:5,visible_upgrades:!0,requires:{city_level:6}},{name:"House",handle:"house5",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:25,cost:{wood:25,stones:35,coins:5e3},materials:{fish:2,meat:2,beer:1},position:{x:764,y:613},upgrades:5,visible_upgrades:!0,requires:{city_level:10}},{name:"House",handle:"house6",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:30,cost:{wood:30,stones:45,coins:6e3},materials:{fish:2,meat:2,wine:1},position:{x:663,y:659},upgrades:5,visible_upgrades:!0,requires:{city_level:16}},{name:"House",handle:"house7",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:35,cost:{wood:40,stones:80,coins:7e3},materials:{fish:2,meat:2,wine:1,candlesticks:1},position:{x:579,y:601},upgrades:5,visible_upgrades:!0,requires:{city_level:20}},{name:"House",handle:"house8",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:40,cost:{wood:50,stones:100,coins:8e3},materials:{fish:2,meat:2,wine:1,candlesticks:1,furcoats:1},position:{x:520,y:530},upgrades:5,visible_upgrades:!0,requires:{city_level:25}},{name:"House",handle:"house9",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:45,cost:{wood:100,stones:200,coins:1e4},materials:{fish:2,meat:2,wine:1,candlesticks:1,furcoats:1,perfume:1},position:{x:447,y:463},upgrades:5,visible_upgrades:!0,requires:{city_level:30}},{name:"Cider Farm",handle:"ciderfarm",description:"The cider farm produces cider, a basic drink for your settlers",is_production:!0,production:{cider:1,herbs:1},position:{x:1500,y:882},upgrades:3,cost:{coins:4e3,wood:50,stones:30},requires:{city_level:4,buildings:"ciderfield"}},{name:"Cider field",handle:"ciderfield",description:"A cider field is required for the cider farm to operate.",position:{x:1400,y:840},cost:{coins:1e3,wood:10,clay:10},requires:{city_level:4}},{name:"Almonds farm",handle:"almondsfarm",is_production:!0,description:"The Almonds Farm cultivates almonds for export.",production:{almonds:1},upgrades:3,position:{x:280,y:569},cost:{coins:8e3,wood:30,stones:30},requires:{city_level:16,buildings:"almondsfield"}},{name:"Almonds field",handle:"almondsfield",description:"An almonds field is required for the almonds farm to operate.",position:{x:205,y:636},cost:{coins:1200,wood:10,clay:10},requires:{city_level:16}},{name:"Cattle Farm",handle:"cattlefarm",description:"A cattle farm grows cattle so your settlers can eat food that is more nutritious than bread.",is_production:!0,production:{cattle:1,milk:1},
upgrades:3,materials:{herbs:2},position:{x:905,y:783},cost:{coins:3e3,wood:20,stones:20},requires:{city_level:2,buildings:"cattlefield"}},{name:"Cattle field",handle:"cattlefield",description:"A cattle field is required for the cattle farm to operate.",position:{x:816,y:838},cost:{coins:800,wood:10,clay:10},requires:{city_level:2}},{name:"Pig Farm",handle:"pigfarm",description:"A pig farm grows pigs so your settlers can eat food that is more nutritious than bread.",is_production:!0,production:{meat:1},upgrades:3,materials:{herbs:2},position:{x:823,y:712},cost:{coins:3e3,wood:20,stones:20},requires:{city_level:3,buildings:"pigfield"}},{name:"Pig field",handle:"pigfield",description:"A pig field is required for the pig farm to operate.",position:{x:730,y:770},cost:{coins:800,wood:10,clay:10},requires:{city_level:3}},{name:"Grain farm",handle:"grainfarm",description:"A grain farm cultivates wheat that will be later transformed into bread, and your settlers will live happily ever after.",is_production:!0,production:{wheat:3,herbs:1},upgrades:3,position:{x:1027,y:859},cost:{coins:2e3,wood:20,stones:20},requires:{city_level:2,buildings:"grainfield"}},{name:"Grain field",handle:"grainfield",description:"A grain field is required for the grain farm to operate.",position:{x:1103,y:915},cost:{coins:500,wood:10,clay:5},requires:{city_level:2}},{name:"Grapes farm",handle:"grapesfarm",description:"A grapes farm provides your city with grapes for wine.",is_production:!0,production:{grapes:2,herbs:1},upgrades:3,position:{x:1200,y:600},cost:{coins:4e3,wood:20,stones:20},requires:{city_level:10,buildings:"grapesfield"}},{name:"Grapes field",handle:"grapesfield",description:"A grapes field is required for the grapes farm to operate.",position:{x:1120,y:670},cost:{coins:1200,wood:10,clay:10},requires:{city_level:10}},{name:"Coffee farm",handle:"coffeefarm",description:"A coffee farm provides your city with coffee beans.",is_production:!0,production:{coffeebeans:2,herbs:1},upgrades:3,position:{x:244,y:466},cost:{coins:6e3,wood:20,stones:20},requires:{city_level:16,buildings:"coffeefield"}},{name:"Coffee field",handle:"coffeefield",description:"A coffee field is required for the coffee farm to operate.",position:{x:181,y:532},cost:{coins:2e3,wood:10,clay:10},requires:{city_level:16}},{name:"Hemp farm",handle:"hempfarm",description:"A hemp farm provides your city with hemp.",is_production:!0,production:{hemp:2,herbs:1},upgrades:3,position:{x:347,y:698},cost:{coins:4e3,wood:20,stones:20},requires:{city_level:6,buildings:"hempfield"}},{name:"Hemp field",handle:"hempfield",description:"A hemp field is required for the hemp farm to operate.",position:{x:281,y:758},cost:{coins:1e3,wood:10,clay:10},requires:{city_level:6}},{name:"Silk farm",handle:"silkfarm",description:"A silk farm provides your city with silk.",is_production:!0,production:{silk:2},upgrades:3,position:{x:456,y:745},cost:{coins:8e3,wood:20,stones:20},requires:{city_level:20,buildings:"silkfield"}},{name:"Silk field",handle:"silkfield",description:"A silk field is required for the silk farm to operate.",position:{x:363,y:819},cost:{coins:1400,wood:10,clay:10},requires:{city_level:20}},{name:"Sugar farm",handle:"sugarfarm",description:"A sugar cane farm provides your city with sugar cane.",is_production:!0,production:{sugarcane:2,herbs:1},upgrades:3,position:{x:536,y:804},cost:{coins:1e4,wood:20,stones:20},requires:{city_level:20,buildings:"sugarfield"}},{name:"Sugar field",handle:"sugarfield",description:"A sugar field is required for the sugar farm to operate.",position:{x:449,y:862},cost:{coins:4e3,wood:10,clay:10},requires:{city_level:20}},{name:"Indigo farm",handle:"indigofarm",is_production:!0,description:"The indigo farm produces indigo that can be used to create books.",production:{indigo:1},upgrades:3,position:{x:260,y:870},cost:{coins:5e3,wood:30,stones:30,clay:30},requires:{city_level:16}},{name:"Rose Nursery",handle:"rosenursery",is_production:!0,description:"The Rose Nursery produces rose oil which is needed to make perfume.",production:{roses:1},upgrades:3,position:{x:440,y:630},cost:{coins:7e3,wood:50,stones:50,clay:50},requires:{city_level:20}},{name:"Spice Farm",handle:"spicefarm",is_production:!0,description:"The Spice Farm is responsable for the production of spices.",production:{spices:1},upgrades:3,position:{x:260,y:870},cost:{coins:1e4,wood:60,stones:60,clay:60},requires:{city_level:20}}],city_builder.CITIES={Byblos:{nationality:city_builder.NATION_TYPE_PHOENICIAN,ruler:"Cronus",avatar:1,climate:city_builder.CLIMATE_TYPE_TEMPERATE,personality:city_builder.PERSONALITY_TYPE_DIPLOMAT,level:25,prestige:700,trades:{imports:{gold:250,milk:500,goldores:100,weapons:80,quartz:90,roses:200,wine:310,clay:280,fish:200},exports:{hemp:200,indigo:100,paper:220,stones:100}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:4,Caravel:2,Warship:6},location:{x:310,y:340}},Carthage:{nationality:city_builder.NATION_TYPE_CARTHAGINIAN,ruler:"Elisa",avatar:21,climate:city_builder.CLIMATE_TYPE_TROPICAL,personality:city_builder.PERSONALITY_TYPE_DIPLOMAT,level:24,prestige:700,trades:{imports:{wax:100,sugar:200,sugarcane:100,glasses:80,fish:200,candles:90,bread:200,pearls:100,salt:50},exports:{leather:200,indigo:100,flour:220,glass:200,coal:100,fish:300,wood:220}},navy:{Corsair:6,Caravel:4,Warship:3},army:{Militia:40,Axeman:50,Knight:10,Bowman:50,Crossbowman:50,Pikeman:40},location:{x:170,y:320}},Kyrene:{nationality:city_builder.NATION_TYPE_GREEK,ruler:"Abdul",avatar:33,climate:city_builder.CLIMATE_TYPE_TROPICAL,personality:city_builder.PERSONALITY_TYPE_WARLORD,level:22,prestige:500,trades:{imports:{flour:100,milk:200,brass:100,furs:100,fish:270,cider:80,silk:200,cattle:210,wheat:300},exports:{clothes:200,fish:100,coffeebeans:220,silk:100}},army:{Militia:90,Axeman:70,Knight:0,Bowman:50,Crossbowman:30,Pikeman:90},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:240,y:360}},"Menat Khufu":{nationality:city_builder.NATION_TYPE_EGYPTIAN,ruler:"Khufu",avatar:34,climate:city_builder.CLIMATE_TYPE_ARID,personality:city_builder.PERSONALITY_TYPE_DIPLOMAT,level:35,prestige:800,trades:{imports:{barrels:110,books:90,paper:100,coal:200,copper:160,indigo:200},exports:{coal:220,ironores:120,copper:140,goldores:120,iron:100,gold:200,brass:100}},army:{Militia:40,Axeman:120,Knight:10,Bowman:120,Crossbowman:30,Pikeman:50},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:290,y:400}},Niniveh:{nationality:city_builder.NATION_TYPE_ASSYRIAN,ruler:"Sennacherib",avatar:30,climate:city_builder.CLIMATE_TYPE_ARID,personality:city_builder.PERSONALITY_TYPE_DIPLOMAT,level:33,prestige:780,trades:{imports:{silk:110,clothes:190,leather:110,meat:130},exports:{gold:120,iron:220,ironores:170,copper:190,coal:120}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:380,y:290}},Novgorod:{nationality:city_builder.NATION_TYPE_RUSSIAN,ruler:"Rurik",avatar:5,climate:city_builder.CLIMATE_TYPE_POLAR,personality:city_builder.PERSONALITY_TYPE_WARLORD,level:20,prestige:200,trades:{imports:{furs:100,hides:120,milk:110,leather:80,fish:400,furcoats:300},exports:{wax:110,candles:100,salt:170}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:330,y:130}},Rome:{nationality:city_builder.NATION_TYPE_ROMAN,ruler:"Caesar",avatar:17,climate:city_builder.CLIMATE_TYPE_TEMPERATE,personality:city_builder.PERSONALITY_TYPE_BALANCED,level:38,prestige:900,trades:{imports:{perfume:120,coffee:110,cider:100,wine:80,beer:90,silk:180},exports:{barrels:200,brine:120,brass:160,candlesticks:100,cattle:210,glass:170,gold:180,wheat:220,iron:100,grapes:300,hemp:380,herbs:600,quartz:220,stones:130}},army:{Militia:40,Axeman:320,Knight:10,Bowman:220,Crossbowman:210,Pikeman:90},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:190,y:290}},Sarmizegetusa:{nationality:city_builder.NATION_TYPE_THRACIAN,ruler:"Deceballus",avatar:8,climate:city_builder.CLIMATE_TYPE_CONTINENTAL,personality:city_builder.PERSONALITY_TYPE_WARLORD,level:18,prestige:160,trades:{imports:{flour:100,bread:110,brass:140,coal:200},exports:{wood:100,stones:200,wine:140}},army:{Militia:90,Axeman:90,Knight:1,Bowman:20,Crossbowman:20,Pikeman:30},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:250,y:270}},Sigiriya:{nationality:city_builder.NATION_TYPE_INDIAN,ruler:"Kashyapa",avatar:9,climate:city_builder.CLIMATE_TYPE_TROPICAL,personality:city_builder.PERSONALITY_TYPE_BALANCED,level:22,prestige:200,trades:{imports:{furs:100,hides:180,milk:110,leather:80},exports:{wax:110,candles:100,salt:170,sugarcane:200}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:2,Caravel:2,Warship:2},location:{x:600,y:490}},"Selima Oasis":{nationality:city_builder.NATION_TYPE_SUDANESE,ruler:"Pepi",avatar:10,climate:city_builder.CLIMATE_TYPE_TROPICAL,personality:city_builder.PERSONALITY_TYPE_WARLORD,level:18,prestige:300,trades:{imports:{cider:100,ropes:80,wax:120,sugar:90,wood:500,stones:300},exports:{almonds:100,roses:220,grapes:100,hemp:100,coffeebeans:120,coffee:90,spices:130}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:300,y:450}},Thebes:{nationality:city_builder.NATION_TYPE_EGYPTIAN,ruler:"Hatshepsut",avatar:36,climate:city_builder.CLIMATE_TYPE_TROPICAL,personality:city_builder.PERSONALITY_TYPE_DIPLOMAT,level:31,prestige:600,trades:{imports:{meat:100,milk:90,weapons:100,roses:130,perfume:90,iron:200,ironores:110},exports:{brine:170,clothes:100,glass:220,wheat:300,hides:70,paper:90}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:320,y:420}},Toledo:{nationality:city_builder.NATION_TYPE_SPANISH,ruler:"Juan Luiz",avatar:12,climate:city_builder.CLIMATE_TYPE_TEMPERATE,personality:city_builder.PERSONALITY_TYPE_BALANCED,level:21,prestige:180,trades:{imports:{meat:100,iron:200,brass:100,cider:80,grapes:90,coal:150,ironores:160},exports:{wine:200,silk:100,wood:140,cattle:120}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:90,y:300}},Tournai:{nationality:city_builder.NATION_TYPE_FRANKS,ruler:"Clovis",avatar:24,climate:city_builder.CLIMATE_TYPE_CONTINENTAL,personality:city_builder.PERSONALITY_TYPE_WARLORD,level:22,prestige:360,trades:{imports:{furs:100,hides:180,milk:110,gems:70,brass:210,wheat:280,clay:300},exports:{wax:110,candles:100,salt:170,pearls:120}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:130,y:230}},Uruk:{nationality:city_builder.NATION_TYPE_SUMERIAN,ruler:"Gilgamesh",avatar:14,climate:city_builder.CLIMATE_TYPE_TROPICAL,personality:city_builder.PERSONALITY_TYPE_WARLORD,level:26,prestige:400,trades:{imports:{wheat:200,wood:200,sugar:100,sugarcane:80,clay:200},exports:{glasses:80,furcoats:130,indigo:120,wheat:100}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:400,y:320}},Yinxu:{nationality:city_builder.NATION_TYPE_CHINESE,ruler:"Wu Ding",avatar:15,climate:city_builder.CLIMATE_TYPE_TEMPERATE,personality:city_builder.PERSONALITY_TYPE_WARLORD,level:22,prestige:420,trades:{imports:{gold:110,goldores:90,weapons:100,salt:130,stones:200,gems:50,pearls:50},exports:{silk:170,glass:220,roses:70,cattle:90,bread:100,meat:130,carpets:80,cannons:100}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:0,Caravel:0,Warship:0},location:{x:760,y:340}}},city_builder.EVENT_EFFECT_DESTROY_BUILDING=0,city_builder.EVENT_EFFECT_LOSE_COINS=1,city_builder.EVENT_EFFECT_GAIN_COINS=2,city_builder.EVENT_EFFECT_RAISE_INFLUENCE=3,city_builder.EVENT_EFFECT_LOWER_INFLUENCE=4,city_builder.EVENT_EFFECT_LOSE_FAME=5,city_builder.EVENT_EFFECT_GAIN_FAME=6,city_builder.EVENTS=[{name:"Great earthquake",handle:"earthquake1",description:"",chance:1e-4,effect:city_builder.EVENT_EFFECT_DESTROY_BUILDING,data:{amount:1}},{name:"Royal marriage",handle:"marriage",description:"A marriage was arranged between a member of your family and the royal family of CITY. This raises your influence on CITY. Good job!",chance:.001,effect:city_builder.EVENT_EFFECT_RAISE_INFLUENCE,data:{amount:50,city:"Rome"}},{name:"Raiders attack",handle:"raiders",description:"A band of raiders attacked the outskirts of your city. Repairing the affected buildings costed AMOUNT coins.",chance:.001,effect:city_builder.EVENT_EFFECT_LOSE_COINS,data:{amount:1e3}},{name:"Discovery",handle:"discovery",description:"The engineers in your city made a great discovery which made your city more famous, thus gaining AMOUNT fame.",chance:.008,effect:city_builder.EVENT_EFFECT_GAIN_FAME,data:{amount:100}}],city_builder.RESOURCES={coins:{name:"Coins",handle:"coins",storage:15e3},fame:{name:"Fame",handle:"fame",total:1,amount:1},almonds:{name:"Almonds",price:200,storage:0},barrels:{name:"Barrels",price:60,storage:0},beer:{name:"Beer",price:30,storage:0},books:{name:"Books",price:120,storage:0},bread:{name:"Bread",price:30,storage:300},brine:{name:"Brine",price:10,storage:0},brass:{name:"Brass",price:60,storage:0},candles:{name:"Candles",price:100,storage:0},candlesticks:{name:"Candlesticks",price:170,storage:0},cannons:{name:"Cannons",price:700,storage:0},carpets:{name:"Carpets",price:400,storage:0},cattle:{name:"Cattle",price:41,storage:0},cider:{name:"Cider",price:42,storage:0},clay:{name:"Clay",price:35,storage:0},clothes:{name:"Clothes",price:104,storage:0},coal:{name:"Coal",price:34,storage:0},coffee:{name:"Coffee",price:240,storage:0},coffeebeans:{name:"Coffee Beans",price:136,storage:0},copper:{name:"Copper",price:43,storage:0},fish:{name:"Fish",price:16,storage:0},flour:{name:"Flour",price:42,storage:0},furcoats:{name:"Fur coats",price:122,storage:0},furs:{name:"Furs",price:78,storage:0},gems:{name:"Gems",price:460,storage:0},glass:{name:"Glass",price:86,storage:0},glasses:{name:"Glasses",price:140,storage:0},gold:{name:"Gold",price:194,storage:0},goldores:{name:"Gold ores",price:90,storage:0},grapes:{name:"Grapes",price:35,storage:0},hemp:{name:"Hemp",price:46,storage:0},herbs:{name:"Herbs",price:18,storage:0},hides:{name:"Hides",price:25,storage:0},indigo:{name:"Indigo",price:80,storage:0},iron:{name:"Iron",price:86,storage:0},ironores:{name:"Iron ores",price:45,storage:0},leather:{name:"Leather",price:60,storage:0},meat:{name:"Meat",price:30,storage:100},milk:{name:"Milk",price:55,storage:0},paper:{name:"Paper",price:70,storage:0},pearls:{name:"Pearls",price:450,storage:0},perfume:{name:"Perfume",price:305,storage:0},quartz:{name:"Quartz",price:26,storage:0},ropes:{name:"Ropes",price:42,storage:0},roses:{name:"Roses",price:70,storage:0},salt:{name:"Salt",price:20,storage:0},silk:{name:"Silk",price:320,storage:0},spices:{name:"Spices",price:285,storage:0},stones:{name:"Stones",price:16,storage:100},sugar:{name:"Sugar",price:145,storage:0},sugarcane:{name:"Sugarcane",price:120,storage:0},wax:{name:"Wax",price:40,storage:0},weapons:{name:"Weapons",price:205,storage:100},wheat:{name:"Wheat",price:25,storage:40},wine:{name:"Wine",price:95,storage:0},wood:{name:"Wood",price:17,storage:100}},city_builder.utils={calc_price_minus_discount:function(e,t,i){return Math.round(e*(city_builder.RESOURCES[t].price-i))},calc_price_plus_discount:function(e,t,i){return Math.round(e*(city_builder.RESOURCES[t].price+i))},get_now:function(){var e=new Date;return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}},city_builder.api=function(e){return this.core=null,this.version="0.2.0",this.login=function(e){return this.request({url:"login",data:e})},this.get_version=function(){return this.version},this.logout=function(){return this.request({url:"logout"})},this.api_version=function(){return this.request({url:"version"})},this.city_info=function(){return this.request({url:"city"})},this.heartbeat=function(){return this.request({url:"heartbeat"})},this.register=function(e){return this.request({url:"register",data:e})},this.do_export=function(e){return this.request({url:"export",data:e})},this.do_import=function(e){return this.request({url:"import",data:e})},this._request=function(e){return $.ajax({type:void 0!==e.requestType?e.requestType:"POST",dataType:void 0!==e.dataType?e.dataType:"jsonp",xhrFields:{withCredentials:void 0===e.auth||e.auth===!0},crossDomain:!0,data:e.data,url:city_builder.API_VERSION_URL+e.url,async:void 0===e.async||1==e.async,success:e.success instanceof Function?e.success:function(){},error:e.error instanceof Function?e.error:function(){}}),this},this.__constructor=function(e){return this.core=e.core,this},this.__constructor(e)},city_builder.jailer=function(e){return this.core=null,this.version="0.2.0",this.__constructor=function(e){return this.core=e.core,this},this.get_version=function(){return this.version},this.check=function(){return!0},this.__constructor(e)},city_builder.ui={building_panel_template:'<div id="panel-{id}" class="panel pb black"><header><span class="title"></span><a class="tips close btn" title="'+city_builder.l("Close this panel")+'"></a><a class="tips demolish btn" title="'+city_builder.l("Demolish this building")+'"></a><a class="tips pause start btn" title="'+city_builder.l("Control (start/pause) production")+'"></a></header><div class="contents"></div><foooter></footer></div>',worldmap_panel_template:'<div id="panel-{id}" class="panel"><header><span class="title">'+city_builder.l("World Map")+'</span><a class="tips btn close" title="'+city_builder.l("Close this panel")+'"></a></header><div class="contents"><div class="worldmap"></div></div></div>',generic_panel_template:'<div id="panel-{id}" class="panel"><header><span class="title">{title}</span><a class="tips btn close" title="'+city_builder.l("Close this panel")+'"></a></header><div class="contents"></div></div>',normal_panel:function(e,t){return"<fieldset><legend>"+e+"</legend>"+t+"</fieldset>"},cost_panel:function(e){var t="";if(void 0!==e){t+="<dt>Cost</dt>";for(var i in e)t+="<dd>"+e[i]+city_builder.ui.resource_small_img(i)+"</dd>"}return t},city_worldmap_element:function(e){return'<div data-name="'+e+'" class="tips city" title="'+city_builder.l("City of")+" "+e+'" style="left:'+city_builder.CITIES[e].location.x+"px;top:"+city_builder.CITIES[e].location.y+'px"></div>'},army_img:function(e){return'<img class="tips" title="'+e+'" src="'+city_builder.ASSETS_URL+"images/armies/"+e.toLowerCase()+'_small.png" />'},army_list:function(e,t){var i="<dl"+(void 0!==t&&t===!0?' class="nomg"':"")+">",r=0;for(var s in e.army)i+="<dt>"+e.army[s]+"</dt><dd>"+city_builder.ui.army_img(s)+"</dd>",r+=e.army[s];return i+="<dt>"+city_builder.l("Total")+"</dt><dd>"+(void 0!==e.total?e.total:r)+" "+city_builder.l("soldiers")+".</dd></dl>"},panel_exists:function(e){return 0!=$(e).length},panel_btn:function(e,t,i,r,s){return'<a title="'+t+'" data-handle="'+i+'" class="tips '+r+(s===!0?" disabled":"")+'" href="#">'+e+"</a></td>"},trades_list:function(e,t){t=void 0===t||"imports"===t?"imports":"exports";var i="";if(null!==e){i+="<dl>";var r=e[t];for(var s in r)i+="<dt>"+r[s]+"</dt><dd>"+city_builder.ui.resource_small_img(s)+"</dd>";i+="</dl>"}return i},navy_list:function(e,t){var i="<dl"+(void 0!==t&&t===!0?' class="nomg"':"")+">";for(var r in e.navy)i+="<dt>"+e.navy[r]+"</dt><dd>"+city_builder.ui.army_img(r)+"</dd>";return i+="<dt>"+city_builder.l("Total")+"</dt><dd>"+e.total+" "+city_builder.l("ships")+".</dd></dl>"},building_element:function(e){var t='<br /><span class="smalldesc">'+e.data.description+"</span>",i=void 0===e.data.visible_upgrades||e.data.visible_upgrades===!1?e.type+"1":e.type+e.data.level;return'<div data-type="'+e.type+'" data-level="'+e.data.level+'" style="background:transparent url('+city_builder.ASSETS_URL+"images/buildings/"+i+".png) no-repeat;left:"+e.data.position.x+"px;top:"+e.data.position.y+'px" title=\'<span class="buildinginfo">'+e.data.name+"</span> "+t+"' id=\"building-"+e.data.handle+'"class="tips slots building"></div>'},resource_storage_el:function(e,t){return'<div class="storage-item item-'+e+'"><span class="title">'+city_builder.RESOURCES[e].name+'</span><img src="'+city_builder.ASSETS_URL+"images/resources/"+e+'.png" /><span class="amount">'+t+"</amount></div>"},tabs:function(e){for(var t='<div class="tabs"><ul>',i=0;i<e.length;i++)t+='<li><a href="#tab-'+e[i].toLowerCase()+'">'+e[i]+"</a></li>";t+="</ul>";for(var i=0;i<e.length;i++)t+='<div id="tab-'+e[i].toLowerCase()+'"></div>';return t+="</div>"},materials_panel:function(e){var t="";if(void 0!==e){t+="<dt>"+city_builder.l("Uses")+"</dt>";for(var i in e)t+="<dd>"+e[i]+city_builder.ui.resource_small_img(i)+"</dd>"}return t},production_panel:function(e){var t="";if(void 0!==e){t+="<dt>"+city_builder.l("Produces")+"</dt>";for(var i in e)t+="<dd>"+e[i]+city_builder.ui.resource_small_img(i)+"</dd>"}return t},requires_panel:function(e){var t="";if(void 0!==e.buildings){t+="<dt>"+city_builder.l("Requires")+"</dt>";t+="<dd>"+city_builder.BUILDINGS[city_builder.BUILDINGS.findIndexM(e.buildings)].name+"</span>"}return t},tax_panel:function(e){var t="";return void 0!==e&&(t+="<dt>"+city_builder.l("Tax")+"</dt>",t+="<dd>"+e+city_builder.ui.resource_small_img("coins")+"</dd>"),t},storage_panel:function(e){var t="";return void 0!==e&&(t+="<dt>"+city_builder.l("Storage")+"</dt>",t+="<dd>"+e+'<img alt="Storage space" class="tips" title="'+city_builder.l("Storage Space")+'" src="'+city_builder.ASSETS_URL+'images/resources/storage_small.png" /></dd>'),t},resource_small_img:function(e){return'<img alt="'+city_builder.RESOURCES[e].name+'" class="tips" title="'+city_builder.RESOURCES[e].name+'" src="'+city_builder.ASSETS_URL+"images/resources/"+e+'_small.png" />'}},city_builder.city=function(e){return this.name=null,this.ruler=null,this.core=null,this.buildings=[],this.buildings_list=[],this.storage=0,this.prestige=1,this.personality=null,this.nationality=null,this.climate=null,this.army=[],this.navy=[],this.mercenary=[],this.resources={},this.data=null,this.level=1,this.trades=null,this.avatar=null,this.influence={},this.__constructor=function(e){return this.core=e.core,this.name=e.name,this.data=e.data,this.level=void 0!==e.data.level?e.data.level:1,this.resources=city_builder.RESOURCES,this.resources.fame=void 0!==e.level?{name:"Fame",handle:"fame",total:city_builder.LEVELS[e.data.level],amount:1}:city_builder.RESOURCES.fame,void 0!==e.data.coins&&(this.resources.coins.storage=e.data.coins),this.trades=void 0!==e.data.trades?e.data.trades:null,this.prestige=void 0!==e.data.prestige?e.data.prestige:1,this.personality=void 0!==e.data.personality?e.data.personality:city_builder.PERSONALITY_TYPE_BALANCED,this.nationality=void 0!==e.data.nationality?e.data.nationality:city_builder.NATION_TYPE_ROMAN,this.climate=void 0!==e.data.climate?e.data.climate:city_builder.CLIMATE_TYPE_TEMPERATE,this.ruler=void 0!==e.data.ruler?e.data.ruler:0,this.avatar=void 0!==e.data.avatar?e.data.avatar:1,this},this.buy_from_city=function(e,t,i){var r;if("string"==typeof e){if(r=this.get_core().get_city(e),e===!1)return this.get_core().error(e+" does not exist."),!1}else r=e;var s=r.get_trades();if(null===s)return this.get_core().error(e+" does not trade any goods."),!1;if(void 0===s.exports)return this.get_core().error(e+" does not export any goods."),!1;for(var a in s.exports)if(a===t){void 0===i&&(i=s.exports[a]);var o=city_builder.RESOURCES[a].price*city_builder.TRADES_ADDITION/100,n=city_builder.utils.calc_price_plus_discount(i,a,o);return!!this.has_storage_space_for(i)&&(this.dec_coins_amount(n)!==!1&&(this.add_to_storage(a,i),this.remove_from_exports(r,a,i),this.raise_influence(e,2),this.raise_prestige(),this.inc_fame_amount(50),this.get_core().refresh_ui(),this.get_core().notify(this.get_name()+" bought "+i+" "+city_builder.RESOURCES[a].name+" from "+e+" for "+(city_builder.RESOURCES[a].price+o)+" coins each, for a total of "+n+" coins.","Transaction done"),{buyer:this.get_name(),amount:i,goods:city_builder.RESOURCES[a].name,seller:e,price:Math.round(city_builder.RESOURCES[a].price+o),totalPrice:n}))}return this.get_core().error(e+" does not export the requested goods."),!1},this.remove_resource=function(e,t){var i=this.get_resources();return!!this.has_resources(e,t)&&(i[e].storage=i[e].storage-t,!0)},this.add_to_storage=function(e,t){var i=this.get_resources();return i[e].storage=i[e].storage+t,!0},this.has_coins=function(e){return!(this.get_coins_amount()-e<0)||(this.get_core().error(this.get_name()+" doesn`t have enough "+city_builder.RESOURCES.coins.name+"."),!1)},this.has_resources=function(e,t){return!(this.get_resources()[e].storage-t<0&&(this.get_core().error(this.get_name()+" does not have enough "+city_builder.RESOURCES[e].name+"."),1))},this.reset_trades=function(){return this.trades=city_builder.CITIES[this.get_name()].trades,!0},this.list_black_market=function(e,t){if(this.remove_resource(e,t)){var i=city_builder.RESOURCES[e].price*city_builder.BLACK_MARKET_DISCOUNT/100,r=city_builder.utils.calculate_price_minus_discount(t,e,i);return this.get_core().add_black_market(e,t,r),this.get_core().refresh_ui(),this.get_core().notify(this.get_name()+" placed "+t+" "+city_builder.RESOURCES[e].name+" on the Black Market and will receive "+r+" coins next month.","Goods listed"),{seller:this.get_name(),amount:t,goods:city_builder.RESOURCES[e].name,price:r,discount:i}}return!1},this.sell_to_city=function(e,t,i){var r;if("string"==typeof e){if(r=this.get_core().get_city(e),e===!1)return this.get_core().error(e+" does not exist."),!1}else r=e;var s=r.get_trades();if(null===s)return this.get_core().error(e+" does not trade any goods."),!1;if(void 0===s.imports)return this.get_core().error(e+" does not import any goods."),!1;for(var a in s.imports)if(a===t){void 0===i&&(i=s.imports[a]);var o=city_builder.RESOURCES[a].price*city_builder.TRADES_DISCOUNT/100,n=city_builder.utils.calc_price_plus_discount(i,a,o);return!!this.remove_resource(a,i)&&(this.inc_coins_amount(n),this.remove_from_imports(r,a,i),this.raise_influence(e,1),this.raise_prestige(),this.inc_fame_amount(50),this.get_core().refresh_ui(),this.get_core().notify(this.get_name()+" sold "+i+" "+city_builder.RESOURCES[a].name+" to "+e+" for "+(city_builder.RESOURCES[a].price-o)+" coins each, for a total of "+n+" coins.","Transaction done"),{seller:this.get_name(),amount:i,goods:city_builder.RESOURCES[a].name,buyer:e,price:Math.round(city_builder.RESOURCES[a].price-o),totalPrice:n})}return this.get_core().error(e+" does not import the specified goods."),!1},this.remove_from_exports=function(e,t,i){return e.trades.exports[t]=e.trades.exports[t]-i,!0},this.remove_from_imports=function(e,t,i){return e.trades.imports[t]=e.trades.imports[t]-i,!0},this.export_data=function(e){var t={name:this.get_name(),ruler:this.get_ruler(),level:this.get_level(),climate:this.get_climate().id,nationality:this.get_nationality().id,avatar:this.get_avatar(),prestige:this.get_prestige(),influence:this.get_influence(),army:this.get_army_total(),navy:this.get_navy_total(),mercenary:this.get_mercenary(),resources:this.get_resources(),trades:this.get_core()._get_neighbours_trades(),buildings:this.buildings_list,black_market:this.get_core().get_black_market(),date_time:{day:this.get_core().day,month:this.get_core().month,year:this.get_core().year,day_of_month:this.get_core().day_of_month}};return e===!0&&localStorage.setItem("city_builder.data",window.btoa(JSON.stringify(t))),t},this.import_data=function(e){return this.set_name(e.name),this.set_ruler(e.ruler),this.set_level(e.level),this.set_avatar(e.avatar),this.set_nationality(e.nationality),this.set_climate(e.climate),this.set_prestige(e.prestige),this.setup_army(!0,e.army),this.setup_navy(!0,e.navy),this.set_mercenary(e.mercenary),this.set_resources(e.resources),this.get_core().set_date_time(e.date_time),this.get_core().set_black_market(e.black_market),this},this.get_buildings=function(){return this.buildings},this.get_name=function(){return this.name},this.set_name=function(e){return this.name=e,this},this.get_core=function(){return this.core},this.level_up=function(){return this.level++,this.resources.fame.total=this.resources.fame.total+this.resources.fame.amount,this.resources.fame.amount=1,$(".citylevel").html(this.get_level()),this.get_core().notify("The city of "+this.get_name()+" is now level "+this.get_level()+"."),this},this.rename=function(e){return this.name=e,this},this.is_building_built=function(e){for(var t=this.get_buildings(),i=0;i<t.length;i++)if(t[i].type===e)return!0;return!1},this.has_storage_space_for=function(e){var t=this.get_storage_space();return!!this.has_storage_space()&&(!(t.occupied+e>t.all)||(this.get_core().error("There is no storage space in your city to accomodate the new goods."),!1))},this.has_storage_space=function(){var e=this.get_storage_space();return!(e.occupied>=e.all)||(this.get_core().error("There is no storage space in your city."),!1)},this.get_storage_space=function(){var e=0;for(var t in this.get_resources())"coins"!==t&&"fame"!==t&&(e+=this.get_resources()[t].storage);return{occupied:e,all:this.storage}},this._create_buildings=function(e,t){if(t=void 0!==t&&t===!0,"object"==typeof e)for(var i=0;i<e.length;i++){var r=city_builder.BUILDINGS.findIndexM(e[i]);if(r!==!1){var s=city_builder.BUILDINGS[r],a=new city_builder.building({city:this,type:e[i],data:s,hidden:t});this.buildings.push(a),this.buildings_list.push(e[i])}}else{var r=city_builder.BUILDINGS.findIndexM(e);if(r!==!1){var s=city_builder.BUILDINGS[r],a=new city_builder.building({city:this,type:e,data:s,hidden:t});this.buildings.push(a),this.buildings_list.push(e)}}return!1},this.build=function(e){var t=city_builder.BUILDINGS.findIndexM(e);if(t!==!1){var i=city_builder.BUILDINGS[t];if(void 0!==i.requires.city_level&&this.level<i.requires.city_level)return this.get_core().error("Your city level is too low to construct this building."),!1;if(this.resources.coins.storage-i.cost.coins<0)return this.get_core().error("You don`t have enough coins to construct this building."),!1;this.resources.coins.storage=this.resources.coins.storage-i.cost.coins;for(var r in i.cost)if("coins"!==r){if(this.get_resources()[r].storage-i.cost[r]<0)return this.get_core().error("You don`t have enough "+r+" to construct this building."),!1;this.get_resources()[r].storage=this.get_resources()[r].storage-i.cost[r]}var s=new city_builder.building({city:this,type:e,data:i});return this.buildings.push(s),this.buildings_list.push(e),this.get_core().refresh_ui(),this.get_core().save(),this.get_core().notify("New building constructed: "+s.get_name()),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0}),s}return!1},this.get_rank=function(){return Math.floor(this.get_level()*this.get_prestige()*this.get_army_total().total/100)},this.get_building_by_handle=function(e){for(var t=this.get_buildings(),i=0;i<t.length;i++)if(t[i].get_type()===e)return t[i];return!1},this.demolish=function(e){return"number"==typeof e&&this.buildings.splice(e,1),this},this.get_coins=function(){return this.resources.coins},this.get_coins_amount=function(){return this.get_coins().storage},this.inc_coins_amount=function(e){return this.set_coins_amount(this.get_coins_amount()+e)},this.dec_coins_amount=function(e){return!!this.has_coins(e)&&(this.set_coins_amount(this.get_coins_amount()-e),!0)},this.set_coins_amount=function(e){return this.get_coins().storage=e,e},this.get_prestige=function(){return this.prestige},this.get_fame=function(){return this.resources.fame},this.set_fame=function(e){return this.resources.fame=e,this},this.set_coins=function(e){return this.resources.coins=e,this},this.get_fame_amount=function(){return this.get_fame().amount},this.inc_fame_amount=function(e){return this.set_fame_amount(this.get_fame_amount()+e)},this.dec_fame_amount=function(e){
return this.set_fame_amount(this.get_fame_amount()-e)},this.set_fame_amount=function(e){return this.get_fame().amount=e,e},this.get_army=function(){return this.army},this.get_navy=function(){return this.navy},this.get_mercenary=function(){return this.mercenary},this.get_navy_total=function(){for(var e=0,t={Corsair:0,Caravel:0,Warship:0},i=0;i<this.navy.length;i++){var r=this.navy[i].get_name();for(var s in t)r===s&&(t[s]++,e++)}return{total:e,navy:t}},this.get_army_total=function(){for(var e=0,t={Militia:0,Axeman:0,Bowman:0,Pikeman:0,Crossbowman:0,Knight:0},i=0;i<this.army.length;i++){var r=this.army[i].get_name();for(var s in t)r===s&&(t[s]++,e++)}return{total:e,army:t}},this.get_mercenary_total=function(){for(var e=0,t={Militia:0,Axeman:0,Bowman:0,Pikeman:0,Crossbowman:0,Knight:0},i=0;i<this.mercenary.length;i++){var r=this.mercenary[i].get_name();for(var s in t)r===s&&(t[s]++,e++)}return{total:e,mercenary:t}},this.remove_resource=function(e,t){var i=this.get_resources();return!!this.has_resources(e,t)&&(i[e].storage=i[e].storage-t,!0)},this.remove_resources=function(e){var t=this.get_resources();for(var i in e)if(!this.has_resources(i,e[i]))return!1;for(var i in e)t[i].storage=t[i].storage-e[i];return!0},this.is_mercenary_recruited=function(e){for(var t=0;t<this.mercenary.length;t++)if(this.mercenary[t].handle===e)return!0;return!1},this.call_advisor=function(){var e=[];0===this.army.length&&e.push("You have no army, this is an open invitation for attack."),this.army.length<10&&this.army.length>0&&e.push("You have a small army, try to recruit some more soldiers."),0===this.navy.length&&e.push("You have no navy, this is an open invitation for attack."),this.army.length<3&&this.army.length>0&&e.push("You have a small navy, try to construct some more ships.");var t=this.get_storage_space();t.occupied>=t.all?e.push("You have no storage space to store your new goods and they will be lost. Sell some goods or build a warehouse."):t.all-t.occupied<100&&e.push("You will soon run out of storage space and all goods produced will be lost. Sell some goods or build a warehouse."),this.resources.coins.storage<1e3&&e.push("You seem to be losing coins fast, sell some goods or upgrade your houses to get better taxes."),(this.resources.wood.storage<100||this.resources.stones.storage<100)&&e.push("You are lacking construction materials, buy some stones and/or wood off the World Trade Market."),this.resources.coins.storage>1e5&&e.push("You have lots of coins, why not invest some in goods?");for(var i in this.resources)"coins"!==i&&"fame"!==i&&this.resources[i].storage>1e3&&e.push("You seem to have a surplus of "+city_builder.RESOURCES[i].name+". You can sell some and get coins instead.");return e},this.recruit_mercenary_army=function(e){for(var t=0;t<city_builder.MERCENARIES.length;t++)if(e===city_builder.MERCENARIES[t].handle){var i=city_builder.MERCENARIES[t].cost;if(this.dec_coins_amount(i)===!1)return!1;var r={id:t,handle:e,army:[]};for(var s in city_builder.MERCENARIES[t].army){var a=city_builder.SOLDIER_TYPES[s],o=new city_builder.soldier({name:s,data:a});r.army.push(o)}return this.mercenary.push(r),this.get_core().notify("The mercenaries of the "+city_builder.MERCENARIES[t].name+" are now available for skirmish missions for the duration of one year.","Mercenaries recruited."),this.get_core().refresh_ui(),this.get_core().save(),!0}return!1},this.recruit_ship=function(e){for(var t in city_builder.SHIP_TYPES)if(e===t){var i=city_builder.SHIP_TYPES[t];if(!this.remove_resources(i.cost))return!1;var r=new city_builder.ship({name:t,data:i});return this.navy.push(r),this.get_core().refresh_ui(),this.get_core().notify("A new "+e+" ship has been constructed.","New ship"),this.get_core().save(),!0}return!1},this.recruit_soldier=function(e){for(var t in city_builder.SOLDIER_TYPES)if(e===t){var i=city_builder.SOLDIER_TYPES[t];if(!this.remove_resources(i.cost))return!1;var r=new city_builder.soldier({name:t,data:i});return this.army.push(r),this.get_core().refresh_ui(),this.get_core().save(),!0}return!1},this._recruit_ship=function(e){for(var t in city_builder.SHIP_TYPES)if(e===t){var i=city_builder.SHIP_TYPES[t],r=new city_builder.ship({name:t,data:i});this.navy.push(r)}return this},this._recruit_soldier=function(e){for(var t in city_builder.SOLDIER_TYPES)if(e===t){var i=city_builder.SOLDIER_TYPES[t],r=new city_builder.soldier({name:t,data:i});this.army.push(r)}return this},this.get_navy_size=function(){return this.get_navy().length},this.get_army_size=function(){return this.get_army().length},this.disband_ship=function(e){for(var t=this.get_navy(),i=0;i<t.length;i++){if(t[i].get_name()===e)return delete t.soldier[i],!0}return!1},this.disband_soldier=function(e){for(var t=this.get_army(),i=0;i<t.length;i++){if(t[i].get_name()===e)return delete t.soldier[i],!0}return!1},this.set_mercenary=function(e){return this.mercenary=e,this},this.set_navy=function(e){return this.navy=e,this},this.set_army=function(e){return this.army=e,this},this.get_resources=function(){return this.resources},this.set_resources=function(e){return this.resources=e,this},this.get_ruler=function(){return this.ruler},this.set_ruler=function(e){return this.ruler=e,this},this.set_level=function(e){return this.level=e,this},this.get_level=function(){return this.level},this.get_trades=function(){return this.trades},this.set_trades=function(e){return this.trades=e,this},this.get_personality=function(){return{id:this.personality,name:city_builder.PERSONALITY_TYPES[this.personality]}},this.release_mercenaries=function(){return this.mercenary=[],this.get_core().notify("At the end of the year, mercenaries from your city have been released."),this},this.setup_navy=function(e,t){if(void 0===t){var i=this.data.navy;for(var r in i)for(var s=0;s<i[r];s++)e===!0?this._recruit_ship(r):this.recruit_ship(r)}else{var i=t.navy;for(var r in i)for(var s=0;s<i[r];s++)e===!0?this._recruit_ship(r):this.recruit_ship(r)}return this},this.setup_army=function(e,t){if(void 0===t){var i=this.data.army;for(var r in i)for(var s=0;s<i[r];s++)e===!0?this._recruit_soldier(r):this.recruit_soldier(r)}else{var i=t.army;for(var r in i)for(var s=0;s<i[r];s++)e===!0?this._recruit_soldier(r):this.recruit_soldier(r)}return this},this.get_climate=function(){return{id:this.climate,name:city_builder.CLIMATE_TYPES[this.climate]}},this.get_nationality=function(){return{id:this.nationality,name:city_builder.NATION_TYPES[this.nationality]}},this.raise_prestige=function(e){return void 0!==e?this.prestige+=e:++this.prestige,$(".cityprestige").html(this.get_prestige()),this.get_core().notify("The prestige of your city raised."),this.prestige},this.lower_prestige=function(e){return void 0!==e?this.prestige-e>=1&&(this.prestige-=e,this.get_core().notify("The prestige of your city lowered.")):this.prestige-1>=1&&(--this.prestige,this.get_core().notify("The prestige of your city lowered.")),$(".cityprestige").html(this.get_prestige()),this.prestige},this.reset_prestige=function(){return this.prestige=1,$(".cityprestige").html(this.get_prestige()),this},this.set_prestige=function(e){return this.prestige=e,$(".cityprestige").html(this.get_prestige()),this},this.get_avatar=function(){return this.avatar},this.set_avatar=function(e){return this.avatar=e,this},this.lower_influence=function(e,t){return this.influence[e]-t>=0&&(this.influence[e]=this.influence[e]-t),this.influence[e]},this.raise_influence=function(e,t){return this.influence[e]+t<=100&&(this.influence[e]=this.influence[e]+t),this.influence[e]},this.get_influence=function(){return this.influence},this.get_influence_with_city=function(e){return this.influence[e]},this.set_influence=function(e){return this.influence=e,this},this.set_climate=function(e){return this.climate=e,this},this.set_nationality=function(e){return this.nationality=e,this},this.__constructor(e)},city_builder.event=function(e){return this.core=null,this.name=null,this.handle=null,this.chance=0,this.effect=null,this.description=null,this.data=null,this.__constructor=function(e){return this.core=e.core,this.name=e.name,this.handle=e.handle,this.chance=e.chance,this.description=e.description,this.data=e.data,this.effect=e.effect,this.process(),this},this.process=function(){return Math.random().toFixed(4)<this.chance&&(this._process(),!0)},this.notify=function(){this.core._notify({title:"Event occured: "+this.name,content:this.description.replace(/CITY/g,this.data.city).replace(/AMOUNT/g,this.data.amount),timeout:!1,other:!0})},this._process=function(){switch(this.notify(),this.effect){case city_builder.EVENT_EFFECT_LOSE_COINS:this.core.get_city().dec_coins_amount(this.data.amount);break;case city_builder.EVENT_EFFECT_GAIN_COINS:this.core.get_city().inc_coins_amount(this.data.amount);break;case city_builder.EVENT_EFFECT_RAISE_INFLUENCE:this.core.get_city().raise_influence(this.core.get_city(this.data.city),this.data.amount);break;case city_builder.EVENT_EFFECT_LOWER_INFLUENCE:this.core.get_city().lower_influence(this.core.get_city(this.data.city),this.data.amount);break;case city_builder.EVENT_EFFECT_GAIN_FAME:this.core.get_city().inc_fame_amount(this.data.amount);break;case city_builder.EVENT_EFFECT_LOSE_FAME:this.core.get_city().dec_fame_amount(this.data.amount);break;case city_builder.EVENT_EFFECT_DESTROY_BUILDING:}return this},this.__constructor(e)},city_builder.building=function(e){return this.level=1,this.city=null,this.name=null,this.type=null,this.working=!0,this.is_production=!1,this.is_municipal=!1,this.__constructor=function(e){var t=this;this.city=e.city,this.type=e.type,this.name=e.data.name,this.isProduction=void 0!==e.data.is_production&&e.data.is_production===!0,this.isMunicipal=void 0!==e.data.is_municipal&&e.data.is_municipal===!0,this.level=void 0!==e.data.level?e.data.level:1,e.data.level=this.level,e.hidden!==!0&&$("section.game").append(city_builder.ui.building_element(e)).on("click","#building-"+e.data.handle,function(){new city_builder.panel_building({core:t.get_core(),header:e.data.name,data:e.data})});var i=this.get_building_data();switch(this.type){case"marketplace":case"warehouse":this.get_city().storage=this.get_city().storage+i.storage}return this},this.upgrade=function(){var e=this.get_building_data();return this.level<e.upgrades&&(++this.level,!0)},this.downgrade=function(){return this.level>1&&(--this.level,!0)},this.is_production_building=function(){return this.is_production},this.is_producing=function(){return this.working},this.start_production=function(){return!!this.is_production_building()&&(this.get_core().notify(this.get_name()+"`s production started."),this.working=!0,!0)},this.stop_production=function(){return!!this.is_production_building()&&(this.get_core().notify(this.get_name()+"`s production stopped."),this.working=!1,!0)},this.demolish=function(){return $("section.game .building[data="+this.get_type()+"]").remove(),this},this.has_materials=function(e){var t=this.get_building_data(),i=this.get_city_resources(),r=t.materials;if("object"==typeof e){for(var s=0;s<e.length;s++)if("coins"!==e[s]&&i[e[s]].storage-r[e[s]]<0)return this.get_core().log(this.get_name()+" doesn`t have enough "+e[s]+".",!0),!1}else if(i[e].storage-r[e]<0)return this.get_core().log(this.get_name()+" doesn`t have enough "+e+".",!0),!1;return!0},this.use_material=function(e){var t=this.get_building_data(),i=t.materials;if("object"==typeof e)for(var r=0;r<e.length;r++)this.get_city().remove_resource(e[r],i[e[r]]),this.get_core().log(this.get_name()+" used "+i[e[r]]+" "+e[r]+".");else this.get_city().remove_resource(e,i[e]),this.get_core().log(this.get_name()+" used "+i[e]+" "+e+".");return this},this.get_building_data=function(){return city_builder.BUILDINGS[city_builder.BUILDINGS.findIndexM(this.type)]},this.get_data=function(){return this.data},this.get_city_resources=function(){return this.get_city().get_resources()},this.produce_material=function(e){var t=this.get_building_data(),i=t.production;if("object"==typeof e)for(var r=0;r<e.length;r++){if(!this.is_producing())return this.get_core().log(this.get_name()+" production is stopped."),this;var s=i[e[r]]*this.get_level();if(this.get_city().has_storage_space_for(s)){if(this.get_city().add_to_storage(e[r],s),void 0!==t.chance)for(var a in t.chance){var o=Math.random();o<t.chance[a]&&(this.get_core().log(this.get_name()+" procced extra "+city_builder.RESOURCES[a].name+"."),this.get_city().add_to_storage(a,1))}this.get_core().log(this.get_name()+" produced "+s+" "+e[r]+".")}}else{var s=i[e]*this.get_level();if(this.get_city().has_storage_space_for(s)){if(!this.is_producing())return this.get_core().log(this.get_name()+" production is stopped."),this;if(this.get_city().add_to_storage(e,s),void 0!==t.chance)for(var a in t.chance){var o=Math.random();o<t.chance[a]&&(this.get_core().log(this.get_name()+" procced extra "+city_builder.RESOURCES[a].name+"."),this.get_city().add_to_storage(a,1))}this.get_core().log(this.get_name()+" produced "+s+" "+e+".")}}return this},this.process_mats=function(e,t){return void 0!==t?this.has_materials(t)&&(this.use_material(t),this.produce_material(e)):this.produce_material(e),this},this.adjust_city_fame=function(){var e=this.get_building_data(),t=e.production,i=t.fame*this.get_level();return this.get_city().inc_fame_amount(i),this.get_core().log(this.get_name()+" raised city fame with "+i+"."),this.get_city().get_fame().amount},this.adjust_city_fame_for_coins=function(){var e=this.get_building_data(),t=e.materials,i=e.production;if(this.get_city().has_coins(t.coins)){var r=i.fame*this.get_level();this.get_city().inc_fame_amount(r),this.get_city().dec_coins_amount(t.coins),this.get_core().log(this.get_name()+" raised city fame with "+r+" at the cost of "+t.coins+" coins.")}return{fame:this.get_city().get_fame().amount,coins:this.get_city().get_coins().amount}},this.process_tax=function(){var e=[],t=this.get_building_data(),i=t.materials;for(var r in i)e.push(r);if(e.length>0&&this.has_materials(e)){this.use_material(e);var s=t.tax*this.get_level();this.get_city().inc_coins_amount(s),this.get_core().log(this.get_name()+" gave "+s+" coins via tax.")}return this},this.has_requirements=function(){var e=!0,t=this.get_building_data();if(void 0!==t.requires.buildings){var i=t.requires.buildings;if("object"==typeof i){for(var r=0;r<i.length;r++)if(!this.get_city().is_building_built(i[r])){e=!1;var s=city_builder.BUILDINGS[city_builder.BUILDINGS.findIndexM(i[r])];this.get_core().log(this.get_name()+" doesn`t have the required buildings: "+s.name+".",!0)}}else if(!this.get_city().is_building_built(i)){e=!1;var s=city_builder.BUILDINGS[city_builder.BUILDINGS.findIndexM(i)];this.get_core().log(this.get_name()+" doesn`t have the required buildings: "+s.name+".",!0)}}return e},this._process=function(){var e=[],t=[],i=this.get_building_data(),r=i.materials;for(var s in r)t.push(s);if(i.is_housing===!0){if(t.length>0&&this.has_materials(t)){this.use_material(t);var a=i.tax*this.get_level();this.get_city().inc_coins_amount(a),this.get_core().log(this.get_name()+" gave "+a+" coins via tax.")}}else if(this.is_producing()){var o=i.production;for(var s in o)e.push(s);this.has_requirements()&&(t.length>0?this.has_materials(t)&&(this.use_material(t),this.produce_material(e)):this.produce_material(e))}return this},this.is_marketplace=function(){return"marketplace"===this.get_type()},this.process=function(){var e=this.get_building_data();this.get_city_resources(),e.production,e.materials;switch(this.get_type()){case"marketplace":this.adjust_city_fame();break;case"warehouse":break;case"camp":break;case"castle":break;case"church":this.adjust_city_fame_for_coins();break;case"monastery":this.adjust_city_fame_for_coins();break;case"tavern":this.adjust_city_fame_for_coins();break;default:this._process()}return this},this.get_city=function(){return this.city},this.get_core=function(){return this.get_city().get_core()},this.get_name=function(){return this.name},this.get_level=function(){return this.level},this.get_type=function(){return this.type},this.__constructor(e)},city_builder.panel_building=function(e){return this.core=null,this.id="building",this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){var t=this;this.core=e.core;var i="#panel-"+this.id;city_builder.ui.panel_exists(i)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`");var r=this.core.get_city().get_building_by_handle(e.data.handle);$(".ui").append(city_builder.ui.building_panel_template.replace(/{id}/g,this.id)),$(i+" header .title").html(e.data.name);var s='<p class="smalldesc">'+e.data.description+"</p><dl>"+city_builder.ui.cost_panel(e.data.cost)+city_builder.ui.materials_panel(e.data.materials)+city_builder.ui.production_panel(e.data.production)+city_builder.ui.requires_panel(e.data.requires)+city_builder.ui.tax_panel(e.data.tax)+city_builder.ui.storage_panel(e.data.storage)+"</dl>";return $(i+" .contents").append(s),r.is_marketplace()?$(i+" header .demolish").remove():$(i).on("click",".demolish",function(){return t.destroy(),!1}),r.is_production_building()?(r.is_producing()?$(i+" .pause").removeClass("start"):$(i+" .start").removeClass("pause"),$(i).on("click",".pause",function(){return r.stop_production(),$(this).removeClass("pause").addClass("start"),!1}).on("click",".start",function(){return $(this).removeClass("start").addClass("pause"),r.start_production(),!1})):$(i+" .start, "+i+" .pause").remove(),$(i).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.panel_buildings=function(e){return this.core=null,this.id="buildings",this.title=city_builder.l("City Buildings"),this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){this.core=e.core;var t=this,i="#panel-"+this.id;city_builder.ui.panel_exists(i)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`");var r=this.core.get_city();$(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,this.title));var s='<div class="left buildings">',a=city_builder["CITY_BUILDINGS_"+r.get_climate().name.toUpperCase()];s+='<div class="tabs"><ul>';for(var o in city_builder.BUILDINGS_CATEGORIES)s+='<li><a href="#tab-'+o.toLowerCase()+'">'+o+"</a></li>";s+="</ul>";for(var o in city_builder.BUILDINGS_CATEGORIES){s+='<div id="tab-'+o.toLowerCase()+'" class="bldg-tabs">';for(var n=0;n<city_builder.BUILDINGS_CATEGORIES[o].length;n++){var c=city_builder.BUILDINGS_CATEGORIES[o][n];if($.inArray(c,a)!==-1){var l=city_builder.BUILDINGS[city_builder.BUILDINGS.findIndexM(c)],d=r.is_building_built(l.handle);s+='<div data-handle="'+l.handle+'" class="building-item'+(d===!0?" disabled":"")+'"><span class="title">'+l.name+'</span><img class="building" src="'+city_builder.ASSETS_URL+"images/buildings/"+l.handle+'1.png" /></div>'}}s+="</div>"}return s+='</div></div><div class="right"><fieldset><legend>'+city_builder.l("Description")+'</legend><div class="b-desc"></div></fieldset><fieldset><legend>'+city_builder.l("Cost")+'</legend><div class="b-cost"></div></fieldset><fieldset class="materials"><legend>'+city_builder.l("Materials")+'</legend><div class="b-mats"></div></fieldset><fieldset class="production"><legend>'+city_builder.l("Production")+'</legend><div class="b-prod"></div></fieldset><fieldset class="extra"><legend>'+city_builder.l("Chance of extra materials")+'</legend><div class="b-chance"></div></fieldset><fieldset class="storage"><legend>'+city_builder.l("Storage")+'</legend><div class="b-store"></div></fieldset><fieldset class="taxes"><legend>'+city_builder.l("Taxes")+'</legend><div class="b-tax"></div></fieldset><fieldset><legend>'+city_builder.l("Requirements")+'</legend><div class="b-req"></div></fieldset><div class="toolbar"></div></div>',$(i).on("click",".building-item",function(){$(i).addClass("expanded"),$(i+" .building-item").removeClass("active"),$(this).addClass("active"),$(i+" .b-chance, "+i+" .b-tax, "+i+" .b-store, "+i+" .b-req, "+i+" .b-cost, "+i+" .b-name, "+i+" .b-desc, "+i+" .b-mats, "+i+" .b-prod, "+i+" .toolbar").empty();var e=$(this).data("handle"),s=city_builder.BUILDINGS[city_builder.BUILDINGS.findIndexM(e)];$(i+" header .title").html(t.title+" - "+s.name),$(i+" .b-desc").html(s.description);var a='<dl class="nomg">';for(var o in s.cost)a+="<dt>"+s.cost[o]+'</dt><dd><img class="tips" title="'+city_builder.RESOURCES[o].name+'" src="'+city_builder.ASSETS_URL+"images/resources/"+o+'_small.png" /></dd>';if(a+="</dl>",$(i+" .b-cost").append(a),void 0!==s.requires){if(a='<dl class="nomg">',void 0!==s.requires.buildings)if("object"==typeof s.requires.buildings)for(var n=0;n<s.requires.buildings.length;n++)a+="<dt>"+city_builder.l("Building")+"</dt><dd>"+t.core.get_building_config_data(s.requires.buildings[n]).name+"</dd>";else a+="<dt>"+city_builder.l("Building")+"</dt><dd>"+t.core.get_building_config_data(s.requires.buildings).name+"</dd>";a+="<dt>City level</dt><dd>"+s.requires.city_level+"</dd></dl>",$(i+" .b-req").append(a)}if(void 0!==s.chance){a='<dl class="nomg">';for(var c in s.chance)a+="<dt>"+100*s.chance[c]+'%</dt><dd><img class="tips" title="'+city_builder.RESOURCES[c].name+'" src="'+city_builder.ASSETS_URL+"images/resources/"+c+'_small.png" /></dd>';a+="</dl>",$(i+" .b-chance").append(a),$("fieldset.extra").show()}else $("fieldset.extra").hide();if(s.is_production===!0){if($("fieldset.taxes, fieldset.production, fieldset.materials, fieldset.storage").hide(),void 0!==s.production){a='<dl class="nomg">';for(var o in s.production)a+="<dt>"+s.production[o]+'</dt><dd><img class="tips" title="'+city_builder.RESOURCES[o].name+'" src="'+city_builder.ASSETS_URL+"images/resources/"+o+'_small.png" /></dd>';a+="</dl>",$(i+" .b-prod").append(a),$("fieldset.production").show()}if(void 0!==s.materials){a='<dl class="nomg">';for(var o in s.materials)a+="<dt>"+s.materials[o]+'</dt><dd><img class="tips" title="'+city_builder.RESOURCES[o].name+'" src="'+city_builder.ASSETS_URL+"images/resources/"+o+'_small.png" /></dd>';a+="</dl>",$(i+" .b-mats").append(a),$("fieldset.materials").show()}}else if(s.is_housing===!0){if($("fieldset.production, fieldset.storage").hide(),void 0!==s.materials){a='<dl class="nomg">';for(var o in s.materials)a+="<dt>"+s.materials[o]+'</dt><dd><img class="tips" title="'+city_builder.RESOURCES[o].name+'" src="'+city_builder.ASSETS_URL+"images/resources/"+o+'_small.png" /></dd>';a+="</dl>",$(i+" .b-mats").append(a),$("fieldset.materials").show()}void 0!==s.tax&&(a='<dl class="nomg"><dt>Tax</dt><dd>'+s.tax+'<img class="tips" title="'+city_builder.l("Coins")+'" src="'+city_builder.ASSETS_URL+'images/resources/coins_small.png" /></dd></dl>',$(i+" .b-tax").append(a),$("fieldset.taxes").show())}else void 0!==s.storage?($("fieldset.taxes, fieldset.production, fieldset.materials").hide(),a='<dl class="nomg"><dt>'+s.storage+'</dt><dd><img src="'+city_builder.ASSETS_URL+'images/resources/storage_small.png" /></dd></dl>',$(i+" .b-store").append(a),$("fieldset.storage").show()):$("fieldset.taxes, fieldset.production, fieldset.materials, fieldset.storage").hide();return r.is_building_built(s.handle)!==!0?$(i+" .toolbar").append('<a href="#" class="btn build" data-handle="'+s.handle+'">'+city_builder.l("Build")+"</a>"):$(i+" .toolbar").append(city_builder.l("You already constructed this building.")),$(i+" .tips").tipsy({gravity:"s"}),$(i+" .right").show(),!1}),$(i+" .contents").append(s),$(i).on("click",".btn.build",function(){var e=$(this).data("handle");return r.build(e)!==!1&&($(i+" .building-item[data-handle="+e+"]").addClass("disabled"),$(i+" .toolbar").empty().append(city_builder.l("You already have this building."))),!1}).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.panel_storage=function(e){return this.core=null,this.id="storage",this.title=city_builder.l("City Storage"),this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){this.core=e.core;var t=this,i="#panel-"+this.id;city_builder.ui.panel_exists(i)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`");var r=this.core.get_city(),s=r.get_resources(),a=r.get_storage_space();$(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,this.title));var o="";for(var n in city_builder.RESOURCES)"fame"!==n&&(o+=city_builder.ui.resource_storage_el(n,s[n].storage));return o+='<div class="clearfix"></div><p>'+city_builder.l("Total storage space")+": "+a.all+"</p><p>"+city_builder.l("Total used space")+': <span class="citystorage">'+a.occupied+"</span></p>",$(i+" .contents").empty().append(o),$(i).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.panel_city=function(e){return this.core=null,this.id="city",this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){var t=this;this.core=e.core;var i="#panel-"+this.id,r=e.data;city_builder.ui.panel_exists(i)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`");var s=r.get_trades();return $(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,r.get_name())),$(i+" .contents").append(city_builder.ui.tabs([city_builder.l("Info"),city_builder.l("Army"),city_builder.l("Navy"),city_builder.l("Imports"),city_builder.l("Exports")])),$(i+" #tab-info").append('<img class="avatar" src="'+city_builder.ASSETS_URL+"images/avatars/avatar"+r.get_avatar()+'.png" /><dl><dt>'+city_builder.l("Ruler")+"</dt><dd>"+r.get_ruler()+"</dd><dt>"+city_builder.l("Climate")+"</dt><dd>"+r.get_climate().name.capitalize()+"</dd><dt>"+city_builder.l("Personality")+"</dt><dd>"+r.get_personality().name.capitalize()+"</dd><dt>"+city_builder.l("Nationality")+"</dt><dd>"+r.get_nationality().name.capitalize()+"</dd><dt>"+city_builder.l("Level")+"</dt><dd>"+r.get_level()+"</dd><dt>"+city_builder.l("Prestige")+"</dt><dd>"+r.get_prestige()+"</dd><dt>"+city_builder.l("Influence")+"</dt><dd>"+this.core.get_city().get_influence_with_city(r.get_name())+"</dd></dl>"),$(i+" #tab-army").append(city_builder.ui.army_list(r.get_army_total())),$(i+" #tab-navy").append(city_builder.ui.navy_list(r.get_navy_total())),$(i+" #tab-imports").append("<p>"+city_builder.l("Below are the goods this city will be buying this year.")+"</p>"+city_builder.ui.trades_list(s,"imports")),$(i+" #tab-exports").append("<p>"+city_builder.l("Below are the goods this city will be selling this year.")+"</p>"+city_builder.ui.trades_list(s,"exports")),$(i).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.panel_rankings=function(e){return this.core=null,this.id="rankings",this.title=city_builder.l("Rankings"),this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.get_ranking=function(e){return void 0!==e&&"string"==typeof e?this.core.get_city(e).get_rank():void 0!==e&&"object"==typeof e?e.get_rank():this.core.get_city().get_rank()},this.__constructor=function(e){this.core=e.core;var t=this,i="#panel-"+this.id;city_builder.ui.panel_exists(i)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`"),$(i).remove(),$(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,this.title));for(var r in city_builder.CITIES)console.log(r+"="+this.get_ranking(r));return console.log(this.core.get_city().get_name()+"="+this.get_ranking(this.core.get_city())),$(i+" .contents").empty().append(""),$(i).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.panel_send_goods=function(e){return this.core=null,this.id="sendgoods",this.title=city_builder.l("Send Goods"),this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){this.core=e.core;var t=this,i="#panel-"+this.id;city_builder.ui.panel_exists(i)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`");var r=this.core.get_city();r.get_resources();$(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,this.title));return $(i+" .contents").empty().append(""),$(i).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.panel_declare_war=function(e){return this.core=null,this.id="declarewar",this.title=city_builder.l("Declare War"),this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){this.core=e.core;var t=this,i="#panel-"+this.id;city_builder.ui.panel_exists(i)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`");this.core.get_city(),e.data;$(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,this.title));return $(i+" .contents").empty().append(""),$(i).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.panel_world=function(e){return this.core=null,this.id="world",this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){var t=this;this.core=e.core;var i="#panel-"+this.id;city_builder.ui.panel_exists(i)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`");var r=this.core.get_city();$(".ui").append(city_builder.ui.worldmap_panel_template.replace(/{id}/g,this.id));var s=city_builder["CITY_LOCATION_"+r.get_climate().name.toUpperCase()],a='<div data-name="yourcity" class="tips city your" title="'+city_builder.l("City of")+" "+r.get_name()+'" style="left:'+s.x+"px;top:"+s.y+'px"></div>';for(var o in city_builder.CITIES)a+=city_builder.ui.city_worldmap_element(o);return $(i+" .contents .worldmap").empty().append(a),$(i).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}).on("click",".city",function(){var e=$(this).data("name")
;if("yourcity"===e)new city_builder.panel_advisor({core:t.core});else{var i=t.core.get_city(e);new city_builder.panel_city({core:t.core,data:i})}return!1}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.panel_advisor=function(e){return this.core=null,this.id="advisor",this.title=city_builder.l("Your City Advisor"),this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){this.core=e.core;var t="#panel-"+this.id,i=this;city_builder.ui.panel_exists(t)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`");var r=this.core.get_city();$(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,this.title));var s='<div class="tabs"><ul><li><a href="#tab-info">'+city_builder.l("Info")+'</a></li><li><a href="#tab-production">'+city_builder.l("Production")+'</a></li><li><a href="#tab-army">'+city_builder.l("Army")+'</a></li><li><a href="#tab-navy">'+city_builder.l("Navy")+'</a></li><li><a href="#tab-mercenary">'+city_builder.l("Mercenaries")+'</a></li><li><a href="#tab-diplomacy">'+city_builder.l("Diplomacy")+'</a></li></ul><div id="tab-info"><img class="avatar" src="'+city_builder.ASSETS_URL+"images/avatars/avatar"+r.get_avatar()+'.png" /><dl><dt>'+city_builder.l("Current date")+'</dt><dd class="citydate">'+this.core.get_date()+"</dd><dt>"+city_builder.l("Ruler")+"</dt><dd>"+r.get_ruler()+"</dd><dt>"+city_builder.l("Climate")+"</dt><dd>"+r.get_climate().name.capitalize()+"</dd><dt>"+city_builder.l("Personality")+"</dt><dd>"+r.get_personality().name.capitalize()+"</dd><dt>"+city_builder.l("Nationality")+"</dt><dd>"+r.get_nationality().name.capitalize()+"</dd><dt>"+city_builder.l("Level")+'</dt><dd class="citylevel">'+r.get_level()+"</dd><dt>"+city_builder.l("Prestige")+'</dt><dd class="cityprestige">'+r.get_prestige()+"</dd></dl>",a=r.call_advisor();if(a.length>0){s+="<p>"+city_builder.l("Your City Advisor recommends you to:")+'</p><ul class="advices">';for(var o=0;o<a.length;o++)s+="<li>"+a[o]+"</li>";s+="</ul>"}s+='</div><div id="tab-production"></div><div id="tab-army">';var n=this.core.get_city().is_building_built("camp")||this.core.get_city().is_building_built("castle");n!==!0&&(s+="<p>"+city_builder.l("You will need to construct a Military Camp or Castle before being able to recruit soldiers in your city.")+"</p>"),s+='<div class="army-list"></div><div class="army-recruiter">';for(var c in city_builder.SOLDIER_TYPES){s+="<fieldset><legend>"+c+'</legend><div class="cost"><dl class="nomg">';for(var l in city_builder.SOLDIER_TYPES[c].cost)s+="<dt>"+city_builder.SOLDIER_TYPES[c].cost[l]+'</dt><dd><img class="tips" title="'+city_builder.RESOURCES[l].name+'" src="'+city_builder.ASSETS_URL+"images/resources/"+l+'_small.png" /></dd>';s+='</dl></div><div class="info"><dl class="nomg"><dt>Attack</dt><dd>'+city_builder.SOLDIER_TYPES[c].attack+"</dd><dt>Defense</dt><dd>"+city_builder.SOLDIER_TYPES[c].defense+'</dd></dl></div><img data-handle="'+c+'" title="'+city_builder.l("Recruit")+" "+c+'" class="tips recruit-soldier" src="'+city_builder.ASSETS_URL+"images/armies/"+c.toLowerCase()+'.png" /></fieldset>'}s+='</div></div><div id="tab-navy">';var d=this.core.get_city().is_building_built("shipyard");d!==!0&&(s+="<p>"+city_builder.l("You will need to construct a Shipyard before being able to construct ships in your city.")+"</p>"),s+='<div class="navy-list"></div><div class="navy-recruiter">';for(var c in city_builder.SHIP_TYPES){s+="<fieldset><legend>"+c+'</legend><div class="cost"><dl class="nomg">';for(var l in city_builder.SHIP_TYPES[c].cost)s+="<dt>"+city_builder.SHIP_TYPES[c].cost[l]+'</dt><dd><img class="tips" title="'+city_builder.RESOURCES[l].name+'" src="'+city_builder.ASSETS_URL+"images/resources/"+l+'_small.png" /></dd>';s+='</dl></div><div class="info"><dl class="nomg"><dt>'+city_builder.l("Attack")+"</dt><dd>"+city_builder.SHIP_TYPES[c].attack+"</dd><dt>"+city_builder.l("Defense")+"</dt><dd>"+city_builder.SHIP_TYPES[c].defense+'</dd></dl></div><img data-handle="'+c+'" title="'+city_builder.l("Recruit")+" "+c+'" class="tips recruit-ship" src="'+city_builder.ASSETS_URL+"images/armies/"+c.toLowerCase()+'.png" /></fieldset>'}if(s+='</div></div><div id="tab-mercenary"><p>'+city_builder.l("Mercenary armies are available to hire for a fixed price, they do not cost additional resources but they are only available for raiding and campaign missions, they do not participate in the defense of your city.")+"</p><p>"+city_builder.l("Also, keep in mind that once a mercenary army is hired, they are at your disposal until the end of the current year.")+'</p><div class="hired-mercenaries-list">',r.mercenary.length>0){s+='<table class="normal">';for(var u=0;u<r.mercenary.length;u++){var h=city_builder.MERCENARIES[r.mercenary[u].id];s+='<tr><td class="icon"><img src="'+city_builder.ASSETS_URL+"images/armies/"+h.icon+'.png" /></td><td><p class="title">'+h.name+'</p><p class="description">'+h.description+'</p></td><td class="large"><a title="'+city_builder.l("View info on this mercenary army.")+'" data-id="'+r.mercenary[u].id+'" class="tips view-merc" href="#">'+city_builder.l("view")+'</a> <a title="'+city_builder.l("Send this mercenary army on a raiding mission. Depending on the success of the mission, they will return with coins and/or resources.")+'" data-id="'+u+'" class="tips raid-merc" href="#">'+city_builder.l("raid")+'</a> <a title="'+city_builder.l("Send this mercenary arm on a campaign towards a city. Depending on the success of the mission, they will return with prisoniers (future soldiers for your army), coins and/or resources. Winning a campaign will grant you fame and prestige.")+'" data-id="'+u+'" class="tips campaign-merc" href="#">'+city_builder.l("campaign")+'</a> <a title="'+city_builder.l("Disband this mercenary army? They will be available for hire later when you need them.")+'" data-id="'+u+'" class="tips disband-merc" href="#">'+city_builder.l("release")+"</a></td></tr>"}s+="</table>"}else s+="<p>"+city_builder.l("You have no mercenary armies hired for your city. Go to the World Market Trades and hire one.")+"</p>";s+='</div></div><div id="tab-diplomacy">';var _=this.core.get_city().is_building_built("embassy");_!==!0&&(s+="<p>"+city_builder.l("You will need to construct an Embassy before being able to propose treaties and pacts to other cities.")+"</p>");var p=this.core.get_cities();s+='<div class="cities-list"><table class="normal">';for(var u=1;u<p.length;u++){s+='<tr><td class="icon"><img src="'+city_builder.ASSETS_URL+"images/avatars/avatar"+p[u].get_avatar()+'.png" /></td><td><p class="title">'+p[u].get_name()+'</p><p class="description">'+city_builder.l("Leader")+": "+p[u].get_ruler()+" "+city_builder.l("Personality")+": "+p[u].get_personality().name+"</p>";var y=this.core.get_city().get_influence();y=y[p[u].get_name()];var m="";y<20?m=" vbad":y>=20&&y<50?m=" bad":y>=50&&y<80?m=" good":y>=80&&(m=" vgood"),s+='<div class="progress"><span style="width:'+y+'%" class="bar'+m+'"></span></div>',s+='</td><td class="large"><a data-name="'+p[u].get_name()+'" title="'+city_builder.l("View info about this city.")+'" class="tips view-city" href="#">'+city_builder.l("view")+'</a> <a data-name="'+p[u].get_name()+'" title="'+city_builder.l("Propose a pact to this city`s ruler.")+'" class="tips pact" href="#">'+city_builder.l("pact")+'</a> <a data-name="'+p[u].get_name()+'" title="'+city_builder.l("Send goods to this city.")+'" data-id="'+u+'" class="tips send-goods" href="#">'+city_builder.l("send goods")+'</a> <a data-name="'+p[u].get_name()+'" title="'+city_builder.l("Declare war to this city.")+'" data-id="'+u+'" class="tips declare-war" href="#">'+city_builder.l("declare war")+"</a></td></tr>"}return s+="</table></div></div></div>",$(t+" .contents").append(s),this._refresh_army(),this._refresh_navy(),$(t).on("click",".pact",function(){if(_===!0){var e=$(this).data("name");i.core.get_city().get_influence_with_city(e)>=50?(i.core.get_city().propose_pact(e),$(".tipsy").remove()):i.core.error(city_builder.l("Your influence on")+" "+e+" "+city_builder.l("is too low to propose a pact."))}else i.core.error(city_builder.l("You will need to construct an Embassy before being able to propose treaties and pacts to other cities."));return!1}).on("click",".recruit-ship",function(){if(d===!0){var e=$(this).data("handle");i.core.get_city().recruit_ship(e)===!0&&i._refresh_navy(),$(".tipsy").remove()}else i.core.error(city_builder.l("You will need to construct a Shipyard before being able to construct ships in your city."));return!1}).on("click",".declare-war",function(){var e=$(this).data("name"),t=i.core.get_city(e);return new city_builder.panel_declare_war({core:i.core,data:t}),!1}).on("click",".send-goods",function(){var e=$(this).data("name"),t=i.core.get_city(e);return new city_builder.panel_send_goods({core:i.core,data:t}),!1}).on("click",".view-city",function(){var e=$(this).data("name"),t=i.core.get_city(e);return new city_builder.panel_city({core:i.core,data:t}),!1}).on("click",".recruit-soldier",function(){if(n===!0){var e=$(this).data("handle");i.core.get_city().recruit_soldier(e)===!0&&i._refresh_army(),$(".tipsy").remove()}else i.core.error(city_builder.l("You will need to construct a Military Camp or Castle before recruiting soldiers in your city."));return!1}).on("click",".view-merc",function(){var e=$(this).data("id"),t=city_builder.MERCENARIES[e];return new city_builder.panel_army({core:i.core,data:t}),$(".tipsy").remove(),!1}).on("click",".close",function(){return i.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(t+" .tabs").tabs(),$(t+" .tips").tipsy({gravity:"s"}),this},this._refresh_army=function(){var e=this.core.get_city(),t="#panel-"+this.id,i="<fieldset><legend>"+city_builder.l("Current Army")+"</legend>"+city_builder.ui.army_list(e.get_army_total(),!0)+"</fieldset>";return $(t+" .army-list").empty().append(i),this},this._refresh_navy=function(){var e=this.core.get_city(),t="#panel-"+this.id,i="<fieldset><legend>"+city_builder.l("Current Navy")+"</legend>"+city_builder.ui.navy_list(e.get_navy_total(),!0)+"</fieldset>";return $(t+" .navy-list").empty().append(i),this},this.__constructor(e)},city_builder.panel_army=function(e){return this.core=null,this.id="army",this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){var t=this;this.core=e.core;var i="#panel-"+this.id;city_builder.ui.panel_exists(i)&&this.destroy();var r=e.data;return this.core.console_log("creating panel with id `"+this.id+"`"),$(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,r.name)),$(i+" .contents").append(city_builder.ui.tabs(["Info","Soldiers"])),$(i+" #tab-info").append('<img class="avatar" src="'+city_builder.ASSETS_URL+"images/armies/"+r.icon+'.png" /><p>'+r.description+"</p>"),$(i+" #tab-soldiers").append(city_builder.ui.army_list(r)),$(i).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.panel_trades=function(e){return this.core=null,this.id="trades",this.title=city_builder.l("World Market Trades"),this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){this.core=e.core;var t="#panel-"+this.id,i=this;city_builder.ui.panel_exists(t)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`");var r=this.core.get_city(),s="";return $(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,this.title)),s+=city_builder.ui.tabs([city_builder.l("Imports"),city_builder.l("Exports"),city_builder.l("Mercenaries"),city_builder.l("BlackMarket")]),$(t+" .contents").append(s),$(t+" #tab-imports").append("<p>"+city_builder.l("Below is a list of goods that the other cities in the world are looking to buy. The goods replenish yearly, so plan accordingly.")+'</p><div class="contents"></div>'),$(t+" #tab-exports").append("<p>"+city_builder.l("Below is a list of goods that the other cities in the world are looking to sell. The goods replenish yearly, so plan accordingly.")+'</p><div class="contents"></div>'),$(t+" #tab-mercenaries").append("<p>"+city_builder.l("Below is a list of mercenary armies that are looking for hire. Mercenaries are available only for raiding and conquest missions, they do not join your city so they will not participate in defense.")+'</p><div class="contents"></div>'),$(t+" #tab-blackmarket").append("<p>"+city_builder.l("The Black Market is a way to dump your excess materials when you`re in need of emptying your warehouses, but expect a steep price drop (you get ")+(100-city_builder.BLACK_MARKET_DISCOUNT)+city_builder.l("% of the actual price). The goods will be taken immediately from your warehouses but you will receive the coins next month. Also, you get no prestige from Black Market trades.")+'</p><div class="contents"></div>'),this._refresh_imports(),this._refresh_exports(),this._refresh_mercenaries(),this._build_black_market(),$(t).on("click",".buy:not(.disabled)",function(){var e=$(this).data("city"),t=$(this).data("resource");return r.buy_from_city(e,t)!==!1&&i._refresh_exports(),$(".tipsy").remove(),!1}).on("click",".sell:not(.disabled)",function(){var e=$(this).data("city"),t=$(this).data("resource");return r.sell_to_city(e,t)!==!1&&i._refresh_imports(),$(".tipsy").remove(),!1}).on("click",".bmarket",function(){var e=$(".bm-materials").val(),t=$(".bm-quantity").val();return"0"!==e&&(r.list_black_market(e,t),i._refresh_black_market(),$(".bm-quantity").val("")),$(".tipsy").remove(),!1}).on("click",".recruit:not(.disabled)",function(){var e=$(this).data("handle");return r.recruit_mercenary_army(e)!==!1&&i._refresh_mercenaries(),$(".tipsy").remove(),!1}).on("click",".view-army:not(.disabled)",function(){var e=$(this).data("id"),t=city_builder.MERCENARIES[e];return new city_builder.panel_army({core:i.core,data:t}),$(".tipsy").remove(),!1}).on("click",".close",function(){return i.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(t+" .tabs").tabs(),$(t+" .tips").tipsy({gravity:"s"}),this},this._build_black_market=function(){var e=(this.core.get_cities(),'<table class="normal">');return e+='<thead><tr><td><select class="bm-materials"></select></td><td><input type="text" class="bm-quantity" /></td><td><a title="'+city_builder.l("List goods on Black Market")+'" class="tips bmarket" href="#">'+city_builder.l("list")+"</a></td></tr></thead>",e+="<tbody></tbody></table>",$("#tab-blackmarket > .contents").empty().append(e),this._refresh_black_market_materials(),this._refresh_black_market(),this},this._refresh_black_market=function(){var e="",t=this.core.get_black_market();for(var i in t)e+="<tr><td>"+city_builder.l("Amount")+": "+t[i].amount+city_builder.ui.resource_small_img(i)+"</td><td>"+city_builder.l("Total price")+": "+t[i].price+city_builder.ui.resource_small_img("coins")+"</td><td>&nbsp;</td></tr>";return $("#tab-blackmarket > .contents > table > tbody").empty().append(e),this},this._refresh_black_market_materials=function(){var e='<option value="0">-- '+city_builder.l("select")+" --</option>",t=this.core.get_city(),i=t.get_resources();for(var r in i)"fame"!==r&&"coins"!==r&&(e+='<option value="'+r+'"> '+city_builder.RESOURCES[r].name+"</option>");return $(".bm-materials").empty().append(e),this},this._refresh_imports=function(){for(var e=this.core.get_cities(),t='<table class="normal">',i=0;i<e.length;i++){var r=e[i].get_trades();if(null!==r){var s=r.imports;for(var a in s){var o=city_builder.RESOURCES[a].price*city_builder.TRADES_DISCOUNT/100;t+="<tr><td>"+e[i].get_name()+"</td><td>"+city_builder.ui.resource_small_img(a)+"</td><td>"+s[a]+"</td><td>"+Math.round(city_builder.RESOURCES[a].price-o)+city_builder.ui.resource_small_img("coins")+"</td><td>"+Math.round((city_builder.RESOURCES[a].price-o)*s[a])+city_builder.ui.resource_small_img("coins")+'</td><td><a title="'+city_builder.l("Sell those goods")+'" data-resource="'+a+'" data-city="'+e[i].get_name()+'" class="tips sell'+(0===s[a]?" disabled":"")+'" href="#">'+city_builder.l("sell")+"</a></td></tr>"}}}return t+="</table>",$("#tab-imports > .contents").empty().append(t),this},this._refresh_mercenaries=function(){for(var e='<table class="mercenaries">',t=0;t<city_builder.MERCENARIES.length;t++)e+='<tr><td class="icon"><img src="'+city_builder.ASSETS_URL+"images/armies/"+city_builder.MERCENARIES[t].icon+'.png" /></td><td><p class="title">'+city_builder.MERCENARIES[t].name+'</p><p class="description">'+city_builder.MERCENARIES[t].description+"</p></td><td>"+city_builder.MERCENARIES[t].cost+city_builder.ui.resource_small_img("coins")+'</td><td><a title="'+city_builder.l("View info on this mercenary army")+'" data-id="'+t+'" class="tips view-army" href="#">view</a> '+city_builder.ui.panel_btn("recruit",city_builder.l("Recruit this mercenary army"),city_builder.MERCENARIES[t].handle,"recruit",this.core.get_city().is_mercenary_recruited(city_builder.MERCENARIES[t].handle))+"</tr>";return e+="</table>",$("#tab-mercenaries > .contents").empty().append(e),this},this._refresh_exports=function(){for(var e=this.core.get_cities(),t='<table class="normal">',i=0;i<e.length;i++){var r=e[i].get_trades();if(null!==r){var s=r.exports;for(var a in s){var o=city_builder.RESOURCES[a].price*city_builder.TRADES_ADDITION/100;t+="<tr><td>"+e[i].get_name()+"</td><td>"+city_builder.ui.resource_small_img(a)+"</td><td>"+s[a]+"</td><td>"+Math.round(city_builder.RESOURCES[a].price+o)+city_builder.ui.resource_small_img("coins")+"</td><td>"+Math.round((city_builder.RESOURCES[a].price+o)*s[a])+city_builder.ui.resource_small_img("coins")+'</td><td><a title="'+city_builder.l("Buy those goods")+'" data-resource="'+a+'" data-city="'+e[i].get_name()+'" class="tips buy'+(0===s[a]?" disabled":"")+'" href="#">'+city_builder.l("buy")+"</a></td></tr>"}}}return t+="</table>",$("#tab-exports > .contents").empty().append(t),this},this.__constructor(e)},city_builder.panel_window=function(e){return this.core=null,this.id=null,this.__destructor=function(){this.core.console_log("destroying panel with id `"+this.id+"`");var e="#panel-"+this.id;return $(e).remove(),$(".tipsy").remove(),!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){$(".panel.pw").remove(),this.core=e.core,this.id=e.id;var t=this,i="#panel-"+this.id;city_builder.ui.panel_exists(i)&&this.destroy(),this.core.console_log("creating panel with id `"+this.id+"`"),$(".ui").append(city_builder.ui.generic_panel_template.replace(/{id}/g,this.id).replace(/{title}/g,e.header));var r=city_builder.ui.normal_panel(city_builder.l("Background Music"),'<a href="#" class="music-control paused"></a>');return $(i+" .contents").append(r),$(i).on("click",".music-control",function(){return t.core.music.paused===!0?($(this).removeClass("paused").addClass("playing"),t.core.music.play()):($(this).removeClass("playing").addClass("paused"),t.core.music.pause()),!1}).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel"}),$(i+" .tabs").tabs(),$(i+" .tips").tipsy({gravity:"s"}),this},this.__constructor(e)},city_builder.soldier=function(e){return this.city=null,this.attack=0,this.defense=0,this.cost=null,this.name=null,this.__destructor=function(){return!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){return this.city=e.city,this.name=e.name,this.attack=e.data.attack,this.defense=e.data.defense,this.cost=e.data.cost,this},this.get_attack=function(){return this.attack},this.get_defense=function(){return this.defense},this.get_cost=function(){return this.cost},this.get_city=function(){return this.city},this.get_name=function(){return this.name},this.get_core=function(){return this.get_city().get_core()},this.__constructor(e)},city_builder.ship=function(e){return this.city=null,this.attack=0,this.defense=0,this.cost=null,this.name=null,this.__destructor=function(){return!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){return this.city=e.city,this.name=e.name,this.attack=e.data.attack,this.defense=e.data.defense,this.cost=e.data.cost,this},this.get_attack=function(){return this.attack},this.get_defense=function(){return this.defense},this.get_cost=function(){return this.cost},this.get_city=function(){return this.city},this.get_name=function(){return this.name},this.get_core=function(){return this.get_city().get_core()},this.__constructor(e)},city_builder.army=function(e){return this.city=null,this.cost=null,this.name=null,this.soldiers=[],this.ships=[],this.__destructor=function(){return!1},this.destroy=function(){return this.__destructor()},this.__constructor=function(e){return this.city=e.city,this.name=e.name,this.cost=e.data.cost,this},this.get_city=function(){return this.city},this.get_name=function(){return this.name},this.get_core=function(){return this.get_city().get_core()},this.__constructor(e)},city_builder.game=function(){return this.cities=[],this.music=null,this.day=1,this.year=1,this.month=1,this.day_of_month=1,this.black_market={},this.api=null,this.jailer=null,this.settings={},this.__constructor=function(){var e,t,i=!1,r=this;this.jailer=new city_builder.jailer({core:this}),this.setup_audio(),$(".game").on({mousemove:function(e){i&&s(e)},mousedown:function(r){i=!0,e=r.pageY,t=r.pageX,$("html").css("cursor","-moz-grab")},mouseup:function(){i=!1,$("html").css("cursor","auto")}});var s=function(i){$(window).scrollTop($(window).scrollTop()+(e-i.pageY)),$(window).scrollLeft($(window).scrollLeft()+(t-i.pageX))};return this._setup_start_ui(),this._setup_toolbar(),null!==localStorage.getItem("city_builder.data")&&this.start_game(),$(".toolbar").on("click",".do-options",function(){return new city_builder.panel_window({core:r,id:"options",header:"Game Options",type:"window"}),!1}).on("click",".do-worldmap",function(){return new city_builder.panel_world({core:r}),!1}).on("click",".do-trades",function(){return new city_builder.panel_trades({core:r}),!1}).on("click",".do-rankings",function(){return new city_builder.panel_rankings({core:r}),!1}).on("click",".do-advisor",function(){return new city_builder.panel_advisor({core:r}),!1}).on("click",".do-storage",function(){return new city_builder.panel_storage({core:r}),!1}).on("click",".do-build",function(){return new city_builder.panel_buildings({core:r}),!1}),$(".console").on("click",".down",function(){$(".console .contents").scrollTo("+=97px",500)}).on("click",".up",function(){$(".console .contents").scrollTo("-=97px",500)}),this.api=new city_builder.api({core:this}),this},this.get_api=function(){return this.api},this.get_jailer=function(){return this.jailer},this.add_black_market=function(e,t,i){return this.black_market[e]={resource:e,amount:t,price:i},this.black_market},this.set_storage_data=function(e,t){return localStorage.setItem(city_builder.STORAGE_KEY+"."+e,t),this},this.get_storage_data=function(e){return localStorage.getItem(city_builder.STORAGE_KEY+"."+e)},this.set_settings=function(e,t){return this.settings[e]=t,this},this.get_settings=function(e){return this.settings[e]},this.reset_black_market=function(){var e=0;for(var t in this.black_market)this.get_city().inc_coins_amount(this.black_market[t].price),e+=this.black_market[t].price;return this.black_market={},this.refresh_ui(),$("#tab-blackmarket > .contents > table > tbody").empty(),e>0&&this.notify(this.get_city().get_name()+" "+city_builder.l("received")+" "+e+" "+city_builder.l("coins from the Black Market for selling goods."),city_builder.l("Black Market")),this},this.get_black_market=function(){return this.black_market},this.set_black_market=function(e){return this.black_market=void 0!==e?e:{},this},this._setup_start_ui=function(){for(var e=this,t=1,i=1;i<city_builder.CLIMATE_TYPES.length;i++)$(".start .climate").append('<option value="'+city_builder["CLIMATE_TYPE_"+city_builder.CLIMATE_TYPES[i].toUpperCase()]+'">'+city_builder.CLIMATE_TYPES[i].capitalize()+"</option>");for(var i=1;i<city_builder.NATION_TYPES.length;i++)$(".start .nation").append('<option value="'+city_builder["NATION_TYPE_"+city_builder.NATION_TYPES[i].toUpperCase()]+'">'+city_builder.NATION_TYPES[i].capitalize()+"</option>");for(var i=1;i<=city_builder.AVATARS;i++)$(".start .avatar-select").append('<img src="'+city_builder.ASSETS_URL+"images/avatars/avatar"+i+'.png" />');return $(".start").on("click",".do-start",function(){var i=$(".start .name").val(),r=$(".start .cityname").val(),s=$(".start .nation").val(),a=$(".start .climate").val();return""===i?(e.error("Enter your ruler name, for example <strong>Ramses</strong>.","Error",!0),!1):""===r?(e.error("Enter your city name, for example <strong>Alexandria</strong>.","Error",!0),!1):(e.start_game(i,r,s,a,t),!1)}).on("click",".down",function(){t<city_builder.AVATARS&&(t+=1),$(".start .avatar-select").scrollTo("+=64px",500)}).on("click",".up",function(){t>1&&(t-=1),$(".start .avatar-select").scrollTo("-=64px",500)}),this},this.start_game=function(e,t,i,r,s){var a=this,o=null;return null!==localStorage.getItem("city_builder.data")?o=this._load_main_city():this._setup_main_city(e,t,i,r,s),this.setup_neighbours(o),this.save(),localStorage.getItem("city_builder.data"),$("section.start").remove(),$("header .cityname").html(this.get_city().get_name()),$("header .cityavatar").css({"background-image":"url("+city_builder.ASSETS_URL+"images/avatars/avatar"+this.get_city().get_avatar()+".png)"}),this.refresh_ui(),setInterval(function(){a._do_daily()},12e3),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0}),this},this.set_date_time=function(e){return this.day=e.day,this.month=e.month,this.year=e.year,this.day_of_month=e.day_of_month,this},this.setup_audio=function(){return this.music=$("#music").get(0),this.music.volume=.2,city_builder.AUTOSTART_MUSIC===!0&&this.music.play(),this},this.get_city=function(e){if(void 0===e||"string"!=typeof e)return this.cities[0];for(var t=this.get_cities(),i=0;i<t.length;i++){var r=t[i];if(r.get_name()===e)return r}return!1},this._load_main_city=function(){var e=JSON.parse(window.atob(localStorage.getItem("city_builder.data"))),t=new city_builder.city({name:e.name,data:{nationality:e.nationality,ruler:e.ruler,climate:e.climate,personality:city_builder.PERSONALITY_TYPE_BALANCED,avatar:e.avatar,level:e.level},core:this});return t.import_data(e),this.cities.push(t),this.get_city()._create_buildings(e.buildings),e},this._setup_main_city=function(e,t,i,r,s){var a=new city_builder.city({name:t,data:{nationality:i,ruler:e,climate:r,personality:city_builder.PERSONALITY_TYPE_BALANCED,avatar:s},core:this});return this.cities.push(a),this.get_city()._create_buildings(city_builder.BUILDINGS_START),this},this.get_building_config_data=function(e){if("string"==typeof e)return city_builder.BUILDINGS[city_builder.BUILDINGS.findIndexM(e)];if("number"!=typeof e)return!1;for(var t=0;t<city_builder.BUILDINGS.length;t++)if(city_builder.BUILDINGS[t].handle===e)return city_builder.BUILDINGS[t]},this._do_daily=function(){this.day++,this.log("day "+this.day_of_month+" month "+this.month+" year "+this.year);for(var e=this.get_city().get_buildings(),t=0;t<e.length;t++)void 0!==e[t]&&e[t].process();var i=city_builder.EVENTS[get_random(0,city_builder.EVENTS.length-1)];return i.core=this,new city_builder.event(i),this.calculate_storage(),this.refresh_ui(),this.day_of_month++,this.day_of_month>30&&this._do_monthly(),this.day>=360&&(this._do_yearly(),this.day=1,this.month=1),this.save(),this},this.save=function(){return this.get_city().export_data(!0),this},this._do_monthly=function(){return this.day_of_month=1,this.month++,this.reset_black_market(),this},this._do_yearly=function(){for(var e=this.get_cities(),t=1;t<e.length;t++)e[t].reset_trades(),this.get_city().lower_influence(e[t].get_name(),city_builder.YEARLY_INFLUENCE_LOSS);return this.get_city().release_mercenaries(),this.year++,this},this.log=function(e,t){return void 0!==e?$(".ui .console .contents").prepend("<div"+(void 0!==t&&t===!0?' class="error"':"")+"><span>"+city_builder.utils.get_now()+"</span> - "+e+"</div>"):$(".ui .console .contents").prepend('<div class="separator"></div>'),this},this.console_log=function(e,t){return city_builder.DEBUG===!0&&console.log((typeof t===!0?"APP error: ":"APP message: ")+e),this},this.get_date=function(){return"day "+this.day_of_month+" month "+this.month+" year "+this.year},this.notify=function(e,t,i){return this._notify({title:void 0!==t?t:"Message",content:e,timeout:void 0!==i?i:15e3}),this.log(e),this},this._notify=function(e){function t(e){var t=[[2,"One second","1 second from now"],[60,"seconds",1],[120,"One minute","1 minute from now"],[3600,"minutes",60],[7200,"One hour","1 hour from now"],[86400,"hours",3600],[172800,"One day","tomorrow"],[604800,"days",86400],[1209600,"One week","next week"],[2419200,"weeks",604800],[4838400,"One month","next month"],[29030400,"months",2419200],[58060800,"One year","next year"],[290304e4,"years",29030400],[580608e4,"One century","next century"],[580608e5,"centuries",290304e4]],i=(new Date-e)/1e3,r=1;i<0&&(i=Math.abs(i),r=1);for(var s,a=0;s=t[a++];)if(i<s[0])return"string"==typeof s[2]?s[r]:Math.floor(i/s[2])+" "+s[1];return e}var i,r,s,a,o,n,c;e=$.extend({title:void 0,content:void 0,timeout:15e3,img:city_builder.ASSETS_URL+"images/ui/icon1.png",showTime:!0,error:!1,other:!1},e),i=$(".notifications"),i.length||(i=$("<div>",{class:"notifications"}).appendTo(document.body)),r=$("<div>"),r.addClass("notty"),s=$("<div>",{click:function(){$(this).parent().delay(300).queue(function(){$(this).clearQueue(),$(this).remove()})},touchstart:function(){$(this).parent().delay(300).queue(function(){$(this).clearQueue(),$(this).remove()})}}),s.addClass("hide"),e.error===!0&&(r.addClass("error"),e.img=city_builder.ASSETS_URL+"images/ui/icon2.png"),e.other===!0&&(r.addClass("other"),e.img=city_builder.ASSETS_URL+"images/ui/city.png"),a=$("<div>",{style:"background: url('"+e.img+"')"}),a.addClass("img"),n=$("<div class='left'>"),o=$("<div class='right'>");var l="<h2>"+e.title+"</h2>",d=e.content;c=$("<div>",{html:l+d}),c.addClass("inner"),c.appendTo(o),a.appendTo(n),n.appendTo(r),o.appendTo(r),s.appendTo(r);var u=Number(new Date),h=$("<div>",{html:"<strong>"+t(u)+"</strong> ago"});return h.addClass("time").attr("title",u),h.appendTo(o),setInterval(function(){$(".time").each(function(){var e=$(this).attr("title");$(this).html("<strong>"+t(e)+"</strong> ago")})},4e3),r.hover(function(){s.show()},function(){s.hide()}),r.prependTo(i),r.show(),e.timeout&&setTimeout(function(){r.delay(300).queue(function(){$(this).clearQueue(),$(this).remove()})},e.timeout),this},this.error=function(e,t,i){return this._notify({title:void 0!==t?t:"Error",error:!0,content:e}),void 0!==i&&i!==!1||this.log(e,!0),this},this.calculate_storage=function(){var e=this.get_city().get_storage_space();return e.occupied>=e.all?this.error("You ran out of storage space and all goods produced will be lost. Upgrade your warehouse or marketplace.","No storage space"):e.all-e.occupied<100&&this.error("You will soon run out of storage space and all goods produced will be lost. Upgrade your warehouse or marketplace.","Storage nearly full"),e},this.refresh_ui=function(){var e=this.get_city(),t=e.get_storage_space(),i=city_builder.LEVELS[e.get_level()]
;$(".citylevel").html(e.get_level()),$(".cityprestige").html(e.get_prestige());for(var r=0;r<city_builder.TOOLBAR_RESOURCES.length;r++){var s=city_builder.TOOLBAR_RESOURCES[r],a=$(".top-panel ."+s);void 0!==e.resources[s]&&a.attr("title",e.resources[s].storage+" "+e.resources[s].name)}if(e.get_fame_amount()>=i&&e.level_up(),$("header .cityfame > span").css({width:100*e.get_fame_amount()/i+"%"}),$("#panel-storage").length)for(var s in city_builder.RESOURCES)"fame"!==s&&$("#panel-storage div.item-"+s+" span.amount").html(e.resources[s].storage);return $(".citydate").empty().append(this.get_date()),$(".citystorage").html(t.occupied),$(".top-panel > span").tipsy({gravity:"n"}),this},this.get_cities=function(){return this.cities},this.setup_neighbours=function(e){var t=null;for(var i in city_builder.CITIES)t=new city_builder.city({name:i,data:city_builder.CITIES[i],core:this}),t._create_buildings(city_builder.BUILDINGS_ALL,!0),t.setup_army(!0),t.setup_navy(!0),null!==e?(this.get_city().influence[i]=e.influence[i],t.trades=e.trades[i]):this.get_city().influence[i]=50,this.cities.push(t);return this},this._get_neighbours_trades=function(){for(var e={},t=this.get_cities(),i=1;i<t.length;i++)e[t[i].get_name()]=t[i].get_trades();return e},this._setup_toolbar=function(){for(var e="",t=0;t<city_builder.TOOLBAR_RESOURCES.length;t++)e+='<span class="'+city_builder.TOOLBAR_RESOURCES[t]+'"></span>';return $(".top-panel").empty().append(e),this},this.get_version=function(){return city_builder.VERSION},this.__constructor()},$(document).ready(function(){new city_builder.game});