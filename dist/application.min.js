/*!
 * Civitas empire-building game.
 *
 * @author sizeof(cat) <sizeofcat AT riseup.net>
 * @version 0.1.0.482017
 * @license MIT
 */ "use strict";if(Array.prototype.findIndexM=function(e){for(var t=0;t<this.length;t++)if(this[t].handle===e)return t;return!1},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},void 0===civitas)var civitas={};void 0===civitas.objects&&(civitas.objects={}),void 0===civitas.controls&&(civitas.controls={}),void 0===civitas.modules&&(civitas.modules={}),civitas.l=function(e){return void 0!==civitas.lang[e]&&""!==civitas.lang[e]?civitas.lang[e]:e},civitas.AUTOSTART_MUSIC=!1,civitas.MAX_SETTLEMENT_LEVEL=40,civitas.ASSETS_URL="./",civitas.YEARLY_INFLUENCE_LOSS=2,civitas.YEARLY_INFLUENCE_GAIN=2,civitas.SECONDS_TO_DAY=10,civitas.AVATARS=48,civitas.TRADES_ADDITION=10,civitas.TRADES_DISCOUNT=20,civitas.POPULATION_PER_LEVEL=23e4,civitas.BLACK_MARKET_DISCOUNT=80,civitas.WORLDMAPS=4,civitas.TOOLBAR_RESOURCES=["coins","wood","stones","woodplanks","wheat","bread","cattle","meat","iron","weapons"],civitas.LEVELS=[0,100,500,1e3,3e3,6500,12e3,2e4,3e4,45e3,6e4,85e3,1e5,14e4,18e4,22e4,29e4,35e4,4e5,5e5,61e4,73e4,8e5,93e4,11e5,13e5,15e5,18e5,25e5,3e6,4e6,55e5,65e5,8e6,9e6,1e7,12e6,16e6,2e7,5e7],civitas.VERSION="0.1."+((new Date).getMonth()+1)+(new Date).getDate()+(new Date).getFullYear(),civitas.DEBUG=!0,civitas.STORAGE_KEY="civitas",civitas.IMPORTANCE_VITAL=50,civitas.IMPORTANCE_HIGH=30,civitas.IMPORTANCE_MEDIUM=20,civitas.IMPORTANCE_LOW=10,civitas.DIFFICULTY_EASY=1,civitas.DIFFICULTY_MEDIUM=2,civitas.DIFFICULTY_HARD=3,civitas.DIFFICULTY_HARDCORE=4,civitas.NOTIFICATION_MISSING_RESOURCES=1,civitas.NOTIFICATION_PRODUCTION_PAUSED=2,civitas.NOTIFICATION_SETTLEMENT_LOW_LEVEL=3,civitas.MODE_SINGLEPLAYER=0,civitas.MODE_MULTIPLAYER=1,civitas.lang={},civitas.START_ARMY=[{army:{Militia:10,Axeman:2,Bowman:4},navy:{Corsair:2,Caravel:1}},{army:{Militia:5,Axeman:1,Bowman:2},navy:{Corsair:1,Caravel:1}},{army:{Militia:3,Bowman:2},navy:{Corsair:1}},{army:{},navy:{}}],civitas.START_BUILDINGS=[{handle:"marketplace",level:1},{handle:"lumberjack",level:1},{handle:"stone",level:1},{handle:"house1",level:1},{handle:"house2",level:1}],civitas.START_RESOURCES=[{coins:5e4,fame:0,faith:1,prestige:1,espionage:1,research:1,bread:300,meat:100,stones:100,weapons:100,wheat:40,wood:100,woodplanks:50},{coins:2e4,fame:0,faith:1,prestige:1,espionage:1,research:1,bread:300,meat:100,stones:100,weapons:60,wheat:40,wood:100,woodplanks:30},{coins:1e4,fame:0,faith:1,prestige:1,espionage:1,research:1,bread:300,meat:100,stones:70,wheat:40,wood:70,woodplanks:20},{coins:5e3,fame:0,faith:1,prestige:1,espionage:1,research:1,bread:100,meat:50,stones:50,wheat:40,wood:50}],civitas.RELIGIONS=["none","christianity","islam","judaism","buddhism","hinduism","confucianism","taoism"],civitas.RELIGION_NONE=0,civitas.RELIGION_CHRISTIANITY=1,civitas.RELIGION_ISLAM=2,civitas.RELIGION_JUDAISM=3,civitas.RELIGION_BUDDHISM=4,civitas.RELIGION_HINDUISM=5,civitas.RELIGION_CONFUCIANISM=6,civitas.RELIGION_TAOISM=7,civitas.MAX_FAITH_VALUE=1e3,civitas.DIPLOMACIES=["truce","war","pact","alliance","cease fire","pact proposed","alliance proposed","cease fire proposed"],civitas.CAMPAIGN_ARMY=1,civitas.CAMPAIGN_CARAVAN=2,civitas.DIPLOMACY_TRUCE=0,civitas.DIPLOMACY_WAR=1,civitas.DIPLOMACY_PACT=2,civitas.DIPLOMACY_ALLIANCE=3,civitas.DIPLOMACY_CEASE_FIRE=4,civitas.DIPLOMACY_PROPOSE_PACT=5,civitas.DIPLOMACY_PROPOSE_ALLIANCE=6,civitas.DIPLOMACY_PROPOSE_CEASE_FIRE=7,civitas.EXPORT_INFLUENCE=2,civitas.IMPORT_INFLUENCE=1,civitas.EXPORT_PRESTIGE=2,civitas.IMPORT_PRESTIGE=1,civitas.MAX_PRESTIGE_VALUE=1e3,civitas.MAX_RESEARCH_VALUE=1e3,civitas.MAX_ESPIONAGE_VALUE=1e3,civitas.MAX_INFLUENCE_VALUE=1e3,civitas.NATIONS=["none","phoenician","carthaginian","greek","egyptian","assyrian","roman","thracian","sudanese","spanish","sumerian","chinese","indian","franks","russian","nigerian","malinese","mongolian","tibetan","persan","khmer","japanese","french"],civitas.NATION_PHOENICIAN=1,civitas.NATION_CARTHAGINIAN=2,civitas.NATION_GREEK=3,civitas.NATION_EGYPTIAN=4,civitas.NATION_ASSYRIAN=5,civitas.NATION_ROMAN=6,civitas.NATION_THRACIAN=7,civitas.NATION_SUDANESE=8,civitas.NATION_SPANISH=9,civitas.NATION_SUMERIAN=10,civitas.NATION_CHINESE=11,civitas.NATION_INDIAN=12,civitas.NATION_FRANKS=13,civitas.NATION_RUSSIAN=14,civitas.NATION_NIGERIAN=15,civitas.NATION_MALINESE=16,civitas.NATION_MONGOLIAN=17,civitas.NATION_TIBETAN=18,civitas.NATION_PERSAN=19,civitas.NATION_KHMER=20,civitas.NATION_JAPANESE=21,civitas.NATION_FRENCH=22,civitas.CLIMATES=["none","temperate","tropical","arid","polar"],civitas.CLIMATE_TEMPERATE=1,civitas.CLIMATE_TROPICAL=2,civitas.CLIMATE_ARID=3,civitas.CLIMATE_POLAR=4,civitas.SETTLEMENT_LOCATION_TEMPERATE={x:500,y:500},civitas.SETTLEMENT_LOCATION_TROPICAL={x:500,y:450},civitas.SETTLEMENT_LOCATION_ARID={x:500,y:300},civitas.SETTLEMENT_LOCATION_POLAR={x:500,y:60},civitas.PERSONALITIES=["none","balanced","diplomat","warlord"],civitas.PERSONALITY_BALANCED=1,civitas.PERSONALITY_DIPLOMAT=2,civitas.PERSONALITY_WARLORD=3,civitas.SOLDIERS={Militia:{id:civitas.SOLDIER_MILITIA,attack:2,defense:1,cost:{coins:100,bread:1,meat:1,weapons:1}},Axeman:{id:civitas.SOLDIER_AXEMAN,attack:3,defense:2,cost:{coins:300,bread:1,meat:1,weapons:2}},Bowman:{id:civitas.SOLDIER_BOWMAN,attack:6,defense:1,cost:{coins:500,bread:1,meat:1,weapons:4}},Pikeman:{id:civitas.SOLDIER_PIKEMAN,attack:5,defense:4,cost:{coins:700,provisions:1,iron:1,leather:1,weapons:5,armor:1}},Crossbowman:{id:civitas.SOLDIER_CROSSBOWMAN,attack:7,defense:2,cost:{coins:1e3,provisions:2,clothes:1,iron:1,weapons:7,armor:1}},Knight:{id:civitas.SOLDIER_KNIGHT,attack:6,defense:9,cost:{coins:1500,provisions:3,clothes:1,iron:1,weapons:9,armor:4}},Legionnaire:{id:civitas.SOLDIER_LEGIONNAIRE,attack:12,defense:14,cost:{coins:2500,provisions:6,leather:2,iron:2,weapons:12,armor:12}}},civitas.SOLDIER_MILITIA=0,civitas.SOLDIER_AXEMAN=1,civitas.SOLDIER_KNIGHT=2,civitas.SOLDIER_BOWMAN=3,civitas.SOLDIER_CROSSBOWMAN=4,civitas.SOLDIER_PIKEMAN=5,civitas.SOLDIER_LEGIONNAIRE=6,civitas.MERCENARIES=[{name:"Legio I Adiutrix",description:"Legio prima Adiutrix is a Roman legion.",handle:"legio1",icon:1,army:{Axeman:300,Knight:100,Crossbowman:220,Pikeman:300},cost:12e4},{name:"Legio II Augusta",description:"Legio secunda Augusta is a Roman legion.",handle:"legio2",icon:8,army:{Axeman:220,Knight:100,Crossbowman:300,Pikeman:140},cost:13e4},{name:"Legio III Cyrenaica",description:"Legio tertia Cyrenaica is a Roman legion.",handle:"legio3",icon:15,army:{Axeman:280,Crossbowman:500,Pikeman:180},cost:1e5},{name:"Legio IV Flavia Felix",description:"Legio quarta Flavia Felix is a Roman legion.",handle:"legio4",icon:9,army:{Militia:140,Axeman:190,Knight:90,Bowman:120,Crossbowman:200,Pikeman:180},cost:19e4},{name:"Legio V Alaudae",description:"Legio quinta Alaudae is a Roman legion.",handle:"legio5",icon:16,army:{Militia:400,Axeman:200,Bowman:190},cost:11e4},{name:"Legio VI Victrix",description:"Legio sexta Victrix is a Roman legion.",handle:"legio6",icon:22,army:{Militia:330,Axeman:230,Knight:100,Bowman:200},cost:14e4},{name:"Varangian Guard",description:"The Varangian Guard is an elite unit of the Byzantine Army.",handle:"varangian",icon:18,army:{Militia:410,Axeman:210,Bowman:190,Crossbowman:100,Pikeman:220},cost:12e4},{name:"Magna Societas Catalanorum",description:"The Catalan Company of the East, officially the Magna Societas Catalanorum is a company of mercenaries founded by Roger de Flor.",handle:"catalan",icon:23,army:{Axeman:310,Knight:120,Bowman:210,Pikeman:310},cost:1e5},{name:"Army of the Western Garden",description:"The Army of the Western Garden is an army established during the reign of Emperor Ling in the Eastern Han Dynasty.",handle:"western",icon:27,army:{Axeman:290,Knight:40,Bowman:170,Pikeman:300},cost:9e4},{name:"Scholae Palatinae",description:"The Scholae Palatinae are an elite military guard unit, usually ascribed to the Roman Emperor Constantine the Great as a replacement for the equites singulares Augusti, the cavalry arm of the Praetorian Guard.",handle:"scholae",icon:26,army:{Axeman:10,Knight:200,Bowman:100,Pikeman:210},cost:29e4},{name:"Imperial Guards",description:"The Imperial Guards of the Tang Dynasty, also known as the Forbidden Troops were initially honor guards of the emperor and garrisons of the imperial capitals during the Tang`s dinasty formation in early 7th century.",handle:"forbidden",icon:25,army:{Axeman:290,Knight:80,Bowman:100,Pikeman:210},cost:13e4},{name:"Navy of the Order of Saint John",description:"The navy of the Order of Saint John, also known as the Maltese Navy, was the first navy of a chivalric order, established in the Middle Ages, around the late 12th century.",handle:"maltesenavy",icon:28,navy:{Corsair:19,Caravel:14,Warship:12,"Ship of the Line":10},cost:15e5}],civitas.SHIPS={Corsair:{id:civitas.SHIP_CORSAIR,attack:5,defense:5,cost:{coins:1e3,wood:200,leather:50,iron:50,provisions:50,pottery:10,clothes:50,ropes:10,cannons:5,weapons:10}},Caravel:{id:civitas.SHIP_CARAVEL,attack:10,defense:10,cost:{coins:3e3,wood:400,leather:60,iron:80,provisions:60,pottery:20,clothes:60,ropes:30,cannons:20}},Frigate:{id:civitas.SHIP_FRIGATE,attack:17,defense:8,cost:{coins:3e3,wood:400,leather:60,iron:80,provisions:60,pottery:30,clothes:60,ropes:30,cannons:20,weapons:10}},Galleon:{id:civitas.SHIP_GALLEON,attack:15,defense:15,cost:{coins:5e3,wood:600,leather:70,iron:120,provisions:100,pottery:50,clothes:70,ropes:80,cannons:30,weapons:15}},Warship:{id:civitas.SHIP_WARSHIP,attack:35,defense:30,cost:{coins:1e4,wood:1e3,leather:200,iron:500,provisions:200,pottery:100,clothes:200,ropes:100,cannons:50,weapons:20,carpets:10}},"Ship of the Line":{id:civitas.SHIP_SHIPOFTHELINE,attack:55,defense:50,cost:{coins:15e3,wood:2e3,coal:500,leather:400,iron:1500,provisions:200,pottery:140,barrels:100,clothes:200,ropes:100,cannons:100,weapons:50}}},civitas.SHIP_CORSAIR=0,civitas.SHIP_CARAVEL=1,civitas.SHIP_WARSHIP=2,civitas.SHIP_GALLEON=3,civitas.SHIP_SHIPOFTHELINE=4,civitas.SHIP_FRIGATE=5,civitas.SETTLEMENT_BUILDINGS_TROPICAL=["marketplace","warehouse","tradingpost","church","monastery","camp","castle","shipyard","embassy","academy","tavern","house1","house2","house3","house4","house5","house6","house7","house8","house9","mill","bakery","butcher","coppermine","ironmine","saltmine","goldsmelter","coppersmelter","ironsmelter","lumberjack","stone","trapper","tannery","furrier","armory","coffeeroaster","quartzfactory","winery","saltworks","pottery","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","silkweaver","apiary","barrelcooperage","brewery","candlemakersworkshop","sugarmill","perfumery","weaver","provisions","carpenter","marzipanworkshop","almondsfarm","almondsfield","cattlefarm","cattlefield","coffeefarm","coffeefield","grainfarm","grainfield","grapesfarm","grapesfield","hempfarm","hempfield","pigfarm","pigfield","sugarfarm","sugarfield","indigofarm"],civitas.SETTLEMENT_BUILDINGS_POLAR=["marketplace","warehouse","tradingpost","church","monastery","camp","castle","shipyard","embassy","academy","tavern","house1","house2","house3","house4","house5","house6","house7","mill","bakery","butcher","coppermine","goldmine","ironmine","goldsmelter","coppersmelter","ironsmelter","lumberjack","stone","trapper","tannery","furrier","armory","coffeeroaster","quartzfactory","winery","saltworks","pottery","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","silkweaver","marzipanworkshop","apiary","barrelcooperage","brewery","candlemakersworkshop","sugarmill","perfumery","weaver","provisions","carpenter"],civitas.SETTLEMENT_BUILDINGS_ARID=["marketplace","warehouse","tradingpost","church","monastery","camp","castle","shipyard","embassy","academy","tavern","house1","house2","house3","house4","house5","house6","house7","mill","bakery","butcher","coppermine","goldmine","ironmine","saltmine","goldsmelter","coppersmelter","ironsmelter","lumberjack","stone","trapper","tannery","furrier","armory","coffeeroaster","quartzfactory","winery","saltworks","pottery","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","silkweaver","apiary","barrelcooperage","brewery","candlemakersworkshop","sugarmill","perfumery","weaver","provisions","carpenter","marzipanworkshop","cattlefarm","cattlefield","pigfarm","pigfield"],civitas.SETTLEMENT_BUILDINGS_TEMPERATE=["marketplace","warehouse","tradingpost","church","monastery","camp","castle","shipyard","embassy","academy","tavern","house1","house2","house3","house4","house5","house6","house7","house8","house9","mill","bakery","butcher","coppermine","goldmine","ironmine","saltmine","goldsmelter","coppersmelter","ironsmelter","lumberjack","stone","trapper","tannery","furrier","armory","coffeeroaster","quartzfactory","winery","saltworks","pottery","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","silkweaver","marzipanworkshop","apiary","barrelcooperage","brewery","candlemakersworkshop","sugarmill","perfumery","weaver","provisions","carpenter","catapultworkshop","cattlefarm","cattlefield","ciderfarm","ciderfield","grainfarm","grainfield","grapesfarm","grapesfield","hempfarm","hempfield","pigfarm","pigfield","indigofarm"],civitas.BUILDINGS_ALL=["marketplace","lumberjack","camp","warehouse","mill","castle","stone","ironmine","trapper","almondsfarm","almondsfield","tavern","shipyard","pigfarm","cattlefarm","pigfield","cattlefield","house1","house2","house3","house4","house5","house6","house7","house8","house9","church","bakery","butcher","grainfarm","grainfield","ironsmelter","tannery","furrier","saltmine","coppermine","goldmine","goldsmelter","coppersmelter","armory","coffeefarm","coffeefield","hempfarm","hempfield","sugarfarm","sugarfield","silkfarm","silkfield","coffeeroaster","quartzfactory","grapesfarm","grapesfield","winery","saltworks","carpenter","pottery","charcoalburnerhut","monastery","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","provisions","silkweaver","apiary","barrelcooperage","brewery","candlemakersworkshop","indigofarm","ciderfarm","ciderfield","sugarmill","rosenursery","catapultworkshop","perfumery","tradingpost","weaver","embassy","academy","marzipanworkshop"],civitas.BUILDINGS_CATEGORIES={Municipal:["academy","church","embassy","marketplace","monastery","shipyard","tradingpost","warehouse","tavern"],Housing:["house1","house2","house3","house4","house5","house6","house7","house8","house9"],Food:["bakery","butcher","mill"],Mines:["coppermine","goldmine","ironmine","saltmine"],Farms:["almondsfarm","almondsfield","cattlefarm","cattlefield","ciderfarm","ciderfield","coffeefarm","coffeefield","grainfarm","grainfield","grapesfarm","grapesfield","hempfarm","hempfield","indigofarm","pigfarm","pigfield","silkfarm","silkfield","sugarfarm","sugarfield"],Industry:["barrelcooperage","brewery","candlemakersworkshop","carpenter","charcoalburnerhut","coppersmelter","furrier","glassworks","goldsmelter","ironsmelter","lumberjack","opticiansworkshop","papermill","pottery","printingpress","quartzfactory","redsmithsworkshop","ropeyard","saltworks","stone","trapper","tannery","weaver","winery"],Exotic:["apiary","coffeeroaster","marzipanworkshop","perfumery","rosenursery","silkweaver","sugarmill"],Military:["armory","camp","castle","provisions","catapultworkshop"]},civitas.BUILDINGS=[{name:"Marketplace",handle:"marketplace",description:"The Marketplace is the main building of your city and provides a place for the inhabitants of your settlement to gather. It cannot be demolished.",storage:1e5,is_municipal:!0,levels:4,visible_upgrades:!0,production:{fame:10},cost:{coins:1e5},position:{x:709,y:515},requires:{settlement_level:1}},{name:"Warehouse",handle:"warehouse",description:"The Warehouse is a trade building that provides market carts that pick up goods from production buildings. A Warehouse also adds extra storage space for the materials in your city.",storage:1e5,levels:3,visible_upgrades:!0,position:{x:1162,y:365},cost:{coins:15e4,wood:500,woodplanks:200,stones:500},requires:{settlement_level:10}},{name:"Church",handle:"church",description:"A Church provides a massive fame boost to your settlement by using coins and converting them to fame, as well as providing faith for free. Faith allows you to choose a religion for your settlement.",is_municipal:!0,is_production:!0,production:{fame:50,faith:1},materials:{coins:50},visible_upgrades:!0,position:{x:560,y:428},levels:3,cost:{coins:1e4,wood:20,woodplanks:20,stones:20},requires:{settlement_level:3}},{name:"Trading Post",handle:"tradingpost",description:"The Trading Post allows you to trade resources with other settlements.",is_municipal:!0,position:{x:1590,y:200},cost:{coins:3e4,wood:20,woodplanks:30,stones:40},requires:{settlement_level:6}},{name:"Academy",handle:"academy",description:"The Academy provides research for the settlement it is built into, at the expense of coins.",is_municipal:!0,is_production:!0,production:{fame:10,research:1},materials:{coins:100},position:{x:1480,y:700},levels:3,cost:{coins:1e5,woodplanks:1e3,stones:1e3},requires:{settlement_level:10}},{name:"Embassy",handle:"embassy",description:"An Embassy is required to propose pacts, declare war, send goods to other cities.",is_municipal:!0,is_production:!0,production:{fame:20,espionage:1},materials:{coins:50},position:{x:1620,y:390},levels:3,cost:{coins:1e5,woodplanks:100,stones:100},requires:{settlement_level:10}},{name:"Provision House",handle:"provisions",description:"The Provision House requires various goods to produce provisions for military units.",is_production:!0,production:{provisions:2},materials:{bread:2,meat:2,wine:1},position:{x:1234,y:418},levels:3,cost:{coins:1e5,wood:200,stones:200,woodplanks:100},requires:{settlement_level:8}},{name:"Monastery",handle:"monastery",description:"Monastery provides fame for your city in exchange for coins.",is_municipal:!0,is_production:!0,production:{fame:20,faith:2},materials:{coins:20},position:{x:680,y:400},levels:3,cost:{coins:5e4,woodplanks:200,stones:200},requires:{settlement_level:16,buildings:["academy"]}},{name:"Tavern",handle:"tavern",description:"The Tavern is the place where heroes of the known (and unknown) world hang around. If you are looking to recruit Achilles, build a Tavern. He might show up.",is_municipal:!0,production:{fame:20},materials:{coins:20},position:{x:1380,y:180},levels:3,cost:{coins:1e5,woodplanks:200,stones:200,wood:200,wine:100,meat:100},requires:{settlement_level:16,buildings:["academy","castle"]}},{name:"Shipyard",handle:"shipyard",description:"The Shipyard helps you expand your settlement overseas by housing your ships and providing you with fish and an ultra-small chance to gather pearls.",is_production:!0,position:{x:1746,y:552},levels:3,chance:{pearls:.005},cost:{coins:2e5,wood:200,woodplanks:200,stones:100,ropes:10,barrels:10},production:{fish:4},requires:{settlement_level:10}},{name:"Military Camp",handle:"camp",description:"The military camp is your main base of defense and attack until you can develop a Castle.",levels:3,position:{x:1461,y:153},cost:{coins:5e4,wood:200,woodplanks:200,stones:160},requires:{settlement_level:8,buildings:["provisions"]}},{name:"Castle",handle:"castle",description:"The Castle is your main base of operations. It houses your settlement`s soldiers and provides you with prestige and some extra fame.",is_production:!0,production:{fame:100,prestige:1},levels:2,visible_upgrades:!0,position:{x:982,y:77},materials:{coins:200},cost:{coins:1e6,wood:500,woodplanks:500,stones:500},requires:{settlement_level:20}},{name:"Lumberjack",handle:"lumberjack",description:"A lumberjack provides you with wood which you can use for creating additional buildings or sell.",is_production:!0,production:{wood:3},levels:3,position:{x:129,y:710},cost:{coins:2e3,stones:20},requires:{settlement_level:1}},{name:"Carpenter",handle:"carpenter",description:".",is_production:!0,materials:{wood:2},production:{woodplanks:1},levels:3,position:{x:150,y:810},cost:{coins:5e3,wood:10,stones:10},requires:{settlement_level:3}},{name:"Stone Quarry",handle:"stone",description:"Stone quarries produce stone blocks that are the basis of any buildings you wish to construct.",is_production:!0,production:{stones:1,clay:1},position:{x:469,y:243},levels:3,cost:{coins:2e3,wood:20},chance:{mosaic:.001},requires:{settlement_level:1}},{name:"Gold Mine",handle:"goldmine",description:"The gold mine extracts gold ores from the mountains you own (provided you own some).",is_production:!0,production:{goldores:4,clay:1},position:{x:342,y:253},levels:3,chance:{gems:1e-4},cost:{coins:1e4,woodplanks:20,stones:20},requires:{settlement_level:6}},{name:"Iron Mine",handle:"ironmine",description:"The iron mine extracts iron ores from the mountains you own (provided you own some).",is_production:!0,production:{ironores:4,clay:1},position:{x:640,y:182},levels:3,chance:{gems:1e-4},cost:{coins:1e4,wood:20,stones:20},requires:{settlement_level:3}},{name:"Salt Mine",handle:"saltmine",description:"A salt mine extracts brine that can be processed further into salt in a Salt Works.",is_production:!0,production:{brine:1,clay:1},position:{x:172,y:258},levels:3,cost:{coins:8e3,wood:20,stones:20},requires:{settlement_level:3}},{name:"Copper Mine",handle:"coppermine",description:"The copper mine extracts copper from the mountains you own (provided you own some).",is_production:!0,production:{copper:4,clay:1},position:{x:732,y:133},levels:3,chance:{gems:1e-4},cost:{coins:1e4,wood:20,stones:20},requires:{settlement_level:5}},{name:"Salt Works",handle:"saltworks",description:"Salt Works requires coal and brine, and it produces salt. Salt is used for leather jerkins by the Tannery, meat by the Butcher`s Shop and fur coats by the Furrier`s Workshop.",is_production:!0,production:{salt:4},materials:{coal:2,brine:2},position:{x:1734,y:318},levels:3,cost:{coins:2e4,wood:20,stones:20},requires:{settlement_level:3}},{name:"Mill",handle:"mill",description:"The Mill produces flour from the wheat cultivated by your farm(s).",is_production:!0,production:{flour:4},materials:{wheat:2},position:{x:1234,y:418},levels:3,cost:{coins:1e4,woodplanks:20,stones:20},requires:{settlement_level:3}},{name:"Bakery",handle:"bakery",description:"The Bakery creates bread from flour, thus providing your settlers with basic food.",is_production:!0,production:{bread:5},materials:{flour:3},position:{x:1003,y:223},levels:3,cost:{coins:15e3,woodplanks:30,stones:30},requires:{settlement_level:3}},{name:"Pottery Workshop",handle:"pottery",description:"The pottery workshop uses a high-temperature kiln and clay to create pottery for the inhabitants of your settlement.",is_production:!0,production:{pottery:4},materials:{clay:6},position:{x:1360,y:630},levels:3,cost:{coins:3e4,woodplanks:30,stones:30,clay:100},requires:{settlement_level:6}},{name:"Armory",handle:"armory",description:"The Armory is a major building that produces weapons and armor for your soldiers. If you want to conquer other settlements, you will need one.",is_production:!0,production:{weapons:1,armor:1},materials:{iron:10,wood:2,leather:8,brass:4},position:{x:863,y:131},levels:3,cost:{coins:5e4,woodplanks:100,stones:100},requires:{settlement_level:6}},{name:"Butcher",handle:"butcher",description:"The Butcher slaughters cattle for meat, providing food that is more nutritious. Hides will be processed at the Tannery.",is_production:!0,production:{meat:4,hides:2},materials:{cattle:1,salt:1},position:{x:1082,y:297},levels:3,cost:{coins:25e3,woodplanks:40,stones:40},requires:{settlement_level:3}},{name:"Iron smelter",handle:"ironsmelter",description:"The iron smelter (or foundry) smelts iron ores into iron bars using coal, ready to be transformed into weapons.",is_production:!0,production:{iron:4},materials:{ironores:4,coal:1},position:{x:153,y:381},levels:3,cost:{coins:4e4,woodplanks:40,stones:50},requires:{settlement_level:4}},{name:"Copper smelter",handle:"coppersmelter",description:"The copper smelter smelts copper into brass using coal.",is_production:!0,production:{brass:1},materials:{copper:4,coal:1},position:{x:483,y:327},levels:3,cost:{coins:4e4,woodplanks:50,stones:50},requires:{settlement_level:6}},{name:"Gold smelter",handle:"goldsmelter",description:"The gold smelter transforms gold ores into gold bars using coal.",is_production:!0,production:{gold:1},materials:{goldores:4,coal:1},position:{x:628,y:292},levels:3,cost:{coins:4e4,woodplanks:55,stones:55},requires:{settlement_level:6}},{name:"Trapper`s Lodge",handle:"trapper",description:"The trapper captures wild animals and uses the furs from them.",is_production:!0,production:{furs:4},position:{x:1238,y:131},levels:3,cost:{coins:15e3,wood:40,stones:40},requires:{settlement_level:6}},{name:"Furrier`s Workshop",handle:"furrier",description:"The furrier uses furs from the Trapper`s Lodge mixed with salt and processes them into fur coats that will help your settlers during the cold winters.",is_production:!0,production:{furcoats:1},materials:{furs:2,salt:2},position:{x:1355,y:496},levels:3,cost:{coins:15e3,woodplanks:30,stones:40},requires:{settlement_level:6}},{name:"Weaver`s Hut",handle:"weaver",description:"The weaver uses hemp to produce linen clothes.",is_production:!0,production:{clothes:1},materials:{hemp:4},position:{x:1355,y:496},levels:3,cost:{coins:15e3,wood:40,stones:40},requires:{settlement_level:6}},{name:"Tannery",handle:"tannery",description:"The tannery produces leather clothes from animal hides.",is_production:!0,production:{leather:2},materials:{hides:2,salt:1},levels:3,position:{x:1490,y:552},cost:{coins:2e4,wood:35,stones:40},requires:{settlement_level:6}},{name:"Coffee roaster",handle:"coffeeroaster",description:"The coffee roaster uses the coffee beans from your Coffee Farm and processes them into coffee.",is_production:!0,production:{coffee:1},materials:{coffeebeans:4},position:{x:905,y:292},levels:3,cost:{coins:7e4,woodplanks:80,stones:60},requires:{settlement_level:16,buildings:["tradingpost"]}},{name:"Sugar Mill",handle:"sugarmill",description:"The Sugar Mill creates sugar from sugar cane.",is_production:!0,production:{sugar:1},materials:{sugarcane:4},position:{x:1260,y:740},levels:3,cost:{coins:7e4,woodplanks:80,stones:60},requires:{settlement_level:16,buildings:["tradingpost"]}},{name:"Winery",handle:"winery",description:"The Winery uses the grapes from your Grapes Farm and processes them into wine.",is_production:!0,production:{wine:2},materials:{grapes:4,barrels:1},position:{x:1020,y:380},levels:3,cost:{coins:5e4,wood:50,stones:40},requires:{settlement_level:10}},{name:"Optician`s Shop",handle:"opticiansworkshop",description:"The optician uses brass and quartz to create glasses for your settlers.",is_production:!0,production:{glasses:1},materials:{brass:2,quartz:2},position:{x:1160,y:820},levels:3,cost:{coins:81e3,woodplanks:70,stones:70},requires:{settlement_level:20}},{name:"Paper Mill",handle:"papermill",description:"The Paper Mill uses wood to produce paper, which is used along with indigo to produce books at the Printing House.",is_production:!0,production:{paper:2},materials:{wood:1},position:{x:1600,y:500},levels:3,cost:{coins:83e3,woodplanks:60,stones:50},requires:{settlement_level:16}},{name:"Printing Press",handle:"printingpress",description:"The printing press produces books using paper and indigo.",is_production:!0,production:{books:1},materials:{paper:8,indigo:1},position:{x:1260,y:900},levels:3,cost:{coins:84e3,woodplanks:100,stones:100},requires:{settlement_level:20}},{name:"Perfumery",handle:"perfumery",description:"The Perfumery processes the rose oil into perfume to satisfy the needs of your settlers.",is_production:!0,production:{perfume:1},materials:{roses:8},position:{x:920,y:660},levels:3,cost:{coins:9e4,woodplanks:80,stones:40},requires:{settlement_level:20,buildings:["tradingpost"]}},{name:"Redsmith`s Workshop",handle:"redsmithsworkshop",description:"The Redsmith`s Workshop processes brass and candles into candlesticks.",is_production:!0,production:{candlesticks:1},materials:{brass:3,candles:2},position:{x:1020,y:730},levels:3,cost:{coins:75e3,wood:70,stones:50},requires:{settlement_level:20}},{name:"Ropeyard",handle:"ropeyard",description:"The ropeyard produces ropes that are needed for your city`s ships.",is_production:!0,production:{ropes:1},materials:{hemp:1},position:{x:1700,y:700},levels:3,cost:{coins:15e3,wood:70,stones:60},requires:{settlement_level:10}},{name:"Glassworks",handle:"glassworks",description:"The Glassworks processes quartz into glass.",is_production:!0,production:{glass:1},materials:{quartz:2},position:{x:1380,y:340},levels:3,cost:{coins:5e4,wood:50,stones:80},requires:{settlement_level:16}},{name:"Marzipan Workshop",handle:"marzipanworkshop",description:".",is_production:!0,production:{marzipan:1},materials:{almonds:2,sugar:2},position:{x:1380,y:340},levels:3,cost:{coins:5e4,wood:50,stones:80},requires:{settlement_level:20,buildings:["tradingpost"]}},{name:"Silk Weaver",handle:"silkweaver",description:"The silk weaking mill requires gold and silk and produces brocade robes.",is_production:!0,production:{robes:1},materials:{silk:2,hemp:1,gold:2},position:{x:1380,y:340},levels:3,cost:{coins:5e4,wood:50,stones:80},requires:{settlement_level:20,buildings:["tradingpost"]}},{name:"Quartz factory",handle:"quartzfactory",description:"The quartz factory provides your city with quartz.",is_production:!0,production:{quartz:3},position:{x:349,y:382},levels:3,cost:{coins:4e4,wood:50,stones:90},requires:{settlement_level:8}},{name:"Apiary",handle:"apiary",description:"The apiary produces bees wax for use in candles.",is_production:!0,production:{wax:3},position:{x:1700,y:340},levels:3,cost:{coins:4e4,wood:50,stones:40},requires:{settlement_level:10}},{name:"Barrel Cooperage",handle:"barrelcooperage",description:"The barrel cooperage creates barrels from wood and iron.",is_production:!0,production:{barrels:2},materials:{wood:3,iron:1},position:{x:1630,y:800},levels:3,cost:{coins:25e3,wood:80,stones:70},requires:{settlement_level:9}},{name:"Brewery",handle:"brewery",description:"The Brewery brews beer from wheat. Beer is needed for bigger hourses or ships.",is_production:!0,production:{beer:2},materials:{barrels:1,wheat:2},position:{x:1020,y:600},levels:3,cost:{coins:25e3,wood:60,stones:70},requires:{settlement_level:9}},{name:"Candlemaker`s Hut",handle:"candlemakersworkshop",description:"The Candlemaker Hut produces candles for your settlers` houses.",is_production:!0,production:{candles:1},materials:{wax:2,hemp:1},position:{x:770,y:250},levels:3,cost:{coins:45e3,woodplanks:80,stones:60},requires:{settlement_level:20}},{name:"Catapult Workshop",handle:"catapultworkshop",description:"The Catapult Workshop builds catapults, which are the ultimate siege weapons.",is_production:!0,production:{catapults:1},materials:{wood:100,copper:10,iron:20,woodplanks:40,ropes:10,sulphur:10},position:{x:1110,y:130},levels:3,cost:{coins:25e4,woodplanks:200,stones:300},requires:{settlement_level:15}},{name:"Charcoal Burner`s Hut",handle:"charcoalburnerhut",description:"The Charcoal Burner`s Hut burns wood into coal that is needed by all your smelters.",is_production:!0,production:{coal:4},materials:{wood:2},position:{x:1480,y:250},levels:3,cost:{coins:15e3,wood:50,stones:50},requires:{settlement_level:3}},{name:"House",handle:"house1",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:5,cost:{wood:10,coins:1e3},materials:{bread:1},position:{x:790,y:340},levels:5,visible_upgrades:!0,requires:{settlement_level:1}},{name:"House",handle:"house2",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:10,cost:{wood:10,coins:2e3},materials:{bread:1},position:{x:849,y:412},levels:5,visible_upgrades:!0,requires:{settlement_level:1}},{name:"House",handle:"house3",
description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:15,cost:{woodplanks:10,stones:20,coins:3e3},materials:{bread:1,meat:1},position:{x:945,y:480},levels:5,visible_upgrades:!0,requires:{settlement_level:3}},{name:"House",handle:"house4",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:20,cost:{woodplanks:10,stones:20,coins:4e3},materials:{bread:1,meat:1,pottery:1},position:{x:860,y:552},levels:5,visible_upgrades:!0,requires:{settlement_level:6,buildings:["church"]}},{name:"House",handle:"house5",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:25,cost:{woodplanks:25,stones:35,coins:5e3},materials:{fish:2,meat:2,pottery:1,beer:1},position:{x:764,y:613},levels:5,visible_upgrades:!0,requires:{settlement_level:10,buildings:["church"]}},{name:"House",handle:"house6",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:30,cost:{woodplanks:30,stones:45,coins:6e3},materials:{fish:2,meat:2,pottery:1,wine:1},position:{x:663,y:659},levels:5,visible_upgrades:!0,requires:{settlement_level:16,buildings:["church"]}},{name:"House",handle:"house7",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:35,cost:{woodplanks:40,stones:80,coins:7e3},materials:{fish:2,meat:2,wine:1,pottery:1,candlesticks:1},position:{x:579,y:601},levels:5,visible_upgrades:!0,requires:{settlement_level:20,buildings:["academy"]}},{name:"House",handle:"house8",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:40,cost:{woodplanks:50,stones:100,coins:8e3},materials:{fish:2,meat:2,wine:1,pottery:1,candlesticks:1,furcoats:1},position:{x:520,y:530},levels:5,visible_upgrades:!0,requires:{settlement_level:25,buildings:["academy"]}},{name:"House",handle:"house9",description:"Houses provide coins through taxes and space for your settlers.",is_housing:!0,tax:100,cost:{woodplanks:100,stones:200,coins:1e4},materials:{fish:2,meat:2,wine:1,pottery:1,candlesticks:1,furcoats:1,perfume:1,robes:1,marzipan:1},position:{x:447,y:463},levels:5,visible_upgrades:!0,requires:{settlement_level:30,buildings:["castle"]}},{name:"Cider Farm",handle:"ciderfarm",description:"The cider farm produces cider, a basic drink for your settlers",is_production:!0,production:{cider:1,herbs:1},position:{x:1500,y:882},levels:3,cost:{coins:1e4,wood:50,stones:30},requires:{settlement_level:4,buildings:["ciderfield"]}},{name:"Cider field",handle:"ciderfield",description:"A cider field is required for the cider farm to operate.",position:{x:1400,y:840},cost:{coins:2e3,wood:10,clay:20},requires:{settlement_level:4}},{name:"Almonds farm",handle:"almondsfarm",is_production:!0,description:"The Almonds Farm cultivates almonds for export.",production:{almonds:1},levels:3,position:{x:280,y:569},cost:{coins:4e4,wood:30,stones:30},requires:{settlement_level:16,buildings:["almondsfield"]}},{name:"Almonds field",handle:"almondsfield",description:"An almonds field is required for the almonds farm to operate.",position:{x:205,y:636},cost:{coins:5e3,wood:10,clay:20},requires:{settlement_level:16}},{name:"Cattle Farm",handle:"cattlefarm",description:"A cattle farm grows cattle so your settlers can eat food that is more nutritious than bread.",is_production:!0,production:{cattle:1,milk:1},levels:3,materials:{herbs:2},position:{x:905,y:783},cost:{coins:1e4,wood:20,stones:20},requires:{settlement_level:2,buildings:["cattlefield"]}},{name:"Cattle field",handle:"cattlefield",description:"A cattle field is required for the cattle farm to operate.",position:{x:816,y:838},cost:{coins:1e3,wood:10,clay:20},requires:{settlement_level:2}},{name:"Pig Farm",handle:"pigfarm",description:"A pig farm grows pigs so your settlers can eat food that is more nutritious than bread.",is_production:!0,production:{meat:1,hides:1},levels:3,materials:{herbs:2},position:{x:823,y:712},cost:{coins:15e3,wood:20,stones:20},requires:{settlement_level:3,buildings:["church","pigfield"]}},{name:"Pig field",handle:"pigfield",description:"A pig field is required for the pig farm to operate.",position:{x:730,y:770},cost:{coins:1500,wood:10,clay:20},requires:{settlement_level:3}},{name:"Grain farm",handle:"grainfarm",description:"A grain farm cultivates wheat that will be later transformed into bread, and your settlers will live happily ever after.",is_production:!0,production:{wheat:3,herbs:1},levels:3,position:{x:1027,y:859},cost:{coins:1e4,wood:20,stones:20},requires:{settlement_level:2,buildings:["grainfield"]}},{name:"Grain field",handle:"grainfield",description:"A grain field is required for the grain farm to operate.",position:{x:1103,y:915},cost:{coins:1e3,wood:10,clay:20},requires:{settlement_level:2}},{name:"Grapes farm",handle:"grapesfarm",description:"A grapes farm provides your city with grapes for wine.",is_production:!0,production:{grapes:2,herbs:1},levels:3,position:{x:1200,y:600},cost:{coins:15e3,wood:20,stones:20},requires:{settlement_level:10,buildings:["grapesfield"]}},{name:"Grapes field",handle:"grapesfield",description:"A grapes field is required for the grapes farm to operate.",position:{x:1120,y:670},cost:{coins:1500,wood:10,clay:20},requires:{settlement_level:10}},{name:"Coffee farm",handle:"coffeefarm",description:"A coffee farm provides your city with coffee beans.",is_production:!0,production:{coffeebeans:2,herbs:1},levels:3,position:{x:244,y:466},cost:{coins:6e4,wood:20,stones:20},requires:{settlement_level:16,buildings:["coffeefield"]}},{name:"Coffee field",handle:"coffeefield",description:"A coffee field is required for the coffee farm to operate.",position:{x:181,y:532},cost:{coins:6e3,wood:10,clay:40},requires:{settlement_level:16}},{name:"Hemp farm",handle:"hempfarm",description:"A hemp farm provides your city with hemp.",is_production:!0,production:{hemp:2,herbs:1},levels:3,position:{x:347,y:698},cost:{coins:2e4,wood:20,stones:20},requires:{settlement_level:6,buildings:["hempfield"]}},{name:"Hemp field",handle:"hempfield",description:"A hemp field is required for the hemp farm to operate.",position:{x:281,y:758},cost:{coins:2e3,wood:10,clay:20},requires:{settlement_level:6}},{name:"Silk farm",handle:"silkfarm",description:"A silk farm provides your city with silk.",is_production:!0,production:{silk:2},levels:3,position:{x:456,y:745},cost:{coins:8e4,wood:20,stones:20},requires:{settlement_level:20,buildings:["silkfield"]}},{name:"Silk field",handle:"silkfield",description:"A silk field is required for the silk farm to operate.",position:{x:363,y:819},cost:{coins:8e3,wood:10,clay:100},requires:{settlement_level:20}},{name:"Sugar farm",handle:"sugarfarm",description:"A sugar cane farm provides your city with sugar cane.",is_production:!0,production:{sugarcane:2,herbs:1},levels:3,position:{x:536,y:804},cost:{coins:1e5,wood:20,stones:20},requires:{settlement_level:20,buildings:["academy","sugarfield"]}},{name:"Sugar field",handle:"sugarfield",description:"A sugar field is required for the sugar farm to operate.",position:{x:449,y:862},cost:{coins:1e4,wood:10,clay:100},requires:{settlement_level:20}},{name:"Indigo farm",handle:"indigofarm",is_production:!0,description:"The indigo farm produces indigo that can be used to create books.",production:{indigo:1},levels:3,position:{x:260,y:870},cost:{coins:2e5,wood:30,stones:30,clay:30},requires:{settlement_level:16}},{name:"Rose Nursery",handle:"rosenursery",is_production:!0,description:"The Rose Nursery produces rose oil which is needed to make perfume.",production:{roses:1},levels:3,position:{x:440,y:630},cost:{coins:2e4,wood:50,stones:50,clay:50},requires:{settlement_level:20}},{name:"Spice Farm",handle:"spicefarm",is_production:!0,description:"The Spice Farm is responsable for the production of spices.",production:{spices:1},levels:3,position:{x:260,y:870},cost:{coins:2e5,wood:60,stones:60,clay:60},requires:{settlement_level:20}}],civitas.SETTLEMENT_TYPES=["city","village"],civitas.CITY=0,civitas.VILLAGE=1,civitas.SETTLEMENTS={1:{icon:7,climate:civitas.CLIMATE_TEMPERATE,religion:civitas.RELIGION_CHRISTIANITY,level:35,resources:{coins:23e4,prestige:700,espionage:400},trades:{imports:{gold:civitas.IMPORTANCE_MEDIUM,milk:civitas.IMPORTANCE_HIGH,goldores:civitas.IMPORTANCE_LOW,weapons:civitas.IMPORTANCE_LOW,quartz:civitas.IMPORTANCE_LOW,roses:civitas.IMPORTANCE_MEDIUM,wine:civitas.IMPORTANCE_VITAL,clay:civitas.IMPORTANCE_VITAL,fish:civitas.IMPORTANCE_MEDIUM,catapults:civitas.IMPORTANCE_MEDIUM},exports:{hemp:civitas.IMPORTANCE_VITAL,indigo:civitas.IMPORTANCE_LOW,armor:civitas.IMPORTANCE_MEDIUM,barrels:civitas.IMPORTANCE_MEDIUM,paper:civitas.IMPORTANCE_HIGH,woodplanks:civitas.IMPORTANCE_MEDIUM,stones:civitas.IMPORTANCE_LOW}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:4,Caravel:2,Galleon:2,Warship:6,"Ship of the Line":1},location:{x:380,y:190}},2:{icon:4,climate:civitas.CLIMATE_TROPICAL,religion:civitas.RELIGION_TAOISM,level:32,resources:{coins:23e4,prestige:700,espionage:1e3},trades:{imports:{wax:civitas.IMPORTANCE_LOW,pottery:civitas.IMPORTANCE_HIGH,sugar:civitas.IMPORTANCE_VITAL,sugarcane:civitas.IMPORTANCE_MEDIUM,glasses:civitas.IMPORTANCE_LOW,fish:civitas.IMPORTANCE_HIGH,mosaic:civitas.IMPORTANCE_HIGH,candles:civitas.IMPORTANCE_LOW,bread:civitas.IMPORTANCE_VITAL,pearls:civitas.IMPORTANCE_LOW,salt:civitas.IMPORTANCE_LOW},exports:{leather:civitas.IMPORTANCE_MEDIUM,indigo:civitas.IMPORTANCE_LOW,flour:civitas.IMPORTANCE_VITAL,glass:civitas.IMPORTANCE_MEDIUM,coal:civitas.IMPORTANCE_LOW,fish:civitas.IMPORTANCE_HIGH,woodplanks:civitas.IMPORTANCE_VITAL,wood:civitas.IMPORTANCE_VITAL}},navy:{Corsair:6,Caravel:4,Galleon:2,Warship:3,"Ship of the Line":4},army:{Militia:40,Axeman:50,Knight:10,Bowman:50,Crossbowman:50,Pikeman:40},navy:{},location:{x:140,y:400}},3:{icon:7,climate:civitas.CLIMATE_TEMPERATE,religion:civitas.RELIGION_JUDAISM,level:30,resources:{coins:16e4,prestige:1e3,espionage:800},trades:{imports:{wheat:civitas.IMPORTANCE_VITAL,wood:civitas.IMPORTANCE_HIGH,barrels:civitas.IMPORTANCE_MEDIUM,sugar:civitas.IMPORTANCE_LOW,sugarcane:civitas.IMPORTANCE_LOW,clay:civitas.IMPORTANCE_VITAL},exports:{herbs:civitas.IMPORTANCE_HIGH,silver:civitas.IMPORTANCE_VITAL,glasses:civitas.IMPORTANCE_LOW,furcoats:civitas.IMPORTANCE_MEDIUM,indigo:civitas.IMPORTANCE_LOW,pottery:civitas.IMPORTANCE_HIGH,wheat:civitas.IMPORTANCE_LOW}},army:{Militia:1210,Axeman:520,Crossbowman:320,Pikeman:300},location:{x:240,y:140}},4:{icon:5,climate:civitas.CLIMATE_TROPICAL,religion:civitas.RELIGION_BUDDHISM,level:28,resources:{coins:2e5,prestige:500,espionage:300},trades:{imports:{flour:civitas.IMPORTANCE_LOW,milk:civitas.IMPORTANCE_VITAL,brass:civitas.IMPORTANCE_LOW,furs:civitas.IMPORTANCE_LOW,fish:civitas.IMPORTANCE_VITAL,cider:civitas.IMPORTANCE_LOW,silk:civitas.IMPORTANCE_HIGH,cattle:civitas.IMPORTANCE_MEDIUM,wheat:civitas.IMPORTANCE_VITAL},exports:{meat:civitas.IMPORTANCE_VITAL,clothes:civitas.IMPORTANCE_VITAL,fish:civitas.IMPORTANCE_LOW,armor:civitas.IMPORTANCE_MEDIUM,pottery:civitas.IMPORTANCE_HIGH,coffeebeans:civitas.IMPORTANCE_HIGH,silk:civitas.IMPORTANCE_LOW}},army:{Militia:90,Axeman:70,Bowman:50,Crossbowman:30,Pikeman:90},location:{x:890,y:150}},5:{icon:5,climate:civitas.CLIMATE_ARID,religion:civitas.RELIGION_ISLAM,level:39,resources:{coins:2e5,prestige:800,espionage:900},trades:{imports:{barrels:civitas.IMPORTANCE_LOW,books:civitas.IMPORTANCE_LOW,paper:civitas.IMPORTANCE_LOW,coal:civitas.IMPORTANCE_VITAL,copper:civitas.IMPORTANCE_MEDIUM,mosaic:civitas.IMPORTANCE_MEDIUM,indigo:civitas.IMPORTANCE_HIGH},exports:{coal:civitas.IMPORTANCE_VITAL,ironores:civitas.IMPORTANCE_LOW,copper:civitas.IMPORTANCE_MEDIUM,goldores:civitas.IMPORTANCE_LOW,iron:civitas.IMPORTANCE_LOW,gold:civitas.IMPORTANCE_VITAL,catapults:civitas.IMPORTANCE_MEDIUM,brass:civitas.IMPORTANCE_LOW}},army:{Militia:40,Axeman:120,Knight:10,Bowman:120,Crossbowman:30,Pikeman:50},location:{x:830,y:530}},6:{icon:2,climate:civitas.CLIMATE_TROPICAL,religion:civitas.RELIGION_HINDUISM,level:29,resources:{coins:19e4,prestige:700,espionage:500},trades:{imports:{meat:civitas.IMPORTANCE_LOW,milk:civitas.IMPORTANCE_LOW,weapons:civitas.IMPORTANCE_LOW,roses:civitas.IMPORTANCE_MEDIUM,perfume:civitas.IMPORTANCE_LOW,iron:civitas.IMPORTANCE_VITAL,ironores:civitas.IMPORTANCE_LOW},exports:{brine:civitas.IMPORTANCE_MEDIUM,clothes:civitas.IMPORTANCE_LOW,glass:civitas.IMPORTANCE_HIGH,wheat:civitas.IMPORTANCE_VITAL,pottery:civitas.IMPORTANCE_HIGH,hides:civitas.IMPORTANCE_LOW,paper:civitas.IMPORTANCE_LOW}},army:{Militia:200,Bowman:200},location:{x:690,y:60}},7:{icon:4,climate:civitas.CLIMATE_ARID,religion:civitas.RELIGION_CHRISTIANITY,level:22,resources:{coins:13e4,prestige:780,espionage:400},trades:{imports:{silk:civitas.IMPORTANCE_LOW,clothes:civitas.IMPORTANCE_HIGH,leather:civitas.IMPORTANCE_LOW,pottery:civitas.IMPORTANCE_HIGH,meat:civitas.IMPORTANCE_MEDIUM},exports:{ropes:civitas.IMPORTANCE_MEDIUM,gold:civitas.IMPORTANCE_LOW,iron:civitas.IMPORTANCE_VITAL,ironores:civitas.IMPORTANCE_MEDIUM,copper:civitas.IMPORTANCE_HIGH,woodplanks:civitas.IMPORTANCE_MEDIUM,coal:civitas.IMPORTANCE_LOW}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},location:{x:300,y:480}},8:{icon:7,climate:civitas.CLIMATE_POLAR,religion:civitas.RELIGION_CHRISTIANITY,level:29,resources:{coins:3e5,prestige:200,espionage:850},trades:{imports:{furs:civitas.IMPORTANCE_LOW,hides:civitas.IMPORTANCE_LOW,milk:civitas.IMPORTANCE_MEDIUM,leather:civitas.IMPORTANCE_LOW,fish:civitas.IMPORTANCE_VITAL,furcoats:civitas.IMPORTANCE_VITAL},exports:{herbs:civitas.IMPORTANCE_VITAL,statues:civitas.IMPORTANCE_VITAL,wax:civitas.IMPORTANCE_LOW,barrels:civitas.IMPORTANCE_MEDIUM,candles:civitas.IMPORTANCE_LOW,armor:civitas.IMPORTANCE_HIGH,salt:civitas.IMPORTANCE_MEDIUM}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},location:{x:700,y:280}},9:{icon:4,climate:civitas.CLIMATE_TEMPERATE,religion:civitas.RELIGION_CONFUCIANISM,level:30,resources:{coins:33e4,prestige:900,espionage:900},trades:{imports:{perfume:civitas.IMPORTANCE_MEDIUM,coffee:civitas.IMPORTANCE_LOW,cider:civitas.IMPORTANCE_LOW,wine:civitas.IMPORTANCE_LOW,beer:civitas.IMPORTANCE_LOW,mosaic:civitas.IMPORTANCE_VITAL,woodplanks:civitas.IMPORTANCE_HIGH,silk:civitas.IMPORTANCE_MEDIUM},exports:{statues:civitas.IMPORTANCE_VITAL,barrels:civitas.IMPORTANCE_MEDIUM,brine:civitas.IMPORTANCE_LOW,brass:civitas.IMPORTANCE_VITAL,candlesticks:civitas.IMPORTANCE_LOW,cattle:civitas.IMPORTANCE_VITAL,glass:civitas.IMPORTANCE_MEDIUM,gold:civitas.IMPORTANCE_MEDIUM,wheat:civitas.IMPORTANCE_MEDIUM,iron:civitas.IMPORTANCE_LOW,grapes:civitas.IMPORTANCE_HIGH,hemp:civitas.IMPORTANCE_HIGH,herbs:civitas.IMPORTANCE_HIGH,quartz:civitas.IMPORTANCE_MEDIUM}},army:{Militia:40,Axeman:320,Knight:10,Bowman:220,Crossbowman:210,Pikeman:90},location:{x:920,y:440}},10:{icon:7,climate:civitas.CLIMATE_TEMPERATE,religion:civitas.RELIGION_BUDDHISM,level:28,resources:{coins:22e4,prestige:160,espionage:500},trades:{imports:{flour:civitas.IMPORTANCE_LOW,bread:civitas.IMPORTANCE_LOW,armor:civitas.IMPORTANCE_HIGH,brass:civitas.IMPORTANCE_MEDIUM,coal:civitas.IMPORTANCE_VITAL},exports:{wood:civitas.IMPORTANCE_LOW,meat:civitas.IMPORTANCE_HIGH,stones:civitas.IMPORTANCE_VITAL,wine:civitas.IMPORTANCE_MEDIUM}},army:{Militia:90,Axeman:90,Knight:1,Bowman:20,Crossbowman:20,Pikeman:30},location:{x:900,y:30}},11:{icon:7,climate:civitas.CLIMATE_TROPICAL,religion:civitas.RELIGION_TAOISM,level:23,resources:{coins:18e4,prestige:200,espionage:450},trades:{imports:{furs:civitas.IMPORTANCE_LOW,hides:civitas.IMPORTANCE_MEDIUM,milk:civitas.IMPORTANCE_LOW,leather:civitas.IMPORTANCE_LOW},exports:{spyglasses:civitas.IMPORTANCE_VITAL,wax:civitas.IMPORTANCE_LOW,armor:civitas.IMPORTANCE_HIGH,candles:civitas.IMPORTANCE_LOW,salt:civitas.IMPORTANCE_MEDIUM,sugarcane:civitas.IMPORTANCE_HIGH}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:2,Caravel:2,Galleon:2,Warship:2},location:{x:144,y:290}},12:{icon:7,climate:civitas.CLIMATE_ARID,religion:civitas.RELIGION_ISLAM,level:27,resources:{coins:18e4,prestige:300,espionage:300},trades:{imports:{cider:civitas.IMPORTANCE_LOW,ropes:civitas.IMPORTANCE_LOW,armor:civitas.IMPORTANCE_HIGH,wax:civitas.IMPORTANCE_MEDIUM,sugar:civitas.IMPORTANCE_LOW,wood:civitas.IMPORTANCE_VITAL,woodplanks:civitas.IMPORTANCE_MEDIUM,stones:civitas.IMPORTANCE_VITAL},exports:{almonds:civitas.IMPORTANCE_LOW,roses:civitas.IMPORTANCE_HIGH,grapes:civitas.IMPORTANCE_LOW,hemp:civitas.IMPORTANCE_LOW,coffeebeans:civitas.IMPORTANCE_LOW,coffee:civitas.IMPORTANCE_LOW,catapults:civitas.IMPORTANCE_MEDIUM,spices:civitas.IMPORTANCE_MEDIUM}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},location:{x:300,y:60}},13:{icon:4,climate:civitas.CLIMATE_TEMPERATE,religion:civitas.RELIGION_ISLAM,level:36,resources:{coins:2e5,prestige:710,espionage:450},trades:{imports:{meat:civitas.IMPORTANCE_LOW,milk:civitas.IMPORTANCE_LOW,weapons:civitas.IMPORTANCE_LOW,roses:civitas.IMPORTANCE_MEDIUM,perfume:civitas.IMPORTANCE_LOW,iron:civitas.IMPORTANCE_VITAL,ironores:civitas.IMPORTANCE_LOW},exports:{brine:civitas.IMPORTANCE_MEDIUM,clothes:civitas.IMPORTANCE_LOW,armor:civitas.IMPORTANCE_HIGH,glass:civitas.IMPORTANCE_HIGH,wheat:civitas.IMPORTANCE_VITAL,hides:civitas.IMPORTANCE_LOW,paper:civitas.IMPORTANCE_LOW}},army:{Militia:120,Bowman:32},location:{x:700,y:400}},14:{icon:4,climate:civitas.CLIMATE_TROPICAL,religion:civitas.RELIGION_CHRISTIANITY,level:38,resources:{coins:28e4,prestige:600,espionage:580},trades:{imports:{meat:civitas.IMPORTANCE_LOW,milk:civitas.IMPORTANCE_LOW,weapons:civitas.IMPORTANCE_LOW,roses:civitas.IMPORTANCE_MEDIUM,perfume:civitas.IMPORTANCE_LOW,iron:civitas.IMPORTANCE_VITAL,ironores:civitas.IMPORTANCE_LOW},exports:{brine:civitas.IMPORTANCE_MEDIUM,clothes:civitas.IMPORTANCE_LOW,glass:civitas.IMPORTANCE_HIGH,wheat:civitas.IMPORTANCE_VITAL,hides:civitas.IMPORTANCE_LOW,paper:civitas.IMPORTANCE_LOW}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},location:{x:680,y:540}},15:{icon:5,climate:civitas.CLIMATE_TEMPERATE,religion:civitas.RELIGION_JUDAISM,level:29,resources:{coins:11e4,prestige:180,espionage:200},trades:{imports:{meat:civitas.IMPORTANCE_LOW,iron:civitas.IMPORTANCE_HIGH,brass:civitas.IMPORTANCE_LOW,cider:civitas.IMPORTANCE_LOW,grapes:civitas.IMPORTANCE_LOW,coal:civitas.IMPORTANCE_MEDIUM,woodplanks:civitas.IMPORTANCE_HIGH,ironores:civitas.IMPORTANCE_LOW},exports:{wine:civitas.IMPORTANCE_HIGH,silk:civitas.IMPORTANCE_LOW,wood:civitas.IMPORTANCE_MEDIUM,armor:civitas.IMPORTANCE_MEDIUM,cattle:civitas.IMPORTANCE_LOW,statues:civitas.IMPORTANCE_VITAL}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},location:{x:180,y:530}},16:{icon:5,climate:civitas.CLIMATE_TEMPERATE,religion:civitas.RELIGION_JUDAISM,level:22,resources:{coins:1e5,prestige:360,espionage:500},trades:{imports:{furs:civitas.IMPORTANCE_LOW,hides:civitas.IMPORTANCE_VITAL,milk:civitas.IMPORTANCE_MEDIUM,gems:civitas.IMPORTANCE_LOW,brass:civitas.IMPORTANCE_VITAL,wheat:civitas.IMPORTANCE_HIGH,catapults:civitas.IMPORTANCE_MEDIUM,clay:civitas.IMPORTANCE_LOW},exports:{silver:civitas.IMPORTANCE_VITAL,wax:civitas.IMPORTANCE_MEDIUM,candles:civitas.IMPORTANCE_LOW,salt:civitas.IMPORTANCE_VITAL,pearls:civitas.IMPORTANCE_MEDIUM,ropes:civitas.IMPORTANCE_MEDIUM}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},location:{x:400,y:340}},17:{icon:7,climate:civitas.CLIMATE_TROPICAL,religion:civitas.RELIGION_ISLAM,level:26,resources:{coins:19e4,prestige:400,espionage:500},trades:{imports:{wheat:civitas.IMPORTANCE_VITAL,mosaic:civitas.IMPORTANCE_MEDIUM,wood:civitas.IMPORTANCE_HIGH,sugar:civitas.IMPORTANCE_LOW,sugarcane:civitas.IMPORTANCE_LOW,clay:civitas.IMPORTANCE_VITAL},exports:{silver:civitas.IMPORTANCE_VITAL,glasses:civitas.IMPORTANCE_LOW,furcoats:civitas.IMPORTANCE_MEDIUM,indigo:civitas.IMPORTANCE_LOW,woodplanks:civitas.IMPORTANCE_MEDIUM,wheat:civitas.IMPORTANCE_LOW}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},location:{x:130,y:140}},18:{icon:7,climate:civitas.CLIMATE_TEMPERATE,religion:civitas.RELIGION_CHRISTIANITY,level:29,resources:{coins:24e4,prestige:500,espionage:800},trades:{imports:{salt:civitas.IMPORTANCE_MEDIUM,stones:civitas.IMPORTANCE_VITAL,armor:civitas.IMPORTANCE_MEDIUM,gems:civitas.IMPORTANCE_LOW,woodplanks:civitas.IMPORTANCE_MEDIUM,pearls:civitas.IMPORTANCE_LOW},exports:{donkeys:civitas.IMPORTANCE_VITAL,sulphur:civitas.IMPORTANCE_VITAL,silk:civitas.IMPORTANCE_MEDIUM,glass:civitas.IMPORTANCE_HIGH,woodplanks:civitas.IMPORTANCE_MEDIUM,meat:civitas.IMPORTANCE_HIGH,carpets:civitas.IMPORTANCE_LOW,cannons:civitas.IMPORTANCE_LOW}},army:{Militia:80,Axeman:40,Bowman:10,Crossbowman:30,Pikeman:10},location:{x:600,y:200}},19:{icon:5,climate:civitas.CLIMATE_TEMPERATE,religion:civitas.RELIGION_ISLAM,level:27,resources:{coins:24e4,prestige:420,espionage:700},trades:{imports:{gold:civitas.IMPORTANCE_LOW,goldores:civitas.IMPORTANCE_LOW,weapons:civitas.IMPORTANCE_LOW,salt:civitas.IMPORTANCE_MEDIUM,stones:civitas.IMPORTANCE_VITAL,gems:civitas.IMPORTANCE_LOW,pearls:civitas.IMPORTANCE_LOW},exports:{donkeys:civitas.IMPORTANCE_VITAL,sulphur:civitas.IMPORTANCE_VITAL,silk:civitas.IMPORTANCE_MEDIUM,glass:civitas.IMPORTANCE_HIGH,roses:civitas.IMPORTANCE_LOW,cattle:civitas.IMPORTANCE_LOW,bread:civitas.IMPORTANCE_LOW,meat:civitas.IMPORTANCE_MEDIUM,carpets:civitas.IMPORTANCE_LOW,cannons:civitas.IMPORTANCE_LOW}},army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},location:{x:800,y:200}},20:{icon:7,climate:civitas.CLIMATE_ARID,religion:civitas.RELIGION_CONFUCIANISM,level:34,resources:{coins:32e4,prestige:490,espionage:200},trades:{imports:{gold:civitas.IMPORTANCE_LOW,goldores:civitas.IMPORTANCE_LOW,weapons:civitas.IMPORTANCE_LOW,salt:civitas.IMPORTANCE_MEDIUM,stones:civitas.IMPORTANCE_VITAL,gems:civitas.IMPORTANCE_LOW,pearls:civitas.IMPORTANCE_LOW},exports:{donkeys:civitas.IMPORTANCE_VITAL,sulphur:civitas.IMPORTANCE_VITAL,silk:civitas.IMPORTANCE_MEDIUM,glass:civitas.IMPORTANCE_HIGH,roses:civitas.IMPORTANCE_LOW,ropes:civitas.IMPORTANCE_MEDIUM,cattle:civitas.IMPORTANCE_LOW,bread:civitas.IMPORTANCE_LOW,meat:civitas.IMPORTANCE_MEDIUM,carpets:civitas.IMPORTANCE_LOW,cannons:civitas.IMPORTANCE_LOW}},army:{Militia:20,Axeman:20,Knight:20,Bowman:20,Crossbowman:20,Pikeman:20},location:{x:30,y:30}},21:{settlement_type:civitas.VILLAGE,religion:civitas.RELIGION_HINDUISM,resources:{prestige:1,coins:1e4,wood:20,stones:10,meat:80},nationality:civitas.NATION_JAPANESE,location:{x:800,y:480},population:1290,army:{Militia:3,Bowman:3}},22:{settlement_type:civitas.VILLAGE,religion:civitas.RELIGION_ISLAM,resources:{prestige:1,coins:2e4,silk:20,wheat:10,bread:20},population:610,nationality:civitas.NATION_CHINESE,location:{x:560,y:100},army:{Militia:3,Bowman:2}},23:{settlement_type:civitas.VILLAGE,religion:civitas.RELIGION_ISLAM,resources:{prestige:1,coins:2e4,silk:20,wheat:10,bread:20},population:550,nationality:civitas.NATION_KHMER,location:{x:900,y:300},army:{Militia:3,Bowman:2}},24:{settlement_type:civitas.VILLAGE,religion:civitas.RELIGION_CHRISTIANITY,resources:{prestige:1,coins:2e4,brass:20,meat:10,goldores:20},population:820,nationality:civitas.NATION_INDIAN,location:{x:100,y:70},army:{Militia:3,Bowman:2}},25:{settlement_type:civitas.VILLAGE,religion:civitas.RELIGION_CHRISTIANITY,resources:{prestige:1,coins:2e4,copper:20,flour:10,ironores:20},population:1600,nationality:civitas.NATION_PERSAN,location:{x:380,y:560},army:{Militia:3,Bowman:2}},26:{settlement_type:civitas.VILLAGE,religion:civitas.RELIGION_CHRISTIANITY,resources:{prestige:1,coins:2e3,silk:20,wheat:10,bread:20,herbs:10,barrels:10},population:600,nationality:civitas.NATION_MONGOLIAN,location:{x:570,y:400},army:{Militia:6}}},civitas.RULERS=[{name:"Caesar",title:"Emperor",avatar:1,nationality:civitas.NATION_ROMAN,personality:civitas.PERSONALITY_WARLORD},{name:"Cronus",title:"Ruler",avatar:3,nationality:civitas.NATION_PHOENICIAN,personality:civitas.PERSONALITY_BALANCED},{name:"Dido",title:"Queen",avatar:41,nationality:civitas.NATION_CARTHAGINIAN,personality:civitas.PERSONALITY_DIPLOMAT},{name:"Genghis",title:"Khan",avatar:19,nationality:civitas.NATION_MONGOLIAN,personality:civitas.PERSONALITY_WARLORD},{name:"Khufu",title:"Pharaoh",avatar:20,nationality:civitas.NATION_EGYPTIAN,personality:civitas.PERSONALITY_DIPLOMAT},{name:"Musa I",title:"Mansa",avatar:30,nationality:civitas.NATION_MALINESE,personality:civitas.PERSONALITY_WARLORD},{name:"Sennacherib",title:"King",avatar:34,nationality:civitas.NATION_ASSYRIAN,personality:civitas.PERSONALITY_BALANCED},{name:"Pepi",title:"Pharaoh",avatar:40,nationality:civitas.NATION_SUDANESE,personality:civitas.PERSONALITY_DIPLOMAT},{name:"Hatshepsut",title:"Pharaoh",avatar:36,nationality:civitas.NATION_EGYPTIAN,personality:civitas.PERSONALITY_BALANCED},{name:"Clovis",title:"King",avatar:13,nationality:civitas.NATION_FRANKS,personality:civitas.PERSONALITY_DIPLOMAT},{name:"Gilgamesh",title:"King",avatar:31,nationality:civitas.NATION_SUMERIAN,personality:civitas.PERSONALITY_WARLORD},{name:"Dalai Lama",title:"Priest",avatar:48,nationality:civitas.NATION_TIBETAN,personality:civitas.PERSONALITY_DIPLOMAT},{name:"Ashoka",title:"Emperor",avatar:28,nationality:civitas.NATION_INDIAN,personality:civitas.PERSONALITY_DIPLOMAT},{name:"Charlemagne",title:"King",avatar:43,nationality:civitas.NATION_FRANKS,personality:civitas.PERSONALITY_DIPLOMAT},{name:"Darius",title:"King",avatar:38,nationality:civitas.NATION_PERSAN,personality:civitas.PERSONALITY_WARLORD},{name:"Ivan III",title:"Tzar",avatar:19,nationality:civitas.NATION_RUSSIAN,personality:civitas.PERSONALITY_WARLORD},{name:"Qin Shi Huang",title:"Emperor",avatar:45,nationality:civitas.NATION_CHINESE,personality:civitas.PERSONALITY_DIPLOMAT},{name:"Ozymandias",title:"Pharaoh",avatar:33,nationality:civitas.NATION_EGYPTIAN,personality:civitas.PERSONALITY_BALANCED},{name:"Timur",title:"Emperor",avatar:37,nationality:civitas.NATION_PERSAN,personality:civitas.PERSONALITY_WARLORD},{name:"Pol Pot",title:"President",avatar:46,nationality:civitas.NATION_KHMER,personality:civitas.PERSONALITY_WARLORD},{name:"Napoleon",title:"Emperor",avatar:47,nationality:civitas.NATION_FRENCH,personality:civitas.PERSONALITY_WARLORD},{name:"Hirohito",title:"Emperor",avatar:30,nationality:civitas.NATION_JAPANESE,personality:civitas.PERSONALITY_DIPLOMAT}],civitas.SETTLEMENT_NAMES=["Alexandria","Rome","Carthage","Constantinople","Karakorum","Niniveh","Damascus","Thebes","Men-nefer","Peshawar","Uruk","Abydos","Chengdu","Mombasa","Apullum","Byblos","Abu","Pi-Ramesses","Djedu","Kyrene","Athens","Menat Khufu","Niani","Novgorod","Sarmizegetusa","Sigiriya","Selima Oasis","Tournai","Taruga","Amarna","Toledo","Mogadishu","Xinjiang","Yinxu","Bublidrus","Mylyra","Ialezus","Thebeia","Demaphos","Smyrnione","Dimonassa","Cyrarnassus","Posigeneia","Kasmigeneia","Khemdjumunein","Sakpi","Kersatennu","Farsou","Dehsa","Djasumar","Absaitunis","Avsi","Wasvarmeru","Behdju","Galamia","Pekies","VyVyrodari","Viasseto","Messibria","Molfeserta","Quanes","Braga","Seicer","Legara","Albadolid","Getastela","Drepanum","Canusium","Mogontiacum","Leucarum","Pautalia","Scallabis","Chernogan","Yelatrov","Novomoksary","Chistongelsk","Timaryevsk","Naberkuta","Koloyevka","Obnirodvinsk","Beloredimir","Kaspikarino","Troten","Neunsee","Weveltals","Oudenhout","Plailimar","Puciennes","Bernsloh","Geiselkau","Waterlina","Clonkenny","Terbommel","Drachnisse","Werdenthal","Erzell","Arrabona","Ugernum","Bulla Regia","Umbracum","Aquae Armenetiae","Isara","Regium Lepidum","Aquisgranium","Gerasa"],civitas.NAMES=["Pan","Victor","Lekan","Sheamus","Itumeleng","Varya","Gervas","Stefanija","Meera","Sethunya","Qadir","Lim","Yami","Veasna","Baadur","Sharar","Yuuta","Hallie","Anson","Davis","Ondina","Zan","Gibs","Soth","Naoki","Hachirou","Irmhild"],civitas.EVENT_EFFECT_DESTROY_BUILDING=0,civitas.EVENT_EFFECT_LOSE_COINS=1,civitas.EVENT_EFFECT_GAIN_COINS=2,civitas.EVENT_EFFECT_RAISE_INFLUENCE=3,civitas.EVENT_EFFECT_LOWER_INFLUENCE=4,civitas.EVENT_EFFECT_LOSE_FAME=5,civitas.EVENT_EFFECT_GAIN_FAME=6,civitas.EVENT_EFFECT_LOSE_ESPIONAGE=7,civitas.EVENT_EFFECT_GAIN_ESPIONAGE=8,civitas.EVENTS=[{name:"Great earthquake",handle:"earthquake1",description:"",chance:1e-4,effect:civitas.EVENT_EFFECT_DESTROY_BUILDING,data:{amount:1}},{name:"Royal marriage",handle:"marriage",description:"A marriage was arranged between a member of your family and the royal family of SETTLEMENT. This raises your influence on SETTLEMENT. Good job!",chance:.003,effect:civitas.EVENT_EFFECT_RAISE_INFLUENCE,data:{amount:50,settlement:"Rome"}},{name:"Raiders attack",handle:"raiders",description:"A band of raiders attacked the outskirts of your settlement. Repairing the affected buildings costs your settlement AMOUNT coins.",chance:.001,effect:civitas.EVENT_EFFECT_LOSE_COINS,data:{amount:1e3}},{name:"Discovery",handle:"discovery",description:"The engineers in your settlement made a great discovery which made you more famous, thus gaining AMOUNT fame.",chance:.006,effect:civitas.EVENT_EFFECT_GAIN_FAME,data:{amount:100}},{name:"Spy found",handle:"spyfound",description:"A spy from SETTLEMENT was found hiding in your settlement, as a reward for finding him you gain AMOUNT espionage.",chance:.006,effect:civitas.EVENT_EFFECT_GAIN_ESPIONAGE,data:{amount:10,settlement:"Uruk"}},{name:"Spy uncovered",handle:"spydiscovered",description:"One of your spies in SETTLEMENT was discovered, SETTLEMENT`s ruler is angry so you lose AMOUNT espionage.",chance:.008,effect:civitas.EVENT_EFFECT_LOSE_ESPIONAGE,data:{amount:10,settlement:"Carthage"}}],civitas.RESOURCES={coins:{name:"Coins"},fame:{name:"Fame"},prestige:{name:"Prestige"},espionage:{name:"Espionage"},research:{name:"Research"},faith:{name:"Faith"},almonds:{name:"Almonds",price:200},armor:{name:"Armor",price:200},barrels:{name:"Barrels",price:60},beer:{name:"Beer",price:30},books:{name:"Books",price:120},bread:{name:"Bread",price:30},brine:{name:"Brine",price:10},brass:{name:"Brass",price:60},candles:{name:"Candles",price:100},candlesticks:{name:"Candlesticks",price:170},cannons:{name:"Cannons",price:700,imported:!0},carpets:{name:"Carpets",price:400,imported:!0},catapults:{name:"Catapults",price:1200},cattle:{name:"Cattle",price:41},cider:{name:"Cider",price:42},clay:{name:"Clay",price:35},clothes:{name:"Clothes",price:104},coal:{name:"Coal",price:34},coffee:{name:"Coffee",price:240},coffeebeans:{name:"Coffee Beans",price:136},copper:{name:"Copper",price:43},dates:{name:"Dates",price:140,imported:!0},donkeys:{name:"Donkeys",price:90,imported:!0},fish:{name:"Fish",price:16},flour:{name:"Flour",price:42},furcoats:{name:"Fur coats",price:122},furs:{name:"Furs",price:78},gems:{name:"Gems",price:460},glass:{name:"Glass",price:86},glasses:{name:"Glasses",price:140},gold:{name:"Gold",price:194},goldores:{name:"Gold ores",price:90},grapes:{name:"Grapes",price:35},hemp:{name:"Hemp",price:46},herbs:{name:"Herbs",price:18},hides:{name:"Hides",price:25},indigo:{name:"Indigo",price:80},iron:{name:"Iron",price:86},ironores:{name:"Iron ores",price:45},leather:{name:"Leather",price:60},marzipan:{name:"Marzipan",price:280,imported:!0},meat:{name:"Meat",price:30},milk:{name:"Milk",price:55},mosaic:{name:"Mosaic",price:200},paper:{name:"Paper",price:70},pearls:{name:"Pearls",price:450},perfume:{name:"Perfume",price:305},pottery:{name:"Pottery",price:60},provisions:{name:"Provisions",price:300},quartz:{name:"Quartz",price:26},robes:{name:"Robes",price:400},ropes:{name:"Ropes",price:42},roses:{name:"Roses",price:70},salt:{name:"Salt",price:20},silk:{name:"Silk",price:320},silver:{name:"Silver",price:300,imported:!0},spices:{name:"Spices",price:285},spyglasses:{name:"Spyglasses",price:280,imported:!0},statues:{name:"Statues",price:800,imported:!0},stones:{name:"Stones",price:16},sugar:{name:"Sugar",price:145},sugarcane:{name:"Sugarcane",price:120},sulphur:{
name:"Sulphur",price:180,imported:!0},tools:{name:"Tools",price:35,imported:!0},wax:{name:"Wax",price:40},weapons:{name:"Weapons",price:205},wheat:{name:"Wheat",price:25},wine:{name:"Wine",price:95},wood:{name:"Wood",price:17},woodplanks:{name:"Wood Planks",price:40}},civitas.NON_RESOURCES=["coins","fame","prestige","espionage","research","faith"],civitas.MAIN_RESOURCES=["beer","bread","brass","brine","cannons","cattle","cider","clay","clothes","coal","copper","fish","flour","furs","gold","goldores","herbs","hides","iron","ironores","meat","milk","ropes","salt","stones","weapons","wheat","wine","wood","woodplanks"],civitas.ACHIEVEMENTS=[{id:1,description:"Reach level 10.",name:"Kiddo",conditions:[{settlement_level:10}]},{id:2,description:"Reach level 20.",name:"Teen",conditions:[{settlement_level:20}]},{id:3,description:"Reach level 30.",name:"On my own",conditions:[{settlement_level:30}]},{id:4,description:"Reach level 40.",name:"Fear me",conditions:[{settlement_level:40}]},{id:5,description:"Gather maximum faith.",name:"Jesus Christ",conditions:[{faith:1e3}]},{id:6,description:"Gather maximum research.",name:"Albert Einstein",conditions:[{research:1e3}]},{id:7,description:"Gather 10k coins.",name:"Coinage",conditions:[{coins:1e4}]},{id:8,description:"Gather 50k coins.",name:"Give me coins",conditions:[{coins:5e4}]},{id:9,description:"Gather 100k coins.",name:"Gatherer",conditions:[{coins:1e5}]},{id:10,description:"Gather 1M coins.",name:"Milionaire",conditions:[{coins:1e6}]},{id:11,description:"Gather 10M coins.",name:"Rockefeller",conditions:[{coins:1e7}]},{id:12,description:"Gather 10k stones.",name:"Stone Age",conditions:[{resources:[{stones:1e4}]}]},{id:13,description:"Gather 10k wood.",name:"Woody the Woodpecker",conditions:[{resources:[{wood:1e4}]}]},{id:14,description:"Gather 10k meat.",name:"Animal killer",conditions:[{resources:[{meat:1e4}]}]},{id:15,description:"Recruit 10 soldiers.",name:"Armed",conditions:[{soldiers:10}]},{id:16,description:"Recruit 100 soldiers.",name:"Recruiter",conditions:[{soldiers:100}]},{id:17,description:"Recruit 1000 soldiers.",name:"Armed to the teeth",conditions:[{soldiers:1e3}]},{id:18,description:"Recruit 10 ships.",name:"Shipwrecked",conditions:[{ships:10}]},{id:19,description:"Recruit 100 ships.",name:"Captain Ahab",conditions:[{ships:100}]},{id:20,description:"Gather 100 prestige.",name:"Prestigious",conditions:[{prestige:100}]},{id:21,description:"Gather 500 prestige.",name:"The God King",conditions:[{prestige:500}]},{id:22,description:"Gather 10 espionage.",name:"You got Mossad-ed!",conditions:[{espionage:10}]},{id:23,description:"Gather 100 espionage.",name:"You got Snowden-ed!",conditions:[{espionage:100}]},{id:24,description:"Gather 500 espionage.",name:"I spy with my own eye",conditions:[{espionage:500}]},{id:25,description:"Gather 1000 espionage.",name:"Anna Chapman",conditions:[{espionage:1e3}]},{id:26,description:"Gather 10 research.",name:"Initiate",conditions:[{research:10}]},{id:27,description:"Gather 100 research.",name:"Researcher",conditions:[{research:100}]},{id:28,description:"Gather 500 research.",name:"Searching",conditions:[{research:500}]},{id:29,description:"Gather 500 faith.",name:"Disciple",conditions:[{faith:500}]},{id:30,description:"Build a Castle.",name:"Castlevania",conditions:[{buildings:"castle"}]},{id:31,description:"Build a Church.",name:"Winston Churchill, got it?",conditions:[{buildings:"church"}]},{id:32,description:"Build an Academy.",name:"Academician",conditions:[{buildings:"academy"}]},{id:33,description:"Build each of the mines (Iron, Gold, Copper and Salt).",name:"All mine!",conditions:[{buildings:["iconmine","goldmine","coppermine","saltmine"]}]},{id:34,description:"Fill out all your storage space.",name:"All filled up",conditions:[{storage:0}]},{id:35,description:"Build 10 catapults.",name:"Cat-a-pulter",conditions:[{resources:[{catapults:10}]}]},{id:36,description:"Build an Embassy.",name:"Gandhi",conditions:[{buildings:"embassy"}]},{id:37,description:"Get 100 achievements.",name:"Achivement? Yes please.",conditions:[{achievements:100}]},{id:38,description:"Recruit a mercenary army.",name:"Merc",conditions:[{mercenary:1}]},{id:39,description:"Reach 10 milion in population",name:"Megalopolis",conditions:[{population:1e7}]}],civitas.utils={resource_exists:function(e){for(var t in civitas.RESOURCES)if(t===e)return!0;return!1},get_distance:function(e,t){return Math.floor(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)))},get_distance_in_days:function(e,t){return Math.floor(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))/10)},time_since:function(e){var t=[[2,"One second","1 second from now"],[60,"seconds",1],[120,"One minute","1 minute from now"],[3600,"minutes",60],[7200,"One hour","1 hour from now"],[86400,"hours",3600],[172800,"One day","tomorrow"],[604800,"days",86400],[1209600,"One week","next week"],[2419200,"weeks",604800],[4838400,"One month","next month"],[29030400,"months",2419200],[58060800,"One year","next year"],[290304e4,"years",29030400],[580608e4,"One century","next century"],[580608e5,"centuries",290304e4]],i=(new Date-e)/1e3,s=1;i<0&&(i=Math.abs(i),s=1);for(var a,r=0;a=t[r++];)if(i<a[0])return"string"==typeof a[2]?a[s]:Math.floor(i/a[2])+" "+a[1];return e},get_up_number:function(e){return 10*Math.floor(e/10)},get_random:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},get_random_by_importance:function(e){return civitas.utils.get_up_number(civitas.utils.get_random(10*Math.floor(Math.random()*e)+10,10*Math.floor(Math.random()*e)+20))},get_resource_name:function(e){return civitas.RESOURCES[e].name},calc_price_minus_discount:function(e,t,i){return Math.ceil(Math.ceil(civitas.RESOURCES[t].price-i)*e)},calc_price:function(e,t){return Math.ceil(e*civitas.RESOURCES[t].price)},calc_price_plus_discount:function(e,t,i){return Math.ceil(Math.ceil(civitas.RESOURCES[t].price+i)*e)},get_now:function(){var e=new Date;return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},nice_numbers:function(e){return e>=1e9?(e/1e9).toFixed(1).replace(/\.0$/,"")+"G":e>=1e6?(e/1e6).toFixed(1).replace(/\.0$/,"")+"M":e>=1e3?(e/1e3).toFixed(1).replace(/\.0$/,"")+"K":e},get_random_unique:function(e){var t=civitas.utils.get_random(0,e.length-1),i=e[t];return e.splice(t,1),i}},civitas.ui={normal_panel:function(e,t){return"<fieldset><legend>"+e+"</legend>"+t+"</fieldset>"},cost_panel:function(e){var t="";if(void 0!==e){t+="<dt>"+civitas.l("Cost")+"</dt>";for(var i in e)t+="<dd>"+civitas.utils.nice_numbers(e[i])+civitas.ui.resource_small_img(i)+"</dd>"}return t},progress:function(e,t,i){void 0===t&&(t="small");var s="";return e<10?s=" ubad":e>=10&&e<30?s=" vbad":e>=30&&e<40?s=" bad":e>=40&&e<60?s=" good":e>=60&&e<90?s=" vgood":e>=90&&(s=" ugood"),'<div class="progress '+t+'"><span class="bar'+s+'" style="width:'+e+'%">'+(void 0!==i?i:e)+"</span></div>"},army_img:function(e){return'<img class="tips" title="'+e+'" src="'+civitas.ASSETS_URL+"images/armies/"+e.toLowerCase().replace(/ /g,"_")+'_small.png" />'},army_list:function(e,t){var i="<dl"+(void 0!==t&&t===!0?' class="nomg"':"")+">",s=0;for(var a in e.army)i+="<dt>"+e.army[a]+"</dt><dd>"+civitas.ui.army_img(a)+"</dd>",s+=e.army[a];return i+="<dt>"+(void 0!==e.total?e.total:s)+"</dt><dd>"+civitas.l("Total")+"</dd></dl>"},window_exists:function(e){return 0!=$(e).length},panel_exists:function(e){return 0!=$(e).length},panel_btn:function(e,t,i,s,a){return'<a title="'+t+'" data-handle="'+i+'" class="tips '+s+(a===!0?" disabled":"")+'" href="#">'+e+"</a></td>"},trades_list:function(e,t){t=void 0===t||"imports"===t?"imports":"exports";var i="";if(null!==e){i+="<dl>";var s=e[t];for(var a in s)i+="<dt>"+s[a]+"</dt><dd>"+civitas.ui.resource_small_img(a)+"</dd>";i+="</dl>"}return i},navy_list:function(e,t){var i="<dl"+(void 0!==t&&t===!0?' class="nomg"':"")+">",s=0;for(var a in e.navy)i+="<dt>"+e.navy[a]+"</dt><dd>"+civitas.ui.army_img(a)+"</dd>",s+=e.navy[a];return i+="<dt>"+(void 0!==e.total?e.total:s)+"</dt><dd>"+civitas.l("Total")+"</dd></dl>"},building_element:function(e){var t=e.type;e.data.description;"house"===e.type.slice(0,-1)&&(t=e.type.slice(0,-1));var i=void 0===e.data.visible_upgrades||e.data.visible_upgrades===!1?t+"1":t+e.data.level;return'<div data-type="'+e.type+'" data-level="'+e.data.level+'" style="background:transparent url('+civitas.ASSETS_URL+"images/buildings/"+i+".png) no-repeat;left:"+e.data.position.x+"px;top:"+e.data.position.y+"px\" title='"+e.data.name+"' id=\"building-"+e.data.handle+'"class="tips slots building"></div>'},resource_storage_el:function(e,t){return'<div class="storage-item item-'+e+'"><span class="title">'+civitas.utils.get_resource_name(e)+'</span><img src="'+civitas.ASSETS_URL+"images/resources/"+e+'.png" /><span class="amount">'+t+"</amount></div>"},tabs:function(e){for(var t='<div class="tabs"><ul>',i=0;i<e.length;i++)t+='<li><a href="#tab-'+e[i].toLowerCase()+'">'+e[i]+"</a></li>";t+="</ul>";for(var i=0;i<e.length;i++)t+='<div id="tab-'+e[i].toLowerCase()+'"></div>';return t+="</div>"},materials_panel:function(e){var t="";if(void 0!==e){t+="<dt>"+civitas.l("Uses")+"</dt>";for(var i in e)t+="<dd>"+e[i]+civitas.ui.resource_small_img(i)+"</dd>"}return t},chance_panel:function(e,t){var i="";if(void 0!==e){i+="<dt>"+civitas.l("Extra materials")+"</dt>";for(var s in e)i+="<dd>"+100*(t*e[s]).toFixed(4)+"%"+civitas.ui.resource_small_img(s)+"</dd>"}return i},production_panel:function(e,t){var i="";if(void 0!==e){i+="<dt>"+civitas.l("Produces")+"</dt>";for(var s in e)i+="<dd>"+t*e[s]+civitas.ui.resource_small_img(s)+"</dd>"}return i},requires_panel:function(e){var t="";if(void 0!==e.buildings){t+="<dt>"+civitas.l("Requires")+"</dt>",t+="<dd>";for(var i=0;i<e.buildings.length;i++){t+=civitas.BUILDINGS[civitas.BUILDINGS.findIndexM(e.buildings[i])].name+"<br />"}t+="</dd>"}return t},tax_panel:function(e,t){var i="";return void 0!==e&&(i+="<dt>"+civitas.l("Tax")+"</dt>",i+="<dd>"+t*e+civitas.ui.resource_small_img("coins")+"</dd>"),i},storage_panel:function(e,t){var i="";return void 0!==e&&(i+="<dt>"+civitas.l("Storage")+"</dt>",i+="<dd>"+t*e+'<img alt="Storage space" class="tips" title="'+civitas.l("Storage Space")+'" src="'+civitas.ASSETS_URL+'images/resources/storage_small.png" /></dd>'),i},resource_small_img:function(e){return'<img alt="'+civitas.utils.get_resource_name(e)+'" class="tips" title="'+civitas.utils.get_resource_name(e)+'" src="'+civitas.ASSETS_URL+"images/resources/"+e+'_small.png" />'}},civitas.objects.settlement=function(e){return this.id=null,this.settlement_type=null,this.name=null,this.ruler=null,this.core=null,this.buildings=[],this.buildings_list=[],this.storage=0,this.population=1,this.climate=null,this.army=[],this.player=!1,this.navy=[],this.mercenary=[],this.mercenary_list=[],this.resources={},this.level=1,this.trades=null,this.icon=null,this.status=null,this.__init=function(e){return this.core=e.core,this.id=e.id,this.name=e.name,this.player=void 0!==e.player&&e.player,this.level=void 0!==e.level?e.level:1,this.resources=void 0!==e.resources?e.resources:this._build_resources(e),this.climate=void 0!==e.climate?e.climate:civitas.CLIMATE_TEMPERATE,this.religion=void 0!==e.religion?e.religion:civitas.RELIGION_NONE,this.ruler=e.ruler,this.icon=void 0!==e.icon?e.icon:1,this.population=void 0!==e.population?e.population:this.level*civitas.POPULATION_PER_LEVEL,this.settlement_type=void 0!==e.settlement_type?e.settlement_type:civitas.CITY,void 0!==e.trades?this.trades=e.trades:this.reset_trades(),void 0!==e.army_list&&this.setup_army(e.army_list),void 0!==e.navy_list&&this.setup_navy(e.navy_list),void 0!==e.mercenary_list?this.setup_mercenary(e.mercenary_list):this.mercenary=[],this.is_player()===!1&&(this.resources.fame=civitas.LEVELS[this.get_level()]),this.status=void 0!==e.status?e.status:{},this},this.export=function(){var e={id:this.get_id(),name:this.get_name(),player:this.is_player(),level:this.get_level(),climate:this.get_climate().id,religion:this.get_religion().id,ruler:this.get_ruler(),icon:this.get_icon(),trades:this.get_trades(),resources:this.get_resources(),army_list:this.get_army_total().army,navy_list:this.get_navy_total().navy,buildings:this.get_buildings_list(),settlement_type:this.get_settlement_type(),population:this.get_population(),mercenary_list:this.get_mercenary_list()};return this.is_player()===!0&&(e.status=this.get_status()),e},this._build_resources=function(e){var t={},i=this.get_core().get_difficulty();for(var s in civitas.RESOURCES)this.is_player()===!0?void 0===civitas.START_RESOURCES[i-1][s]?t[s]=0:t[s]=civitas.START_RESOURCES[i-1][s]:void 0!==e.resources[s]?t[s]=e.resources[s]:t[s]=0;return t},this.add_to_storage=function(e,t){if(!civitas.utils.resource_exists(e))return this.get_core().error("The resource you specified does not exist."),!1;var i=this.get_resources();return void 0!==i[e]?i[e]=i[e]+t:i[e]=t,!0},this.has_coins=function(e){this.get_resources();return!(this.get_coins()-e<0)||(this.get_core().error(this.get_name()+" doesn`t have enough "+civitas.utils.get_resource_name("coins")+"."),!1)},this.has_resources=function(e,t){return civitas.utils.resource_exists(e)?!(this.get_resources()[e]-t<0&&(this.get_core().error(this.get_name()+" does not have enough "+civitas.utils.get_resource_name(e)+"."),1)):(this.get_core().error("The resource you specified does not exist."),!1)},this.get_buildings=function(){return this.buildings},this.get_name=function(){return this.name},this.set_name=function(e){return this.name=e,this},this.get_core=function(){return this.core},this.level_up=function(){var e=this.get_level();return this.set_fame(civitas.LEVELS[e]),this.level++,this.calc_population(),$(".citylevel").html(this.level),this.get_core().notify("The city of "+this.get_name()+" is now level "+this.level+"."),this},this.rename=function(e){return this.name=e,this},this.is_building_built=function(e){for(var t=this.get_buildings(),i=0;i<t.length;i++)if(void 0!==t[i]&&t[i].type===e)return!0;return!1},this.has_storage_space_for=function(e){var t=this.get_storage_space();return!!this.has_storage_space(!0)&&(!(t.occupied+e>t.all)||(this.get_core().error("There is no storage space in your city to accomodate the new goods."),!1))},this.has_storage_space=function(e){var t=this.get_storage_space();return!(t.occupied>=t.all)||(e===!0&&this.get_core().error("There is no storage space in your city."),!1)},this.get_storage_space=function(){var e=0;for(var t in this.get_resources())$.inArray(t,civitas.NON_RESOURCES)===-1&&(e+=this.get_resources()[t]);return{occupied:e,all:this.storage}},this._create_buildings=function(e,t){if(t=void 0!==t&&t===!0,"object"==typeof e)for(var i=0;i<e.length;i++){var s=void 0!==e[i].handle?e[i].handle:e[i],a=void 0!==e[i].level?e[i].level:1,r=void 0===e[i].working||e[i].working,n=civitas.BUILDINGS.findIndexM(s);if(n!==!1){var o=civitas.BUILDINGS[n];a>1&&(o.level=a);var c=new civitas.objects.building({settlement:this,type:s,data:o,hidden:t,working:r});this.buildings.push(c),this.buildings_list.push({handle:s,level:a,working:r})}}else{var s=void 0!==e.handle?e.handle:e,a=void 0!==e.level?e.level:1,r=void 0===e.working||e.working,n=civitas.BUILDINGS.findIndexM(s);if(n!==!1){var o=civitas.BUILDINGS[n];a>1&&(o.level=a);var c=new civitas.objects.building({settlement:this,type:s,data:o,hidden:t,working:r});this.buildings.push(c),this.buildings_list.push({handle:s,level:a,working:r})}}return!1},this.build=function(e){var t=civitas.BUILDINGS.findIndexM(e);if(t!==!1){var i=civitas.BUILDINGS[t];if(void 0!==i.requires.settlement_level&&this.level<i.requires.settlement_level)return this.get_core().error("Your city level is too low to construct this building."),!1;if(void 0!==i.requires.buildings)for(var s=i.requires.buildings,a=0;a<s.length;a++)if(!this.is_building_built(s[a])){var r=civitas.BUILDINGS.findIndexM(s[a]);return r=civitas.BUILDINGS[r],this.get_core().error("You don`t have the required building "+r.name+"."),!1}for(var n in i.cost)if(this.get_resources()[n]-i.cost[n]<0)return this.get_core().error("You don`t have enough "+n+" to construct this building."),!1;for(var n in i.cost)this.get_resources()[n]-i.cost[n]>=0&&(this.get_resources()[n]=this.get_resources()[n]-i.cost[n]);var o=new civitas.objects.building({settlement:this,type:e,data:i});return this.buildings.push(o),this.buildings_list.push({handle:e,level:1,stopped:!1}),this.raise_prestige(),this.get_core().save_and_refresh(),this.get_core().notify("New building constructed: "+o.get_name()),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0}),o}return!1},this.get_rank=function(){var e=this.get_level(),t=Math.round(e/2);return{fame:this.get_fame(),prestige:this.get_prestige(),espionage:this.get_espionage(),army:this.get_army_total().total,navy:this.get_navy_total().total,score:Math.floor(((this.get_fame()>0?this.get_fame():1)/t+this.get_prestige()/t+this.get_espionage()/t+(this.get_army_total().total>0?this.get_army_total().total:1)/t+(this.get_navy_total().total>0?this.get_navy_total().total:1)/(t/2))/t)}},this.get_building_by_handle=function(e){for(var t=this.get_buildings(),i=0;i<t.length;i++)if(void 0!==t[i]&&t[i].get_type()===e)return t[i];return!1},this.demolish=function(e){if("number"==typeof e){if(e>0)return this.buildings.splice(e,1),this.buildings_list.splice(e,1),!0}else if("string"==typeof e&&"marketplace"!==e){for(var t=0;t<this.buildings.length;t++)this.buildings[t].get_type()===e&&this.buildings.splice(t,1);var i=this.buildings_list.findIndexM(e);return i!==!1&&this.buildings_list.splice(i,1),this.get_core().save(),!0}return!1},this.get_coins=function(){return this.resources.coins},this.inc_coins=function(e){return this.set_coins(this.get_coins()+e)},this.dec_coins=function(e){return!!this.has_coins(e)&&(this.set_coins(this.get_coins()-e),!0)},this.set_coins=function(e){return this.resources.coins=e,e},this.set_coins=function(e){return this.resources.coins=e,this},this.remove_resource=function(e,t){var i=this.get_resources();return!!this.has_resources(e,t)&&(i[e]=i[e]-t,!0)},this.remove_resources=function(e){var t=this.get_resources();for(var i in e)if(!this.has_resources(i,e[i]))return!1;for(var i in e)t[i]=t[i]-e[i];return!0},this.city_council=function(){var e=this.get_resources(),t=this.get_storage_space(),i=[];0===this.army.length&&i.push("You have no army, this is an open invitation for attack."),this.army.length<10&&this.army.length>0&&i.push("You have a small army, try to recruit some more soldiers."),0===this.navy.length&&i.push("You have no navy, this is an open invitation for attack."),this.army.length<3&&this.army.length>0&&i.push("You have a small navy, try to construct some more ships."),t.occupied>=t.all?i.push("You have no storage space to store your new goods and they will be lost. Sell some goods or build a warehouse."):t.all-t.occupied<100&&i.push("You will soon run out of storage space and all goods produced will be lost. Sell some goods or build a warehouse."),e.coins<1e3&&i.push("You seem to be losing coins fast, sell some goods or upgrade your houses to get better taxes."),(e.wood<100||e.stones<100||e.woodplanks<50)&&i.push("You are lacking construction materials, buy some stones, wood planks and/or wood off the World Trade Market."),e.prestige<100&&i.push("Your settlement`s prestige is too low, start doing trades with the other settlements to improve it."),e.faith>=999&&i.push("You are at maximum faith, start using it from your settlement`s Church."),e.research>=999&&i.push("You are at maximum research, start using it for settlement researches, from your Academy."),e.espionage>=999&&i.push("You are at maximum espionage, start using it for espionage missiong from your Embassy."),e.coins>1e5&&i.push("You have lots of coins, why not invest some in goods?");for(var s in this.resources)$.inArray(s,civitas.NON_RESOURCES)===-1&&e[s]>1e3&&i.push("You seem to have a surplus of "+civitas.utils.get_resource_name(s)+". You can sell some and get coins instead.");for(var a=this.get_buildings(),r=[],n=0;n<a.length;n++)a[n].has_problems()&&r.push(a[n].get_name());return r.length>0&&i.push((1===r.length?"One":"Several")+" of your buildings ("+r.join(", ")+") "+(1===r.length?"is":"are")+" not working due to a shortage of materials. Buy more goods."),i},this.get_resources=function(){return this.resources},this.set_resources=function(e){return this.resources=e,this},this.get_ruler=function(){return this.ruler},this.get_ruler_name=function(){return this.ruler.name},this.get_ruler_personality=function(){return this.ruler.personality},this.get_ruler_nationality=function(){return this.ruler.nationality},this.set_ruler=function(e){return this.ruler=e,this},this.set_level=function(e){return this.level=e,this},this.get_level=function(){return this.level},this.get_personality=function(){return{id:this.ruler.personality,name:civitas.PERSONALITIES[this.ruler.personality]}},this.get_climate=function(){return{id:this.climate,name:civitas.CLIMATES[this.climate]}},this.get_nationality=function(){return{id:this.ruler.nationality,name:civitas.NATIONS[this.ruler.nationality]}},this.get_icon=function(){return this.icon},this.set_icon=function(e){return this.icon=e,this},this.get_ruler_avatar=function(){return this.ruler.avatar},this.set_climate=function(e){return this.climate=e,this},this.set_nationality=function(e){return this.nationality=e,this},this.get_buildings_list=function(){return this.buildings_list},this.get_id=function(){return this.id},this.set_id=function(e){return this.id=e,this},this.is_player=function(){return this.player},this.get_settlement_type=function(){return this.settlement_type},this.get_population=function(){return this.population},this.is_city=function(){return this.settlement_type===civitas.CITY},this.calc_population=function(){return this.population=this.get_level()*civitas.POPULATION_PER_LEVEL},this.is_village=function(){return this.settlement_type===civitas.VILLAGE},this.refresh_heroes=function(){this.is_building_built("tavern")},this.__init(e)},civitas.objects.settlement.prototype.can_research=function(){return this.is_building_built("academy")},civitas.objects.settlement.prototype.get_research=function(){return this.resources.research},civitas.objects.settlement.prototype.raise_research=function(e){return void 0===e&&(e=1),this.set_research(this.get_research()+e)},civitas.objects.settlement.prototype.lower_research=function(e){return void 0===e&&(e=1),this.set_research(this.get_research()-e)},civitas.objects.settlement.prototype.reset_research=function(){return this.resources.research=1,this},civitas.objects.settlement.prototype.set_research=function(e){return this.resources.research>=civitas.MAX_RESEARCH_VALUE?this.resources.research=civitas.MAX_RESEARCH_VALUE:this.resources.research<1?this.resources.research=1:this.resources.research=e,$(".cityresearch").html(this.get_research()),this.get_research()},civitas.objects.settlement.prototype.get_fame=function(){return this.resources.fame},civitas.objects.settlement.prototype.raise_fame=function(e){return void 0===e&&(e=1),this.set_fame(this.get_fame()+e)},civitas.objects.settlement.prototype.lower_fame=function(e){return void 0===e&&(e=1),this.set_fame(this.get_fame()-e)},civitas.objects.settlement.prototype.set_fame=function(e){var t=civitas.LEVELS[this.get_level()];return this.resources.fame>=civitas.LEVELS[civitas.MAX_SETTLEMENT_LEVEL-1]?this.resources.fame=civitas.LEVELS[civitas.MAX_SETTLEMENT_LEVEL-1]:this.resources.fame<1?this.resources.fame=1:this.resources.fame=e,$("header .cityfame > span").css({width:Math.floor(100*this.get_fame()/t)+"%"}),e},civitas.objects.settlement.prototype.reset_fame=function(){return this.set_fame(1),this},civitas.objects.settlement.prototype.change_religion=function(e){return this.get_faith()!==civitas.MAX_FAITH_VALUE&&0!==e?(this.is_player()&&this.get_core().error("You don`t have enough faith to switch religions."),!1):"number"==typeof e&&this.get_religion().id===e||"string"==typeof e&&this.get_religion().name===e?(this.is_player()&&this.get_core().error("You cannot switch religion to your already existing one."),!1):this.set_religion(e)?(this.reset_faith(),this.refresh_heroes(),this.is_player()&&this.get_core().notify("Your settlement`s new religion is <strong>"+this.get_religion().name.capitalize()+"</strong>"),this.get_core().save_and_refresh(),!0):(this.is_player()&&this.get_core().error("Unable to switch religion to the specified one."),!1)},civitas.objects.settlement.prototype.set_religion=function(e){if("number"==typeof e)return this.religion=e,!0;if("string"==typeof e){var t=$.inArray(e,civitas.RELIGIONS);if(t!==-1)return this.religion=t,!0}return!1},civitas.objects.settlement.prototype.get_religion=function(){return{id:this.religion,name:civitas.RELIGIONS[this.religion]}},civitas.objects.settlement.prototype.get_faith=function(){return this.resources.faith},civitas.objects.settlement.prototype.raise_faith=function(e){return void 0===e&&(e=1),this.set_faith(this.get_faith()+e)},civitas.objects.settlement.prototype.lower_faith=function(e){return void 0===e&&(e=1),this.set_faith(this.get_faith()-e)},civitas.objects.settlement.prototype.reset_faith=function(){return this.resources.faith=1,this},civitas.objects.settlement.prototype.set_faith=function(e){return this.resources.faith>=civitas.MAX_FAITH_VALUE?this.resources.faith=civitas.MAX_FAITH_VALUE:this.resources.faith<1?this.resources.faith=1:this.resources.faith=e,this.get_faith()},civitas.objects.settlement.prototype.get_espionage=function(){return this.resources.espionage},civitas.objects.settlement.prototype.raise_espionage=function(e){return void 0===e&&(e=1),this.set_espionage(this.get_espionage()+e)},civitas.objects.settlement.prototype.lower_espionage=function(e){return void 0===e&&(e=1),this.set_espionage(this.get_espionage()-e)},civitas.objects.settlement.prototype.reset_espionage=function(){return this.resources.espionage=1,this},civitas.objects.settlement.prototype.set_espionage=function(e){return this.resources.espionage>=civitas.MAX_ESPIONAGE_VALUE?this.resources.espionage=civitas.MAX_ESPIONAGE_VALUE:this.resources.espionage<1?this.resources.espionage=1:this.resources.espionage=e,$(".cityespionage").html(this.get_espionage()),this.get_espionage()},civitas.objects.settlement.prototype.get_prestige=function(){return this.resources.prestige},civitas.objects.settlement.prototype.raise_prestige=function(e){return void 0===e&&(e=1),this.set_prestige(this.get_prestige()+e)},civitas.objects.settlement.prototype.lower_prestige=function(e){return void 0===e&&(e=1),this.set_prestige(this.get_prestige()-e)},civitas.objects.settlement.prototype.reset_prestige=function(){return this.resources.prestige=1,this},civitas.objects.settlement.prototype.set_prestige=function(e){return this.resources.prestige>=civitas.MAX_PRESTIGE_VALUE?this.resources.prestige=civitas.MAX_PRESTIGE_VALUE:this.resources.prestige<1?this.resources.prestige=1:this.resources.prestige=e,$(".cityprestige").html(this.get_prestige()),this.get_prestige()},civitas.objects.settlement.prototype.setup_mercenary=function(e){for(var t=0;t<e.length;t++)this.recruit_mercenary_army(e[t],!0);return this},civitas.objects.settlement.prototype.get_mercenary_list=function(){return this.mercenary_list},civitas.objects.settlement.prototype.can_build_ships=function(){return this.is_building_built("shipyard")},civitas.objects.settlement.prototype.can_recruit_soldiers=function(){return this.is_building_built("camp")||this.is_building_built("castle")},civitas.objects.settlement.prototype.recruit_mercenary_army=function(e,t){for(var i=0;i<civitas.MERCENARIES.length;i++)if(e===civitas.MERCENARIES[i].handle){var s=civitas.MERCENARIES[i].cost;if(this.dec_coins(s)===!1)return!1;var a={id:i,handle:e,army:[]};for(var r in civitas.MERCENARIES[i].army){var n=civitas.SOLDIERS[r],o=new civitas.objects.soldier({name:r,settlement:this,data:n});a.army.push(o)}return this.mercenary.push(a),t!==!0&&(this.get_core().notify("The mercenaries of the "+civitas.MERCENARIES[i].name+" are now available for skirmish missions for the duration of one year.","Mercenaries recruited."),this.get_core().refresh(),this.get_core().save()),!0}return!1},civitas.objects.settlement.prototype.recruit_ship=function(e){for(var t in civitas.SHIPS)if(e===t){var i=civitas.SHIPS[t];if(!this.remove_resources(i.cost))return!1;var s=new civitas.objects.ship({name:t,data:i,settlement:this});return this.navy.push(s),this.get_core().refresh(),this.get_core().notify("A new "+e+" ship has been constructed.","New ship"),this.get_core().save(),!0}return!1},civitas.objects.settlement.prototype.recruit_soldier=function(e){for(var t in civitas.SOLDIERS)if(e===t){var i=civitas.SOLDIERS[t];if(!this.remove_resources(i.cost))return!1;var s=new civitas.objects.soldier({settlement:this,name:t,data:i});return this.army.push(s),this.get_core().save_and_refresh(),this.get_core().notify("A new "+e+" has been recruited.","New soldier"),!0}return!1},civitas.objects.settlement.prototype._recruit_ship=function(e){for(var t in civitas.SHIPS)if(e===t){var i=civitas.SHIPS[t],s=new civitas.objects.ship({name:t,data:i,settlement:this});this.navy.push(s)}return this},civitas.objects.settlement.prototype._recruit_soldier=function(e){for(var t in civitas.SOLDIERS)if(e===t){var i=civitas.SOLDIERS[t],s=new civitas.objects.soldier({name:t,data:i,settlement:this});this.army.push(s)}return this},civitas.objects.settlement.prototype.get_navy_size=function(){return this.get_navy().length},civitas.objects.settlement.prototype.get_army_size=function(){return this.get_army().length},civitas.objects.settlement.prototype.disband_ship=function(e){for(var t=this.get_navy(),i=0;i<t.length;i++){if(t[i].get_name()===e)return delete t.soldier[i],!0}return!1},civitas.objects.settlement.prototype.disband_soldier=function(e){for(var t=this.get_army(),i=0;i<t.length;i++){if(t[i].get_name()===e)return delete t.soldier[i],!0}return!1},civitas.objects.settlement.prototype.set_mercenary=function(e){return this.mercenary=e,this},civitas.objects.settlement.prototype.set_navy=function(e){return this.navy=e,this},civitas.objects.settlement.prototype.set_army=function(e){return this.army=e,this},civitas.objects.settlement.prototype.release_mercenaries=function(){return this.mercenary=[],this.get_core().notify("At the end of the year, mercenaries from your city have been released."),this},civitas.objects.settlement.prototype.setup_navy=function(e,t){if(void 0===t&&(t=!0),void 0===e){var i=this.data.navy;for(var s in i)for(var a=0;a<i[s];a++)t===!0?this._recruit_ship(s):this.recruit_ship(s)}else{var i=e;for(var s in i)for(var a=0;a<i[s];a++)t===!0?this._recruit_ship(s):this.recruit_ship(s)}return this},civitas.objects.settlement.prototype.setup_army=function(e,t){if(void 0===t&&(t=!0),void 0===e){var i=this.data.army;for(var s in i)for(var a=0;a<i[s];a++)t===!0?this._recruit_soldier(s):this.recruit_soldier(s)}else{var i=e;for(var s in i)for(var a=0;a<i[s];a++)t===!0?this._recruit_soldier(s):this.recruit_soldier(s)}return this},civitas.objects.settlement.prototype.get_army=function(){return this.army},civitas.objects.settlement.prototype.get_navy=function(){return this.navy};civitas.objects.settlement.prototype.get_mercenary=function(){return this.mercenary},civitas.objects.settlement.prototype.get_navy_total=function(){var e=0,t={};for(var i in civitas.SHIPS)t[i]=0;for(var s=0;s<this.navy.length;s++){var a=this.navy[s].get_name();for(var i in t)a===i&&(t[i]++,e++)}return{total:e,navy:t}},civitas.objects.settlement.prototype.get_army_total=function(){var e=0,t={};for(var i in civitas.SOLDIERS)t[i]=0;for(var s=0;s<this.army.length;s++){var a=this.army[s].get_name();for(var i in t)a===i&&(t[i]++,e++)}return{total:e,army:t}},civitas.objects.settlement.prototype.get_mercenary_total=function(){var e=0,t={};for(var i in civitas.SOLDIERS)t[i]=0;for(var s=0;s<this.mercenary.length;s++){var a=this.mercenary[s].get_name();for(var i in t)a===i&&(t[i]++,e++)}return{total:e,mercenary:t}},
civitas.objects.settlement.prototype.is_mercenary_recruited=function(e){for(var t=0;t<this.mercenary.length;t++)if(this.mercenary[t].handle===e)return!0;return!1},civitas.objects.settlement.prototype.diplomacy=function(e,t){return this.can_diplomacy()===!0&&("number"==typeof e?(this.status[e].status=t,t===civitas.DIPLOMACY_WAR&&(this.status[e].influence=0)):"object"==typeof e&&(this.status[e.get_id()].status=t,t===civitas.DIPLOMACY_WAR&&(this.status[e].influence=0)),this.get_core().save_and_refresh(),!0)},civitas.objects.settlement.prototype.can_diplomacy=function(){return this.is_building_built("embassy")},civitas.objects.settlement.prototype.get_influence_with_settlement=function(e){return"number"==typeof e?this.status[e].influence:"object"==typeof e?this.status[e.get_id()].influence:"string"==typeof e?this.status[this.get_core().get_settlement(e)].influence:void 0},civitas.objects.settlement.prototype.set_status=function(e){return this.status=e,this},civitas.objects.settlement.prototype.lower_influence=function(e,t){return void 0===t&&(t=1),this.set_influence(e,this.get_influence_with_settlement(e)-t)},civitas.objects.settlement.prototype.set_influence=function(e,t){return"object"==typeof e?e=e.get_id():"string"==typeof e&&(e=this.get_core().get_settlement(e)),this.status[e].influence>=civitas.MAX_INFLUENCE_VALUE?this.status[e].influence=civitas.MAX_INFLUENCE_VALUE:this.status[e].influence<1?this.status[e].influence=1:this.status[e].influence=t,this.get_influence_with_settlement(e)},civitas.objects.settlement.prototype.raise_influence=function(e,t){return void 0===t&&(t=1),this.set_influence(e,this.get_influence_with_settlement(e)+t)},civitas.objects.settlement.prototype.get_status=function(){return this.status},civitas.objects.settlement.prototype.get_diplomacy_status=function(e){return{id:this.status[e].status,name:civitas.DIPLOMACIES[this.status[e].status]}},civitas.objects.settlement.prototype.propose_pact=function(e){return this.can_diplomacy()===!0},civitas.objects.settlement.prototype.assign_spy=function(e){return this.can_diplomacy()===!0},civitas.objects.settlement.prototype.can_trade=function(){return this.is_building_built("tradingpost")},civitas.objects.settlement.prototype.buy_from_settlement=function(e,t,i){if(!civitas.utils.resource_exists(t))return this.get_core().error("The resource you specified does not exist."),!1;if(this.can_trade()){var s;this.get_resources();if("string"==typeof e||"number"==typeof e){if(s=this.get_core().get_settlement(e),e===!1)return this.get_core().error(e+" does not exist."),!1}else s=e;var a=this.get_religion().id===s.get_religion().id,r=s.get_trades();if(null===r)return this.get_core().error(e+" does not trade any goods."),!1;if(void 0===r.exports)return this.get_core().error(e+" does not export any goods."),!1;for(var n in r.exports)if(n===t){void 0===i&&(i=r.exports[n]);var o=Math.ceil(civitas.RESOURCES[n].price*civitas.TRADES_ADDITION/100),c=civitas.utils.calc_price_plus_discount(i,n,o),l=civitas.utils.calc_price(i,n),d=Math.ceil(civitas.RESOURCES[n].price+o);return!!this.has_storage_space_for(i)&&(this.dec_coins(c)!==!1&&(s.inc_coins(l),this.add_to_storage(n,i),this.remove_from_exports(s,n,i),this.raise_influence(s.get_id(),a?2*civitas.IMPORT_INFLUENCE:civitas.IMPORT_INFLUENCE),this.raise_prestige(a?2*civitas.IMPORT_PRESTIGE:civitas.IMPORT_PRESTIGE),this.raise_fame(50),this.get_core().refresh(),this.get_core().notify(this.get_name()+" bought <strong>"+i+"</strong> "+civitas.utils.get_resource_name(n)+" from "+e+" for <strong>"+d+"</strong> coins each, for a total of <strong>"+c+"</strong> coins.",civitas.l("World Market")),{buyer:this.get_name(),amount:i,goods:civitas.utils.get_resource_name(n),seller:e,price:Math.round(civitas.RESOURCES[n].price+o),totalPrice:c}))}this.get_core().error(e+" does not export the requested goods.")}return!1},civitas.objects.settlement.prototype.reset_trades=function(){var e={imports:{},exports:{}};if(void 0!==civitas.SETTLEMENTS[this.get_id()]){var t=civitas.SETTLEMENTS[this.get_id()].trades;for(var i in t)for(var s in t[i])e[i][s]=civitas.utils.get_random_by_importance(t[i][s]);return this.trades=e,!0}return this.trades=e,!1},civitas.objects.settlement.prototype.list_black_market=function(e,t){if(!civitas.utils.resource_exists(e))return this.get_core().error("The resource you specified does not exist."),!1;this.get_resources();if(this.remove_resource(e,t)){var i=Math.ceil(civitas.RESOURCES[e].price*civitas.BLACK_MARKET_DISCOUNT/100),s=civitas.utils.calc_price_minus_discount(t,e,i);return this.get_core().add_black_market(e,t,s),this.get_core().refresh(),this.get_core().notify(this.get_name()+" placed "+t+" "+civitas.utils.get_resource_name(e)+" on the Black Market and will receive "+s+" coins next month.",civitas.l("Black Market")),{seller:this.get_name(),amount:t,goods:civitas.utils.get_resource_name(e),price:s,discount:i}}return!1},civitas.objects.settlement.prototype.sell_to_settlement=function(e,t,i){if(!civitas.utils.resource_exists(t))return this.get_core().error("The resource you specified does not exist."),!1;if(this.can_trade()){var s;this.get_resources();if("string"==typeof e||"number"==typeof e){if(s=this.get_core().get_settlement(e),e===!1)return this.get_core().error(e+" does not exist."),!1}else s=e;var a=this.get_religion().id===s.get_religion().id,r=s.get_trades();if(null===r)return this.get_core().error(e+" does not trade any goods."),!1;if(void 0===r.imports)return this.get_core().error(e+" does not import any goods."),!1;for(var n in r.imports)if(n===t){void 0===i&&(i=r.imports[n]);var o=Math.ceil(civitas.RESOURCES[n].price*civitas.TRADES_DISCOUNT/100),c=civitas.utils.calc_price_minus_discount(i,n,o),l=civitas.utils.calc_price(i,n),d=Math.ceil(civitas.RESOURCES[n].price-o);return!!this.remove_resource(n,i)&&(this.inc_coins(c),s.dec_coins(l)?(this.remove_from_imports(s,n,i),this.raise_influence(s.get_id(),a?2*civitas.EXPORT_INFLUENCE:civitas.EXPORT_INFLUENCE),this.raise_prestige(a?2*civitas.EXPORT_PRESTIGE:civitas.EXPORT_PRESTIGE),this.raise_fame(50),this.get_core().refresh(),this.get_core().notify(this.get_name()+" sold <strong>"+i+"</strong> "+civitas.utils.get_resource_name(n)+" to "+e+" for <strong>"+d+"</strong> coins each, for a total of <strong>"+c+"</strong> coins.",civitas.l("World Market")),{seller:this.get_name(),amount:i,goods:civitas.utils.get_resource_name(n),buyer:e,price:Math.round(civitas.RESOURCES[n].price-o),totalPrice:c}):(this.get_core().error(e+" does not have enough coins."),!1))}this.get_core().error(e+" does not import the specified goods.")}return!1},civitas.objects.settlement.prototype.remove_from_exports=function(e,t,i){return e.trades.exports[t]=e.trades.exports[t]-i,!0},civitas.objects.settlement.prototype.remove_from_imports=function(e,t,i){return e.trades.imports[t]=e.trades.imports[t]-i,!0},civitas.objects.settlement.prototype.get_trades=function(){return this.trades},civitas.objects.settlement.prototype.set_trades=function(e){return this.trades=e,this},civitas.objects.event=function(e){return this.core=null,this.name=null,this.handle=null,this.chance=0,this.effect=null,this.description=null,this.data=null,this.__init=function(e){return this.core=e.core,this.name=e.name,this.handle=e.handle,this.chance=void 0!==e.chance?e.chance:.001,this.description=e.description,this.data=e.data,this.effect=e.effect,this.process(),this},this.process=function(){return Math.random().toFixed(4)<=this.chance&&(this._process(),!0)},this.notify=function(){return this.core._notify({title:"Event occured: "+this.name,content:this.description.replace(/SETTLEMENT/g,this.data.settlement).replace(/AMOUNT/g,this.data.amount),timeout:!1,other:!0}),this},this._process=function(){this.notify();var e=this.core.get_settlement(this.data.settlement);switch(this.effect){case civitas.EVENT_EFFECT_LOSE_COINS:this.core.get_settlement().dec_coins(this.data.amount);break;case civitas.EVENT_EFFECT_GAIN_COINS:this.core.get_settlement().inc_coins(this.data.amount);break;case civitas.EVENT_EFFECT_RAISE_INFLUENCE:this.core.get_settlement().raise_influence(e.get_id(),this.data.amount,"city");break;case civitas.EVENT_EFFECT_LOWER_INFLUENCE:this.core.get_settlement().lower_influence(e.get_id(),this.data.amount,"city");break;case civitas.EVENT_EFFECT_GAIN_FAME:this.core.get_settlement().raise_fame(this.data.amount);break;case civitas.EVENT_EFFECT_LOSE_FAME:this.core.get_settlement().lower_fame(this.data.amount);break;case civitas.EVENT_EFFECT_GAIN_ESPIONAGE:this.core.get_settlement().raise_espionage(this.data.amount);break;case civitas.EVENT_EFFECT_LOSE_ESPIONAGE:this.core.get_settlement().lower_espionage(this.data.amount);break;case civitas.EVENT_EFFECT_DESTROY_BUILDING:}return this},this.__init(e)},civitas.objects.building=function(e){return this.level=1,this.settlement=null,this.name=null,this.type=null,this.working=!0,this.is_production=!1,this.is_municipal=!1,this.is_housing=!1,this.handle=null,this.problems=!1,this.__init=function(e){var t=this;this.settlement=e.settlement,this.type=e.type,this.name=e.data.name,this.is_production=void 0!==e.data.is_production&&e.data.is_production===!0,this.is_municipal=void 0!==e.data.is_municipal&&e.data.is_municipal===!0,this.is_housing=void 0!==e.data.is_housing&&e.data.is_housing===!0,this.level=void 0!==e.data.level?e.data.level:1,this.working=void 0===e.working||e.working,this.handle=e.data.handle,e.data.level=this.get_level(),e.hidden!==!0&&$("section.game").append(civitas.ui.building_element(e)).on("click","#building-"+this.get_handle(),function(){var i=civitas["PANEL_"+t.get_handle().toUpperCase()];return void 0!==i?t.get_core().open_panel(i,e.data):t.get_core().open_panel(civitas.PANEL_BUILDING,e.data),!1});var i=this.get_building_data();switch(this.get_type()){case"marketplace":case"warehouse":this.get_settlement().storage=this.get_settlement().storage+i.storage*this.get_level()}return e.hidden!==!0&&(this.working===!1?(this.problems=!0,this.notify(civitas.NOTIFICATION_PRODUCTION_PAUSED)):(this.problems=!1,$("#building-"+this.get_handle()).empty()),this.get_core().refresh()),this},this.is_upgradable=function(){var e=this.get_building_data();return this.get_level()<e.levels},this.upgrade=function(){var e=this,t=this.get_settlement(),i=(t.get_resources(),this.get_level()+1),s=civitas.BUILDINGS.findIndexM(this.get_type());if(s!==!1){var a=civitas.BUILDINGS[s];if(this.is_upgradable()===!0){var r=t.buildings_list.findIndexM(this.get_type());if(r!==!1){for(var n in a.cost)if(t.get_resources()[n]-a.cost[n]*i<0)return this.get_core().error("You don`t have enough "+n+" to upgrade this building."),!1;for(var n in a.cost)t.get_resources()[n]-a.cost[n]*i>=0&&(t.get_resources()[n]=t.get_resources()[n]-a.cost[n]*i);++this.level;var o=e.get_type();"house"===e.get_type().slice(0,-1)&&(o=e.get_type().slice(0,-1));var c=void 0===a.visible_upgrades||a.visible_upgrades===!1?o+"1":o+e.get_level();return $("section.game .building[data-type="+this.get_type()+"]").css({"background-image":"url(./images/buildings/"+c+".png)"}),void 0!==a.storage&&(this.get_settlement().storage=this.get_settlement().storage+a.storage),this.get_settlement().buildings_list[r].level=this.get_level(),this.get_core().save_and_refresh(),this.get_core().notify(this.get_name()+" upgraded to level "+this.get_level()),!0}}}return!1},this.downgrade=function(){if(this.get_level()>1){var e=this.get_settlement().buildings_list.findIndexM(this.get_type());if(e!==!1)return--this.level,this.get_settlement().buildings_list[e].level=this.get_level(),this.get_core().save_and_refresh(),this.get_core().notify(this.get_name()+" downgraded to level "+this.get_level()),!0}return!1},this.is_housing_building=function(){return this.is_housing},this.is_municipal_building=function(){return this.is_municipal},this.is_production_building=function(){return this.is_production},this.is_producing=function(){return this.working},this.start_production=function(){var e=this.get_settlement().buildings_list.findIndexM(this.get_type());return!(e===!1||!this.is_production_building())&&(this.get_core().notify(this.get_name()+"`s production started."),this.get_settlement().buildings_list[e].working=!0,this.working=!0,this.problems=!1,this.get_core().save_and_refresh(),$("#building-"+this.get_handle()).empty(),!0)},this.stop_production=function(){var e=this.get_settlement().buildings_list.findIndexM(this.get_type());return!(e===!1||!this.is_production_building())&&(this.get_core().notify(this.get_name()+"`s production stopped."),this.get_settlement().buildings_list[e].working=!1,this.working=!1,this.problems=!0,this.get_core().save_and_refresh(),this.notify(civitas.NOTIFICATION_PRODUCTION_PAUSED),!0)},this.demolish=function(){return this.get_settlement().demolish(this.get_type())?($("section.game .building[data-type="+this.get_type()+"]").remove(),this.get_core().notify(this.get_name()+" demolished successfully!"),!0):(this.get_core().error("Unable to demolish the specified building `"+this.get_name()+"`!"),!1)},this.has_materials=function(e){var t=this.get_building_data(),i=this.get_settlement_resources(),s=t.materials;if("object"==typeof e){for(var a=0;a<e.length;a++)if("coins"!==e[a]&&i[e[a]]-s[e[a]]<0)return this.get_core().log(this.get_name()+" doesn`t have enough "+e[a]+".",!0),this.notify(civitas.NOTIFICATION_MISSING_RESOURCES),this.problems=!0,!1}else if(i[e]-s[e]<0)return this.get_core().log(this.get_name()+" doesn`t have enough "+e+".",!0),this.notify(civitas.NOTIFICATION_MISSING_RESOURCES),this.problems=!0,!1;return!0},this.use_material=function(e){var t=this.get_building_data(),i=t.materials;if("object"==typeof e)for(var s=0;s<e.length;s++)this.get_settlement().remove_resource(e[s],i[e[s]]),this.get_core().log(this.get_name()+" used "+i[e[s]]+" "+e[s]+".");else this.get_settlement().remove_resource(e,i[e]),this.get_core().log(this.get_name()+" used "+i[e]+" "+e+".");return this},this.get_building_data=function(){return civitas.BUILDINGS[civitas.BUILDINGS.findIndexM(this.type)]},this.get_data=function(){return this.data},this.get_settlement_resources=function(){return this.get_settlement().get_resources()},this.produce_material=function(e){var t=this.get_settlement(),i=(t.get_resources(),this.get_building_data()),s=i.production;if("object"==typeof e)for(var a=0;a<e.length;a++){if(!this.is_producing())return this;var r=s[e[a]]*this.get_level();if(this.get_settlement().has_storage_space_for(r)){if(this.get_settlement().add_to_storage(e[a],r),void 0!==i.chance)for(var n in i.chance){var o=Math.random();o<i.chance[n]*this.get_level()&&(this.get_core().log(this.get_name()+" procced extra "+civitas.utils.get_resource_name(n)+"."),this.get_settlement().add_to_storage(n,1))}this.get_core().log(this.get_name()+" produced "+r+" "+e[a]+".")}}else{var r=s[e]*this.get_level();if(this.get_settlement().has_storage_space_for(r)){if(!this.is_producing())return this;if(this.get_settlement().add_to_storage(e,r),void 0!==i.chance)for(var n in i.chance){var o=Math.random();o<i.chance[n]&&(this.get_core().log(this.get_name()+" procced extra "+civitas.utils.get_resource_name(n)+"."),this.get_settlement().add_to_storage(n,1))}this.get_core().log(this.get_name()+" produced "+r+" "+e+".")}}return this},this.process_mats=function(e,t){return void 0!==t?this.has_materials(t)&&(this.use_material(t),this.produce_material(e)):this.produce_material(e),this},this.adjust_settlement_prestige=function(){var e=this.get_building_data(),t=e.production,i=t.prestige;return this.get_settlement().raise_prestige(i*this.get_level()),this.get_core().log(this.get_name()+" raised settlement prestige by "+i+"."),this.get_settlement().get_prestige()},this.adjust_settlement_faith=function(){var e=this.get_building_data(),t=e.production,i=t.faith;return this.get_settlement().raise_faith(i*this.get_level()),this.get_core().log(this.get_name()+" raised settlement faith by "+i+"."),this.get_settlement().get_faith()},this.adjust_settlement_espionage=function(){var e=this.get_building_data(),t=e.production,i=t.espionage;return this.get_settlement().raise_espionage(i*this.get_level()),this.get_core().log(this.get_name()+" raised settlement espionage by "+i+"."),this.get_settlement().get_espionage()},this.adjust_settlement_fame=function(){var e=this.get_building_data(),t=e.production,i=t.fame*this.get_level();return this.get_settlement().raise_fame(i*this.get_level()),this.get_core().log(this.get_name()+" raised settlement fame by "+i+"."),this.get_settlement().get_fame()},this.adjust_settlement_research_for_coins=function(){var e=this.get_building_data(),t=e.materials,i=e.production;if(this.get_settlement().has_coins(t.coins)){var s=i.research*this.get_level();this.get_settlement().raise_research(s*this.get_level()),this.get_settlement().dec_coins(t.coins),this.get_core().log(this.get_name()+" raised settlement research with "+s+" at the cost of "+t.coins+" coins.")}return{research:this.get_settlement().get_research(),coins:this.get_settlement().get_coins()}},this.adjust_settlement_fame_for_coins=function(){var e=this.get_building_data(),t=e.materials,i=e.production;if(this.get_settlement().has_coins(t.coins)){var s=i.fame*this.get_level();this.get_settlement().raise_fame(s*this.get_level()),this.get_settlement().dec_coins(t.coins),this.get_core().log(this.get_name()+" raised settlement fame with "+s+" at the cost of "+t.coins+" coins.")}return{fame:this.get_settlement().get_fame(),coins:this.get_settlement().get_coins()}},this.process_tax=function(){var e=[],t=this.get_building_data(),i=t.materials;for(var s in i)e.push(s);if(e.length>0&&this.has_materials(e)){this.use_material(e);var a=t.tax*this.get_level();this.get_settlement().inc_coins(a),this.get_core().log(this.get_name()+" gave "+a+" coins via tax.")}return this},this.has_requirements=function(){var e=!0,t=this.get_building_data();if(void 0!==t.requires.buildings)for(var i=t.requires.buildings,s=0;s<i.length;s++)if(!this.get_settlement().is_building_built(i[s])){e=!1;var a=civitas.BUILDINGS[civitas.BUILDINGS.findIndexM(i[s])];this.get_core().log(this.get_name()+" doesn`t have the required buildings: "+a.name+".",!0),this.notify(civitas.NOTIFICATION_MISSING_RESOURCES),this.problems=!0}return void 0!==t.requires.settlement_level&&t.requires.settlement_level>this.get_settlement().get_level()&&(this.get_core().log("Your settlement level is too low for "+this.get_name()+" to be active.",!0),this.notify(civitas.NOTIFICATION_SETTLEMENT_LOW_LEVEL),e=!1,this.problems=!0),e},this._process=function(){var e=[],t=[],i=this.get_building_data(),s=i.materials;for(var a in s)t.push(a);if(i.is_housing===!0){if(t.length>0&&this.has_materials(t)){this.use_material(t);var r=i.tax*this.get_level();this.get_settlement().inc_coins(r),this.get_core().log(this.get_name()+" gave "+r+" coins via tax.")}}else if(this.is_producing()){var n=i.production;for(var a in n)e.push(a);this.has_requirements()===!0?t.length>0?this.has_materials(t)&&(this.use_material(t),this.produce_material(e),this.problems=!1):(this.produce_material(e),this.problems=!1):this.problems=!0}else this.get_core().log(this.get_name()+" production is stopped."),this.notify(civitas.NOTIFICATION_PRODUCTION_PAUSED),this.problems=!0;return this},this.is_marketplace=function(){return"marketplace"===this.get_type()},this.process=function(){var e=this.get_building_data();this.get_settlement_resources(),e.production,e.materials;if(this.has_requirements()===!1)return!1;switch(this.get_type()){case"marketplace":this.adjust_settlement_fame();break;case"warehouse":case"camp":break;case"castle":this.adjust_settlement_fame_for_coins(),this.adjust_settlement_prestige();break;case"embassy":this.adjust_settlement_fame_for_coins(),this.adjust_settlement_espionage();break;case"church":case"monastery":this.adjust_settlement_fame_for_coins(),this.adjust_settlement_faith();break;case"academy":this.adjust_settlement_research_for_coins();break;case"tavern":this.adjust_settlement_fame_for_coins();break;default:this._process()}return this},this.get_settlement=function(){return this.settlement},this.get_core=function(){return this.get_settlement().get_core()},this.get_name=function(){return this.name},this.has_problems=function(){return this.problems},this.get_level=function(){return this.level},this.get_type=function(){return this.type},this.get_handle=function(){return this.handle},this.notify=function(e){var t=$("#building-"+this.get_handle());switch(e){case civitas.NOTIFICATION_PRODUCTION_PAUSED:t.empty().append('<span class="notification paused"></span>');break;case civitas.NOTIFICATION_MISSING_RESOURCES:default:t.empty().append('<span class="notification error"></span>')}return this},this.__init(e)},civitas.objects.soldier=function(e){return this.settlement=null,this.attack=0,this.defense=0,this.cost=null,this.name=null,this.__destroy=function(){return!1},this.destroy=function(){return this.__destroy()},this.__init=function(e){return this.settlement=e.settlement,this.name=e.name,this.attack=e.data.attack,this.defense=e.data.defense,this.cost=e.data.cost,this},this.get_attack=function(){return this.attack},this.get_defense=function(){return this.defense},this.get_cost=function(){return this.cost},this.get_settlement=function(){return this.settlement},this.get_name=function(){return this.name},this.get_core=function(){return this.get_settlement().get_core()},this.__init(e)},civitas.objects.ship=function(e){return this.settlement=null,this.attack=0,this.defense=0,this.cost=null,this.name=null,this.__destroy=function(){return!1},this.destroy=function(){return this.__destroy()},this.__init=function(e){return this.settlement=e.settlement,this.name=e.name,this.attack=e.data.attack,this.defense=e.data.defense,this.cost=e.data.cost,this},this.get_attack=function(){return this.attack},this.get_defense=function(){return this.defense},this.get_cost=function(){return this.cost},this.get_settlement=function(){return this.settlement},this.get_name=function(){return this.name},this.get_core=function(){return this.get_settlement().get_core()},this.__init(e)},civitas.controls.window=function(e){return this.handle=null,this.core=null,this.id=null,this.title=null,this.on_show=null,this.on_hide=null,this.__destroy=function(){return this.get_core().console_log("destroying window with id `"+this.id+"`"),$(this.handle).remove(),$(".tipsy").remove(),this.on_hide.call(this),!1},this.destroy=function(){return this.__destroy()},this.__init=function(e){return this.core=e.core,this.id=e.id,this.handle="#window-"+this.id,e.on_show instanceof Function?this.on_show=e.on_show:this.on_show=function(){},e.on_hide instanceof Function?this.on_hide=e.on_hide:this.on_hide=function(){},civitas.ui.window_exists(this.handle)&&this.destroy(),this.get_core().console_log("creating window with id `"+this.id+"`"),$("body").append(e.template),this.on_show.call(this),$(this.handle+" .tips").tipsy({gravity:"s"}),this},this.get_core=function(){return this.core},this.__init(e)},civitas.controls.panel=function(e){return this.handle=null,this.core=null,this.id=null,this.title=null,this.on_show=null,this.on_hide=null,this.on_refresh=null,this.__destroy=function(){this.get_core().console_log("destroying panel with id `"+this.id+"`"),$(this.handle).remove();for(var e=this.get_core().get_panels(),t=0;t<e.length;t++)e[t].id===this.id&&e.splice(t,1);return $(".tipsy").remove(),this.on_hide.call(this),!1},this.destroy=function(){return this.__destroy()},this.__init=function(e){var t=this;return this.core=e.core,this.id=e.id,this.handle="#panel-"+this.id,e.on_show instanceof Function?this.on_show=e.on_show:this.on_show=function(){},e.on_hide instanceof Function?this.on_hide=e.on_hide:this.on_hide=function(){},e.on_refresh instanceof Function?this.on_refresh=e.on_refresh:this.on_refresh=function(){},civitas.ui.panel_exists(this.handle)&&this.destroy(),this.get_core().console_log("creating panel with id `"+this.id+"`"),e.on_template instanceof Function?$(".ui").append(e.on_template.call(this,e)):$(".ui").append(e.template),this.on_show.call(this,e),$(this.handle).on("click",".close",function(){return t.destroy(),!1}).draggable({handle:"header",containment:"window",snap:".panel",start:function(){$(this).css({height:"auto"})},stop:function(){$(this).css({height:"auto"})}}),$(this.handle+" .tabs").tabs(),$(this.handle).css({left:$(window).width()/2-$(this.handle).width()/2,top:$(window).height()/2-$(this.handle).height()/2}),$(".tipsy").remove(),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0}),this},this.get_core=function(){return this.core},this.__init(e)},civitas.game=function(){return this.settlements=[],this.campaigns=[],this.achievements=[],this.music=null,this.day=1,this.year=1,this.month=1,this.day_of_month=1,this.black_market={},this.settings={console:!1,music:!1},this.paused=!1,this.difficulty=civitas.DIFFICULTY_EASY,this.panels=[],this.worldmap=1,this.mode=civitas.MODE_SINGLEPLAYER,this.__init=function(){return this._build_ui(),this._setup_audio(),this._setup_ui(),this.get_storage_data()===!1?this.open_window(civitas.WINDOW_OPTIONS):this.start_game(),this},this.get_panel=function(e){for(var t=this.get_panels(),i=0;i<t.length;i++)if(t[i].id===e)return t[i];return!1},this.close_panel=function(e){for(var t=this.get_panels(),i=0;i<t.length;i++)t[i].id===e&&t.splice(i,1);return this},this.add_black_market=function(e,t,i){if(void 0!==this.black_market[e]){var s=this.black_market[e];this.black_market[e]={resource:e,amount:s.amount+t,price:s.price+i}}else this.black_market[e]={resource:e,amount:t,price:i};return this.black_market},this.swap_storage_data=function(e,t){var i=this.get_storage_data(e);return i!==!1&&(this.set_storage_data(t,i),!0)},this.reset_storage_data=function(e){return void 0===e&&(e="live"),localStorage.removeItem(civitas.STORAGE_KEY+"."+e),this},this.set_storage_data=function(e,t){return localStorage.setItem(civitas.STORAGE_KEY+"."+e,window.btoa(JSON.stringify(t))),this},this.get_storage_data=function(e){return void 0===e&&(e="live"),null!==localStorage.getItem(civitas.STORAGE_KEY+"."+e)&&JSON.parse(window.atob(localStorage.getItem(civitas.STORAGE_KEY+"."+e)))},this.set_settings=function(e,t){return void 0===t?this.settings=e:this.settings[e]=t,this},this.set_settings_music=function(e){return e===!0?this.music.play():this.music.pause(),this.set_settings("music",e),this},this.set_settings_console=function(e){return e===!0?$("aside.console").show():$("aside.console").hide(),this.set_settings("console",e),this},this.get_settings=function(e){return void 0===e?this.settings:this.settings[e]},this._reset_black_market=function(){var e=0;for(var t in this.black_market)this.get_settlement().inc_coins(this.black_market[t].price),e+=this.black_market[t].price;return this.black_market={},this.refresh(),$("#tab-blackmarket > .contents > table > tbody").empty(),e>0&&this.notify(this.get_settlement().get_name()+" "+civitas.l("received")+" "+e+" "+civitas.l("coins from the Black Market for selling goods."),civitas.l("Black Market")),this},this.get_black_market=function(){return this.black_market},this.set_black_market=function(e){return this.black_market=void 0!==e?e:{},this},this._build_ui=function(){var e='<section class="ui"><header><div class="cityavatar"></div><div class="cityclock"><div class="container"><div class="hand"></div></div></div><span title="City level" class="tips citylevel"></span><span title="City prestige" class="tips cityprestige"></span><div title="City name" class="tips cityname"></div><div title="City fame" class="tips cityfame"><span></span></div><div class="top-panel"></div></header><aside class="console"><div class="scrollbar"><div class="up"></div><div class="down"></div></div><div class="contents"></div></aside><section class="game"></section><footer><div class="toolbar"><div class="tips do-build" title="'+civitas.l("Buildings")+'"></div><div class="tips do-storage" title="'+civitas.l("Storage Space")+'"></div><div class="tips do-trades" title="'+civitas.l("Trades")+'"></div><div class="tips do-council" title="'+civitas.l("City Council")+'"></div><div class="tips do-ranks" title="'+civitas.l("Ranks")+'"></div><div class="tips do-worldmap" title="'+civitas.l("World Map")+'"></div><div class="" title=""></div><div class="" title=""></div><div class="tips do-help" title="'+civitas.l("Help")+'"></div></div></footer></section><audio id="music" loop><source src="music/track1.mp3" type="audio/mpeg"></audio><div title="'+civitas.l("Game is doing stuff in the background.")+'" class="loading"></div>';return $("body").empty().append(e),this},this.start_game=function(e,t,i,s,a,r){$(".ui header .cityclock .container").css({animation:"rotate "+civitas.SECONDS_TO_DAY+"s infinite steps(10)"});var n=this,o=null;this.difficulty=parseInt(r),this.worldmap=civitas.utils.get_random(1,civitas.WORLDMAPS),this.get_storage_data()!==!1?o=this._load_settlement(this.import()):this._create_settlement(e,t,i,s,a),this._setup_neighbours(o),this._setup_villages(o),this.save(),$("header .cityname").html(this.get_settlement().get_name()),$("header .cityavatar").css({"background-image":"url("+civitas.ASSETS_URL+"images/avatars/avatar"+this.get_settlement().get_ruler_avatar()+".png)"}),this.refresh();var c=1;return setInterval(function(){n.is_paused()||c!==civitas.SECONDS_TO_DAY?n.is_paused()||c++:(n._do_daily(),c=1)},1e3),$(document).keyup(function(e){27!=e.keyCode||civitas.ui.window_exists("#window-options")||(n.show_loader(),n.open_window(civitas.WINDOW_OPTIONS))}),this.hide_loader(),this},this.pause=function(){return this.paused=!0,$(".ui header .cityclock .container").css({animation:"none"}),this},this.unpause=function(){return this.paused=!1,$(".ui header .cityclock .container").css({animation:"rotate "+civitas.SECONDS_TO_DAY+"s infinite steps(10)"}),this},this.is_paused=function(){return this.paused},this.show_loader=function(){return $(".loading").show().tipsy({gravity:"e"}),this},this.hide_loader=function(){return $(".loading").hide(),this},this.set_date_time=function(e){return this.day=e.day,this.month=e.month,this.year=e.year,this.day_of_month=e.day_of_month,this},this._setup_audio=function(){return this.music=$("#music").get(0),this.music.volume=.2,civitas.AUTOSTART_MUSIC===!0&&this.music.play(),this},this.get_settlement=function(e){if(void 0!==e&&"string"==typeof e)for(var t=this.get_settlements(),i=0;i<t.length;i++){var s=t[i];if(s.get_name()===e)return s}else{if(void 0===e||"number"!=typeof e)return this.settlements[0];for(var t=this.get_settlements(),i=0;i<t.length;i++){var s=t[i];if(s.get_id()===e)return s}}return!1},this._load_settlement=function(e){var t=e.settlements[0];if(t){t.core=this;var i=new civitas.objects.settlement(t);return this.settlements.push(i),i._create_buildings(t.buildings),e}return!1},this._create_settlement=function(e,t,i,s,a){var r=this.get_difficulty(),n=new civitas.objects.settlement({name:t,climate:s,avatar:a,id:99,player:!0,ruler:{name:e,title:"",avatar:a,nationality:i,personality:civitas.PERSONALITY_BALANCED},army_list:civitas.START_ARMY[r-1].army,navy_list:civitas.START_ARMY[r-1].navy,core:this});return this.settlements.push(n),this.get_settlement()._create_buildings(civitas.START_BUILDINGS),this},this.get_building_config_data=function(e){return"string"==typeof e?civitas.BUILDINGS[civitas.BUILDINGS.findIndexM(e)]:"number"==typeof e&&civitas.BUILDINGS[e]},this._check_for_events=function(){var e=civitas.EVENTS[civitas.utils.get_random(0,civitas.EVENTS.length-1)];return e.core=this,new civitas.objects.event(e),this},this.process_all_buildings=function(){for(var e=this.get_settlement().get_buildings(),t=0;t<e.length;t++)void 0!==e[t]&&e[t].process();return this},this._do_daily=function(){return this.day++,this.log("day "+this.day_of_month+" month "+this.month+" year "+this.year),this.process_all_buildings(),this._check_for_events(),this.calc_storage(),this.advance_campaigns(),this.day_of_month++,this.day_of_month>30&&this._do_monthly(),this.day>=361&&(this._do_yearly(),this.day=1,this.month=1),this.check_achievements(),
this.save(),this.refresh(),this},this._do_monthly=function(){return this.day_of_month=1,this.month++,3!==this.month&&6!==this.month&&9!==this.month&&12!==this.month||this._do_quarterly(),this._reset_black_market(),this},this._do_quarterly=function(){return this.refresh_trades(),this},this.save_and_refresh=function(){return this.save(),this.refresh(),this},this.refresh=function(){return this.refresh_panels(),this.refresh_toolbar(),this.refresh_ui(),$(".tipsy").remove(),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0}),$(".top-panel > span").tipsy({gravity:"n"}),this},this.refresh_toolbar=function(){var e=this.get_settlement();if(void 0!==e)for(var t=e.get_resources(),i=0;i<civitas.TOOLBAR_RESOURCES.length;i++){var s=civitas.TOOLBAR_RESOURCES[i],a=$(".top-panel ."+s);void 0!==t[s]&&a.attr("title",t[s]+" "+civitas.utils.get_resource_name(s))}return this},this.refresh_ui=function(){var e=this.get_settlement();if(void 0!==e){var t=(e.get_storage_space(),civitas.LEVELS[e.get_level()]);$(".citylevel").html(e.get_level()),$(".cityprestige").html(e.get_prestige()),e.get_fame()>=t&&(e.level_up(),t=civitas.LEVELS[e.get_level()]),$("header .cityfame > span").css({width:Math.floor(100*e.get_fame()/t)+"%"})}return this},this.refresh_panels=function(){for(var e=this.get_panels(),t=0;t<e.length;t++)e[t].on_refresh();return this},this.save=function(){return this.export(!0),this},this.help=function(e,t){return this.open_panel(civitas.PANEL_HELP,{context:e,term:t}),this},this.refresh_trades=function(){for(var e=this.get_settlements(),t=1;t<e.length;t++)void 0!==e[t]&&e[t].is_city()&&e[t].reset_trades();return this.notify("World Market trades have been refreshed, settlements are looking to make new purchases and sales.",civitas.l("World Market")),this},this.refresh_influence=function(){for(var e=this.get_settlements(),t=1;t<e.length;t++)void 0!==e[t]&&(e[t].is_city()?this.get_settlement().get_religion().id===e[t].get_religion().id?this.get_settlement().raise_influence(e[t].get_id(),civitas.YEARLY_INFLUENCE_GAIN):this.get_settlement().lower_influence(e[t].get_id(),civitas.YEARLY_INFLUENCE_LOSS):this.get_settlement().get_religion().id===e[t].get_religion().id&&this.get_settlement().raise_influence(e[t].get_id(),civitas.YEARLY_INFLUENCE_GAIN));return this},this._do_yearly=function(){return this.get_settlement().release_mercenaries(),this.refresh_influence(),this.year++,this},this.log=function(e,t){return void 0!==e?$(".ui .console .contents").prepend("<div"+(void 0!==t&&t===!0?' class="error"':"")+"><span>"+civitas.utils.get_now()+"</span> - "+e+"</div>"):$(".ui .console .contents").prepend('<div class="separator"></div>'),this},this.console_log=function(e,t){return civitas.DEBUG===!0&&console.log((typeof t===!0?"APP error: ":"APP message: ")+e),this},this.get_date=function(){return"day "+this.day_of_month+" month "+this.month+" year "+this.year},this.notify=function(e,t,i){return this._notify({title:void 0!==t?t:civitas.l("City Council"),content:e,timeout:void 0!==i?i:15e3}),this.log(e),this},this._notify=function(e){var t,i,s,a,r,n,o,c;e=$.extend({title:void 0,content:void 0,timeout:15e3,img:civitas.ASSETS_URL+"images/ui/icon_notification_1.png",showTime:!0,error:!1,achievement:!1,other:!1},e),c=e.achievement===!1?"notifications":"achievements-notifications",t=$("."+c),t.length||(t=$("<div>",{class:c}).appendTo(document.body)),$(".achievements-notifications").css({left:$(window).width()/2-t.width()/2}),i=$("<div>"),i.addClass("notty"),s=$("<div>",{click:function(){$(this).parent().delay(300).queue(function(){$(this).clearQueue(),$(this).remove()})},touchstart:function(){$(this).parent().delay(300).queue(function(){$(this).clearQueue(),$(this).remove()})}}),s.addClass("hide"),e.error===!0&&(i.addClass("error"),e.img=civitas.ASSETS_URL+"images/ui/icon_notification_2.png"),e.other===!0&&(i.addClass("other"),e.img=civitas.ASSETS_URL+"images/ui/icon_notification_1.png"),e.achievement===!0&&(i.addClass("achievement"),e.img=civitas.ASSETS_URL+"images/ui/icon_achievement.png"),a=$("<div>",{style:"background: url('"+e.img+"')"}),a.addClass("img"),n=$("<div class='left'>"),r=$("<div class='right'>");var l="<h2>"+e.title+"</h2>",d=e.content;if(o=$("<div>",{html:l+d}),o.addClass("inner"),o.appendTo(r),a.appendTo(n),n.appendTo(i),r.appendTo(i),s.appendTo(i),e.achievement===!1){var h=Number(new Date),u=$("<div>",{html:"<strong>"+civitas.utils.time_since(h)+"</strong> ago"});u.addClass("time").attr("title",h),u.appendTo(r),setInterval(function(){$(".time").each(function(){var e=$(this).attr("title");$(this).html("<strong>"+civitas.utils.time_since(e)+"</strong> ago")})},4e3)}return i.hover(function(){s.show()},function(){s.hide()}),i.prependTo(t),i.show(),e.timeout&&setTimeout(function(){i.delay(300).queue(function(){$(this).clearQueue(),$(this).remove()})},e.timeout),this},this.error=function(e,t,i){return this._notify({title:void 0!==t?t:civitas.l("City Council"),error:!0,content:e}),void 0!==i&&i!==!1||this.log(e,!0),this},this.calc_storage=function(){var e=this.get_settlement().get_storage_space();return e.occupied>=e.all?this.error("You ran out of storage space and all goods produced will be lost. Upgrade your warehouse or marketplace.","No storage space"):e.all-e.occupied<100&&this.error("You will soon run out of storage space and all goods produced will be lost. Upgrade your warehouse or marketplace.","Storage nearly full"),e},this.get_settlements=function(){return this.settlements},this.import=function(){var e=this.get_storage_data().data;return e===!1?(this.error("There was a problem loading the game data, it is probably corrupted"),!1):(this.set_difficulty(e.difficulty),this.set_worldmap(e.worldmap),this.set_campaigns(e.campaigns),this.set_achievements(e.achievements),this.set_date_time(e.date_time),this.set_black_market(e.black_market),this.set_settings_music(e.settings.music),this.set_settings_console(e.settings.console),e)},this.export=function(e,t){for(var i=(this.get_settlement(),[]),s=0;s<this.settlements.length;s++)i.push(this.settlements[s].export());var a={settlements:i,difficulty:this.get_difficulty(),achievements:this.get_achievements(),black_market:this.get_black_market(),date_time:{day:this.day,month:this.month,year:this.year,day_of_month:this.day_of_month},campaigns:this.get_campaigns(),worldmap:this.get_worldmap(),settings:this.get_settings()};if(e===!0){var r={date:Number(new Date),data:a};return void 0!==t?this.set_storage_data("save"+t,r):this.set_storage_data("live",r),r}return a},this._setup_villages=function(){},this._setup_neighbours=function(e){var t=null,i=null,s=null;if(null!==e)for(var a=1;a<e.settlements.length;a++){i=e.settlements[a],i.core=this,t=new civitas.objects.settlement(i);var r=t.get_climate(),n="SETTLEMENT_BUILDINGS_"+r.name.toUpperCase();t._create_buildings(civitas[n],!0),this.settlements.push(t)}else for(var o in civitas.SETTLEMENTS){if(o=parseInt(o),i=civitas.SETTLEMENTS[o],i.settlement_type=void 0===i.settlement_type||i.settlement_type===civitas.CITY?civitas.CITY:civitas.VILLAGE,s=i.settlement_type===civitas.VILLAGE?{title:"Mayor",avatar:40,personality:civitas.PERSONALITY_DIPLOMAT,name:civitas.utils.get_random_unique(civitas.NAMES),nationality:i.nationality}:civitas.utils.get_random_unique(civitas.RULERS),t=new civitas.objects.settlement({core:this,id:o,population:i.population,settlement_type:i.settlement_type,name:civitas.utils.get_random_unique(civitas.SETTLEMENT_NAMES),player:!1,level:i.level,religion:i.religion,climate:i.settlement_type===civitas.CITY?i.climate:civitas.CLIMATE_TEMPERATE,ruler:s,resources:i.resources,icon:i.settlement_type===civitas.CITY?i.icon:1,army_list:i.army,navy_list:i.navy}),i.settlement_type===civitas.CITY){var r=t.get_climate(),n="SETTLEMENT_BUILDINGS_"+r.name.toUpperCase();t._create_buildings(civitas[n],!0)}this.get_settlement().status[o]={influence:50,status:civitas.DIPLOMACY_TRUCE},this.settlements.push(t)}return this},this._get_neighbours_trades=function(){for(var e={},t=this.get_settlements(),i=1;i<t.length;i++)void 0!==t[i]&&(e[t[i].get_id()]=t[i].get_trades());return e},this._setup_ui=function(){var e,t,i=this,s=!1,a="";$(".game").on({mousemove:function(e){s&&r(e)},mousedown:function(i){s=!0,e=i.pageY,t=i.pageX,$("html").css("cursor","grab")},mouseup:function(){s=!1,$("html").css("cursor","auto")}}),$(".ui > footer").css({left:$(window).width()/2-$(".ui > footer").width()/2});for(var r=function(i){$(window).scrollTop($(window).scrollTop()+(e-i.pageY)),$(window).scrollLeft($(window).scrollLeft()+(t-i.pageX))},n=0;n<civitas.TOOLBAR_RESOURCES.length;n++)a+='<span class="'+civitas.TOOLBAR_RESOURCES[n]+'"></span>';return $(".top-panel").empty().append(a),$(".console").on("click",".down",function(){$(".console .contents").scrollTo("+=97px",500)}).on("click",".up",function(){$(".console .contents").scrollTo("-=97px",500)}),$(".toolbar").on("click",".do-worldmap",function(){return i.open_panel(civitas.PANEL_WORLD),!1}).on("click",".do-help",function(){return i.open_panel(civitas.PANEL_HELP),!1}).on("click",".do-trades",function(){return i.open_panel(civitas.PANEL_TRADES),!1}).on("click",".do-ranks",function(){return i.open_panel(civitas.PANEL_RANKS),!1}).on("click",".do-council",function(){return i.open_panel(civitas.PANEL_COUNCIL),!1}).on("click",".do-storage",function(){return i.open_panel(civitas.PANEL_STORAGE),!1}).on("click",".do-build",function(){return i.open_panel(civitas.PANEL_BUILDINGS),!1}),this},this.get_version=function(){return civitas.VERSION},this.get_panels=function(){return this.panels},this.set_difficulty=function(e){return this.difficulty=e,this},this.get_difficulty=function(){return this.difficulty},this.check_achievements=function(){for(var e,t,i=this.get_settlement(),s=0;s<civitas.ACHIEVEMENTS.length;s++){e=civitas.ACHIEVEMENTS[s];for(var a=0;a<civitas.ACHIEVEMENTS[s].conditions.length;a++){civitas.ACHIEVEMENTS[s].id;if(!this.has_achievement(e)){if(t=e.conditions[a],void 0!==t.settlement_level&&i.get_level()===t.settlement_level&&this.achievement(e),void 0!==t.soldiers){i.get_army_total().total>=t.soldiers&&this.achievement(e)}if(void 0!==t.ships){i.get_navy_total().total>=t.ships&&this.achievement(e)}if(void 0!==t.coins&&i.get_coins()>=t.coins&&this.achievement(e),void 0!==t.research&&i.get_research()>=t.research&&this.achievement(e),void 0!==t.faith&&i.get_faith()>=t.faith&&this.achievement(e),void 0!==t.population&&i.get_population()>=t.population&&this.achievement(e),void 0!==t.prestige&&i.get_prestige()>=t.prestige&&this.achievement(e),void 0!==t.espionage&&i.get_espionage()>=t.espionage&&this.achievement(e),void 0!==t.buildings)if("object"==typeof t.buildings){for(var r=!0,n=0;n<t.buildings.length;n++)if(!i.is_building_built(t.buildings[n])){r=!1;break}r===!0&&this.achievement(e)}else for(var n=0;n<i.buildings_list.length;n++)if(i.buildings_list[n].handle===t.buildings){this.achievement(e);break}if(void 0!==t.resources){for(var r=!0,n=0;n<t.resources.length;n++)for(var o in t.resources[n]){var c=i.resources[o];if(c<t.resources[n][o]){r=!1;break}}r===!0&&this.achievement(e)}if(void 0!==t.storage&&0===t.storage&&(i.has_storage_space()||this.achievement(e)),void 0!==t.achievements&&t.achievements===this.achievements.length&&this.achievement(e),void 0!==t.mercenary){i.get_mercenary().length>=t.mercenary&&this.achievement(e)}}}}return this},this.achievement=function(e){return this.achievements.push({id:e.id,date:+new Date}),this._notify({title:"Achievement Completed",other:!0,achievement:!0,content:e.description,timeout:!1}),this},this.has_achievement=function(e){for(var t=0;t<this.achievements.length;t++)if(this.achievements[t].id===e.id)return!0;return!1},this.get_achievement_by_id=function(e){for(var t=0;t<civitas.ACHIEVEMENTS.length;t++)if(civitas.ACHIEVEMENTS[t].id===e)return civitas.ACHIEVEMENTS[t];return!1},this.set_achievements=function(e){return this.achievements=e,this},this.get_achievements=function(){return this.achievements},this.open_panel=function(e,t){e.core=this,void 0!==t&&(e.data=t);var i=new civitas.controls.panel(e);return this.panels.push(i),i},this.open_window=function(e,t){return e.core=this,void 0!==t&&(e.data=t),new civitas.controls.window(e)},this.get_mode=function(){return this.mode},this.set_mode=function(e){this.mode=e},this.get_worldmap=function(){return this.worldmap},this.set_worldmap=function(e){return this.worldmap=e,this},this.set_campaigns=function(e){return this.campaigns=e,this},this.get_campaigns=function(){return this.campaigns},this.advance_campaigns=function(){for(var e=this.get_settlement(),t=null,i=0;i<this.campaigns.length;i++)this.campaigns[i].passed===this.campaigns[i].duration-1?(this.campaigns[i].source.id===e.get_id()?(t=this.get_settlement(this.campaigns[i].destination.id),this.notify("The "+(this.campaigns[i].type===civitas.CAMPAIGN_ARMY?"army":"caravan")+" you sent "+this.campaigns[i].duration+" days ago to "+t.get_name()+" reached its destination.")):this.campaigns[i].destination.id===e.get_id()&&(t=this.get_settlement(this.campaigns[i].source.id),this.notify("The "+(this.campaigns[i].type===civitas.CAMPAIGN_ARMY?"army":"caravan")+" sent by "+t.get_name()+" "+this.campaigns[i].duration+" days ago reached your city.")),this.process_campaign(i)):this.campaigns[i].passed++;return this},this.process_campaign=function(e){var t=this.campaigns[e];if(t.type===civitas.CAMPAIGN_ARMY&&!this.get_settlement().can_diplomacy())return!1;if(t.type===civitas.CAMPAIGN_CARAVAN&&!this.get_settlement().can_trade())return!1;switch(t.type){case civitas.CAMPAIGN_ARMY:break;case civitas.CAMPAIGN_CARAVAN:var i=0,s=this.get_settlement(t.destination.id);if(void 0!==t.data.resources){for(var a in t.data.resources)$.inArray(a,civitas.NON_RESOURCES)===-1?i+=civitas.utils.calc_price(t.data.resources[a],a):"coins"===a&&(i+=t.data.resources[a]),s.add_to_storage(a,t.data.resources[a]);this.get_settlement().raise_influence(t.destination.id,5)}}return this.remove_campaign(e),this},this.add_campaign=function(e,t,i,s){if(i===civitas.CAMPAIGN_ARMY&&!this.get_settlement().can_diplomacy())return!1;if(i===civitas.CAMPAIGN_CARAVAN&&!this.get_settlement().can_trade())return!1;var a=civitas["SETTLEMENT_LOCATION_"+e.get_climate().name.toUpperCase()],r=civitas.SETTLEMENTS[t.get_id()].location,n=civitas.utils.get_distance_in_days(a,r),o={source:{x:a.x,y:a.y,id:e.get_id()},destination:{x:r.x,y:r.y,id:t.get_id()},duration:n,passed:0,type:i,data:s};return this.campaigns.push(o),this.notify("Your "+(i===civitas.CAMPAIGN_ARMY?"army":"caravan")+" was dispatched towards "+t.get_name()+" and will reach its destination in "+n+" days."),o},this.remove_campaign=function(e){var t;return(t=this.get_panel("campaign"))&&t.destroy(),this.campaigns.splice(e,1),this},this.is_spring=function(){return this.month>=3&&this.month<6},this.is_summer=function(){return this.month>=6&&this.month<9},this.is_autumn=function(){return this.month>=9&&this.month<12},this.is_winter=function(){return this.month>=12||this.month<3},this.__init()},$(document).ready(function(){new civitas.game}),civitas.PANEL_SETTLEMENT={template:'<div id="panel-settlement" class="panel"><header><span class="title"></span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div><footer class="footer"><a class="tips attack btn" title="'+civitas.l("Attack this settlement")+'"></a><a class="tips caravan btn" title="'+civitas.l("Send a caravan to this settlement")+'"></a><a class="tips help btn" data-context="settlement" data-term="general" title="'+civitas.l("Info about this settlement")+'"></a></footer></div>',params_data:null,id:"settlement",on_show:function(e){var t=this,i=this.get_core(),s=i.get_settlement(),a=e.data,r=a.get_settlement_type();this.params_data=e;a.get_trades(),civitas["SETTLEMENT_LOCATION_"+s.get_climate().name.toUpperCase()];$(this.handle+" header .title").html((a.is_city()?"City of ":"Village of ")+a.get_name()),a.is_city()?$(this.handle+" .contents").append(civitas.ui.tabs([civitas.l("Info"),civitas.l("Army"),civitas.l("Navy"),civitas.l("Imports"),civitas.l("Exports")])):$(this.handle+" .contents").append(civitas.ui.tabs([civitas.l("Info"),civitas.l("Army"),civitas.l("Navy"),civitas.l("Resources")])),this.on_refresh(),$(this.handle).on("click",".caravan",function(){return s.can_trade()?(i.add_campaign(s,a,civitas.CAMPAIGN_CARAVAN,{resources:{coins:1e5,wood:10,stones:20,silk:10,weapons:100}}),t.destroy(),!1):(i.error(civitas.l("You will need to construct a Trading Post before being able to trade resources with other settlements.")),!1)}).on("click",".attack",function(){return s.can_diplomacy()?(s.diplomacy(a.get_id(),civitas.DIPLOMACY_WAR,civitas.SETTLEMENT_TYPES[r]),i.add_campaign(s,a,civitas.CAMPAIGN_ARMY,{army:{Militia:40,Axeman:30,Knight:10,Bowman:20,Crossbowman:10,Pikeman:30},navy:{Corsair:4,Caravel:2,Galleon:2,Warship:6,"Ship of the Line":1}}),t.destroy(),!1):(i.error(civitas.l("You will need to construct an Embassy before being able to propose treaties and pacts to other settlements.")),!1)})},on_refresh:function(){var e=this.get_core(),t=e.get_settlement(),i=this.params_data.data,s=(i.get_settlement_type(),i.get_trades()),a=civitas["SETTLEMENT_LOCATION_"+t.get_climate().name.toUpperCase()];if($(this.handle+" #tab-info").empty().append('<img class="avatar" src="'+civitas.ASSETS_URL+"images/avatars/avatar"+i.get_ruler_avatar()+'.png" /><dl><dt>'+i.get_ruler().title+"</dt><dd>"+i.get_ruler_name()+"</dd><dt>"+civitas.l("Climate")+"</dt><dd>"+i.get_climate().name.capitalize()+"</dd><dt>"+civitas.l("Personality")+"</dt><dd>"+i.get_personality().name.capitalize()+"</dd><dt>"+civitas.l("Nationality")+"</dt><dd>"+i.get_nationality().name.capitalize()+"</dd>"+(i.is_city()?"<dt>"+civitas.l("Level")+"</dt><dd>"+i.get_level()+"</dd><dt>"+civitas.l("Prestige")+"</dt><dd>"+civitas.ui.progress(100*i.get_prestige()/civitas.MAX_PRESTIGE_VALUE,"small",i.get_prestige())+"</dd>":"")+"<dt>"+civitas.l("Coins")+"</dt><dd>"+civitas.utils.nice_numbers(i.get_coins())+"</dd><dt>"+civitas.l("Population")+"</dt><dd>"+civitas.utils.nice_numbers(i.get_population())+"</dd><dt>"+civitas.l("Religion")+"</dt><dd>"+i.get_religion().name.capitalize()+"</dd><dt>"+civitas.l("Influence")+"</dt><dd>"+civitas.ui.progress(t.get_influence_with_settlement(i.get_id()),"small")+"</dd><dt>"+civitas.l("Diplomatic Status")+"</dt><dd>"+t.get_diplomacy_status(i.get_id()).name.capitalize()+"</dd><dt>"+civitas.l("Distance")+"</dt><dd>"+civitas.utils.get_distance(a,civitas.SETTLEMENTS[i.get_id()].location)+" miles ("+civitas.utils.get_distance_in_days(a,civitas.SETTLEMENTS[i.get_id()].location)+" days)</dd></dl>"),$(this.handle+" #tab-army").empty().append(civitas.ui.army_list(i.get_army_total())),$(this.handle+" #tab-navy").empty().append(civitas.ui.navy_list(i.get_navy_total())),i.is_city())$(this.handle+" #tab-imports").empty().append("<p>"+civitas.l("Below are the goods this city will be buying this year.")+"</p>"+civitas.ui.trades_list(s,"imports")),$(this.handle+" #tab-exports").empty().append("<p>"+civitas.l("Below are the goods this city will be selling this year.")+"</p>"+civitas.ui.trades_list(s,"exports"));else{var r="<p>This village has the the following resources:</p><dl>";for(var n in i.get_resources())$.inArray(n,civitas.NON_RESOURCES)===-1&&(r+="<dt>"+i.resources[n]+"</dt><dd>"+civitas.ui.resource_small_img(n)+"</dd>");r+="</dl>",$(this.handle+" #tab-resources").empty().append(r)}}},civitas.PANEL_HELP={template:'<div id="panel-help" class="panel"><header><span class="title"></span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents">'+(civitas.DEBUG===!0?'<div class="hr"></div><fieldset class="toolbar"><legend>Cheats</legend><a href="#" class="btn iblock one">10k coins</a> <a href="#" class="btn iblock two">100 wood</a> <a href="#" class="btn iblock three">100 stones</a> <a href="#" class="btn iblock four">100 wood planks</a> <a href="#" class="btn iblock five">level up</a> <a href="#" class="btn iblock six">1000 fame</a> <a href="#" class="btn iblock seven">refresh trades</a> </fieldset>':"")+"</div></div>",term:null,context:null,id:"help",on_show:function(e){var t=this.get_core(),i=t.get_settlement();void 0!==e.data&&(this.term=e.data.term,this.context=e.data.context);var s="";switch(this.context){case"building":s=t.get_settlement().get_building_by_handle(this.term).get_name();break;case"settlement":s="Settlements"}$(this.handle+" header .title").html(""!==s?civitas.l("Help about ")+s:civitas.l("Help")),civitas.DEBUG===!0&&$(this.handle).on("click",".one",function(){return i.inc_coins(1e4),t.save_and_refresh(),!1}).on("click",".two",function(){return i.add_to_storage("wood",100),t.save_and_refresh(),!1}).on("click",".three",function(){return i.add_to_storage("stones",100),t.save_and_refresh(),!1}).on("click",".four",function(){return i.add_to_storage("woodplanks",100),t.save_and_refresh(),!1}).on("click",".five",function(){return i.level_up(),t.save_and_refresh(),!1}).on("click",".six",function(){return i.raise_fame(1e3),t.save_and_refresh(),!1}).on("click",".seven",function(){return t.refresh_trades(),t.save_and_refresh(),!1})}},civitas.PANEL_BUILDING={template:'<div id="panel-building" class="panel pb"><header><span class="title"></span><a class="tips close btn" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div><footer class="footer"><a class="tips demolish btn" title="'+civitas.l("Demolish this building")+'"></a><a class="tips pause start btn" title="'+civitas.l("Control (start/pause) production")+'"></a><a class="tips upgrade btn" title="'+civitas.l("Upgrade building")+'"></a><a class="tips help btn" data-context="{context}" data-term="{building}" title="'+civitas.l("Info about this building")+'"></a></footer></div>',term:null,context:null,id:"building",on_template:function(e){return this.params_data=e.data,e.template.replace(/{building}/g,this.params_data.handle).replace(/{context}/g,"building")},on_show:function(e){var t=this,i=this.get_core(),s=this.handle,a=i.get_settlement().get_building_by_handle(this.params_data.handle);a.get_level();$(s+" header .title").html(this.params_data.name),this.on_refresh(),a.is_upgradable()?$(s).on("click",".upgrade",function(){return confirm(civitas.l("Are you sure you want to upgrade this building?"))===!0&&a.upgrade()&&(a.is_upgradable()||$(s+" .footer .upgrade").remove()),!1}):$(s+" .footer .upgrade").remove(),a.is_marketplace()?$(s+" .footer .demolish").remove():$(s).on("click",".demolish",function(){return confirm(civitas.l("Are you sure you want to demolish this building?"))===!0&&a.demolish()&&(t.destroy(),i.refresh()),!1}),a.is_production_building()?(a.is_producing()?$(s+" .pause").removeClass("start"):$(s+" .start").removeClass("pause"),$(s).on("click",".pause",function(){return a.stop_production(),$(this).removeClass("pause").addClass("start"),!1}).on("click",".start",function(){return $(this).removeClass("start").addClass("pause"),a.start_production(),!1})):$(s+" .start, "+s+" .pause").remove(),$(s).on("click",".help",function(){var e=$(this).data("term"),t=$(this).data("context");return i.help(t,e),!1})},on_refresh:function(){var e=this.get_core().get_settlement().get_building_by_handle(this.params_data.handle),t=e.get_level(),i='<p class="smalldesc">'+this.params_data.description+"</p><dl>"+civitas.ui.cost_panel(this.params_data.cost)+civitas.ui.materials_panel(this.params_data.materials)+civitas.ui.production_panel(this.params_data.production,t)+civitas.ui.requires_panel(this.params_data.requires)+civitas.ui.chance_panel(this.params_data.chance,t)+civitas.ui.tax_panel(this.params_data.tax,t)+civitas.ui.storage_panel(this.params_data.storage,t)+"</dl>";$("#panel-"+this.id+" .contents").empty().append(i)}},civitas.PANEL_CAMPAIGN={template:'<div id="panel-campaign" class="panel"><header><span class="title"></span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div></div>',params_data:null,id:"campaign",on_show:function(e){var t=this.get_core(),i=(t.get_settlement(),e.data);this.params_data=e,$(this.handle+" .title").empty().html(i.type===civitas.CAMPAIGN_ARMY?civitas.l("Army"):civitas.l("Caravan")),i.type===civitas.CAMPAIGN_ARMY?$(this.handle+" .contents").append(civitas.ui.tabs([civitas.l("Info"),civitas.l("Army"),civitas.l("Navy")])):$(this.handle+" .contents").append(civitas.ui.tabs([civitas.l("Info"),civitas.l("Resources")])),this.on_refresh()},on_refresh:function(){var e=this.get_core(),t=(e.get_settlement(),this.params_data.data),i="",s=e.get_settlement(t.source.id),a=e.get_settlement(t.destination.id),r=civitas.utils.get_distance(t.source,t.destination);if($(this.handle+" #tab-info").empty().append('<img class="avatar" src="'+civitas.ASSETS_URL+"images/avatars/avatar"+s.get_ruler_avatar()+'.png" /><dl><dt>'+civitas.l("Sent By")+"</dt><dd>"+s.get_name()+"</dd><dt>"+civitas.l("Destination")+"</dt><dd>"+a.get_name()+"</dd><dt>s</dt><dd>d</dd><dt>"+civitas.l("Distance")+"</dt><dd>"+r+" miles ("+t.duration+" "+civitas.l("days")+")</dd><dt>"+civitas.l("Remaining")+"</dt><dd>"+10*(t.duration-t.passed)+" miles ("+(t.duration-t.passed)+" "+civitas.l("days")+")</dd></dl>"),t.type===civitas.CAMPAIGN_ARMY)$(this.handle+" #tab-army").empty().append(civitas.ui.army_list(t.data)),$(this.handle+" #tab-navy").empty().append(civitas.ui.navy_list(t.data));else{if(void 0!==t.data.resources){i="<p>"+civitas.l("This caravan has the the following resources:")+"</p><dl>";for(var n in t.data.resources)i+="<dt>"+t.data.resources[n]+"</dt><dd>"+civitas.ui.resource_small_img(n)+"</dd>";i+="</dl>"}else i="<p>"+civitas.l("This is an empty caravan with no resources.")+"</p>";$(this.handle+" #tab-resources").empty().append(i)}}},civitas.PANEL_STORAGE={template:'<div id="panel-storage" class="panel"><header><span class="title">'+civitas.l("City Storage")+'</span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div></div>',expanded:!1,id:"storage",on_show:function(e){var t=this;this.get_core();this.on_refresh(),$(this.handle).on("click",".toggle-storage",function(){return $(".toggle-storage").html()===civitas.l("Show Less Goods")?(t.expanded=!1,$(".toggle-storage").html(civitas.l("Show More Goods"))):(t.expanded=!0,$(".toggle-storage").html(civitas.l("Show Less Goods"))),$(".extra-storage").toggle(),!1})},on_refresh:function(){var e=this.get_core().get_settlement(),t=e.get_resources(),i=e.get_storage_space(),s='<div class="main-storage">',a="",r="";for(var n in t)$.inArray(n,civitas.NON_RESOURCES)===-1&&($.inArray(n,civitas.MAIN_RESOURCES)!==-1?a+=civitas.ui.resource_storage_el(n,t[n]):r+=civitas.ui.resource_storage_el(n,t[n]));s+=a,s+="</div>",s+='<div class="extra-storage hidden">',s+=r,s+="</div>",s+='<div class="clearfix"></div><p>'+civitas.l("Total storage space")+": "+i.all+", "+civitas.l("used")+": "+i.occupied+'</p><div class="toolbar"><a class="btn iblock toggle-storage" href="#">'+civitas.l("Show More Goods")+"</a></div>",$(this.handle+" .contents").empty().append(s),this.expanded===!0&&$(this.handle+" .toggle-storage").trigger("click")}},civitas.PANEL_WORLD={template:'<div id="panel-world" class="panel"><header><span class="title">'+civitas.l("World Map")+'</span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"><div class="worldmap"></div></div></div>',id:"world",on_show:function(e){var t=this.get_core();this.on_refresh(),$(this.handle).on("click",".settlement",function(){var e=$(this).data("name");return"yoursettlement"===e?t.open_panel(civitas.PANEL_COUNCIL):t.open_panel(civitas.PANEL_SETTLEMENT,t.get_settlement(e)),!1}).on("click",".caravan, .army",function(){var e=parseInt($(this).data("id"));return t.open_panel(civitas.PANEL_CAMPAIGN,t.campaigns[e]),!1})},on_refresh:function(){var e=this.get_core(),t=e.get_settlement(),i=e.get_settlements(),s=e.get_worldmap(),a=e.get_campaigns();$(this.handle+" .worldmap").addClass("w"+s);for(var r=civitas["SETTLEMENT_LOCATION_"+t.get_climate().name.toUpperCase()],n='<div data-name="yoursettlement" class="tips settlement c1" title="'+civitas.l("City of")+" "+t.get_name()+'" style="left:'+r.x+"px;top:"+r.y+'px"></div>',o=1;o<i.length;o++)i[o].get_settlement_type()===civitas.CITY?n+='<div data-name="'+i[o].get_name()+'" class="tips settlement c'+civitas.SETTLEMENTS[i[o].get_id()].icon+'" title="'+civitas.l("City of")+" "+i[o].get_name()+'" style="left:'+civitas.SETTLEMENTS[i[o].get_id()].location.x+"px;top:"+civitas.SETTLEMENTS[i[o].get_id()].location.y+'px"></div>':n+='<div data-name="'+i[o].get_name()+'" class="tips settlement v1" title="'+civitas.l("Village of")+" "+i[o].get_name()+'" style="left:'+civitas.SETTLEMENTS[i[o].get_id()].location.x+"px;top:"+civitas.SETTLEMENTS[i[o].get_id()].location.y+'px"></div>';for(var o=0;o<a.length;o++){var c=a[o].source,l=a[o].destination,d=civitas.utils.get_distance_in_days(c,l),h=c.x+Math.floor((l.x-c.x)/d*a[o].passed),u=c.y-Math.floor((c.y-l.y)/d*a[o].passed);n+='<div data-id="'+o+'" class="tips '+(a[o].type===civitas.CAMPAIGN_ARMY?"army":"caravan")+'" title="'+(a[o].type===civitas.CAMPAIGN_ARMY?"Army":"Caravan")+'" style="left:'+h+"px;top:"+u+'px"></div>'}$(this.handle+" .contents .worldmap").empty().append(n)}},civitas.PANEL_RANKS={template:'<div id="panel-ranks" class="panel"><header><span class="title">'+civitas.l("World Ranks")+'</span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"><div class="ranks-list"></div></div></div>',id:"ranks",on_show:function(e){this.on_refresh()},on_refresh:function(){for(var e=[],t=this.get_core().get_settlements(),i=0;i<t.length;i++)t[i].get_settlement_type()===civitas.CITY&&e.push({name:t[i].get_name(),data:t[i].get_rank()});e.sort(function(e,t){var i=new Date(e.data.score),s=new Date(t.data.score);return i>s?-1:i<s?1:0});var s='<table class="normal">';s+='<thead><tr><td class="center">'+civitas.l("Rank")+"</td><td>"+civitas.l("City")+'</td><td class="center">'+civitas.l("Score")+"</td></tr></thead><tbody>";for(var i=0;i<e.length;i++)s+='<tr><td class="center">'+(i+1)+"</td><td>"+e[i].name+'</td><td class="center">'+e[i].data.score+"</td></tr>";s+="</tbody></table>",$(this.handle+" .ranks-list").empty().append(s)}},civitas.PANEL_COUNCIL={template:'<div id="panel-council" class="panel"><header><span class="title">'+civitas.l("City Council")+'</span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div></div>',id:"council",on_show:function(e){var t=this,i=this.get_core(),s=this.handle,a=i.get_settlement();$(s+" .contents").append('<div class="tabs"><ul><li><a href="#tab-info">'+civitas.l("Info")+'</a></li><li><a href="#tab-production">'+civitas.l("Production")+'</a></li><li><a href="#tab-housing">'+civitas.l("Housing")+'</a></li><li><a href="#tab-municipal">'+civitas.l("Municipal")+'</a></li><li><a href="#tab-army">'+civitas.l("Army")+'</a></li><li><a href="#tab-navy">'+civitas.l("Navy")+'</a></li><li><a href="#tab-mercenary">'+civitas.l("Mercenaries")+'</a></li><li><a href="#tab-diplomacy">'+civitas.l("Diplomacy")+'</a></li><li><a href="#tab-achievements">'+civitas.l("Achievements")+'</a></li></ul><div id="tab-info"></div><div id="tab-production"></div><div id="tab-housing"></div><div id="tab-municipal"></div><div id="tab-army"></div><div id="tab-navy"></div><div id="tab-mercenary"></div><div id="tab-diplomacy"></div><div id="tab-achievements"><div class="achievements-list"></div></div></div>'),this.on_refresh(),$(s).on("click",".pact",function(){if(!a.can_diplomacy())return i.error(civitas.l("You will need to construct an Embassy before being able to propose treaties and pacts to other settlements.")),!1;var e=$(this).data("name");return i.get_settlement().get_influence_with_settlement(e)>=50?i.error("Not implemented yet."):i.error(civitas.l("Your influence on")+" "+e+" "+civitas.l("is too low to propose a pact.")),
!1}).on("click",".spy",function(){if(!a.can_diplomacy())return i.error(civitas.l("You will need to construct an Embassy before being able to assign spies to other settlements.")),!1;$(this).data("name");return i.error(civitas.l("Not implemented yet.")),!1}).on("click",".recruit-ship",function(){if(!a.can_build_ships())return i.error(civitas.l("You will need to construct a Shipyard before being able to construct ships in your city.")),!1;$(this).data("handle");return i.error(civitas.l("Not implemented yet.")),!1}).on("click",".declare-war",function(){if(!a.can_diplomacy())return i.error(civitas.l("You will need to construct an Embassy before being able to declare war to other settlements.")),!1;var e=$(this).data("name");i.get_settlement(e);return i.error(civitas.l("Not implemented yet.")),!1}).on("click",".send-goods",function(){if(!a.can_diplomacy())return i.error(civitas.l("You will need to construct an Embassy before being able to send goods to other settlements.")),!1;var e=$(this).data("name");i.get_settlement(e);return i.error(civitas.l("Not implemented yet.")),!1}).on("click",".view-settlement",function(){var e=$(this).data("name"),t=i.get_settlement(e);return i.open_panel(civitas.PANEL_SETTLEMENT,t),!1}).on("click",".recruit-soldier",function(){if(!a.can_recruit_soldiers())return i.error(civitas.l("You will need to construct a Military Camp or Castle before recruiting soldiers in your city.")),!1;var e=$(this).data("handle");return i.get_settlement().recruit_soldier(e)&&t._refresh_army(),!1}).on("click",".view-merc",function(){var e=parseInt($(this).data("id")),t=civitas.MERCENARIES[e];return i.open_panel(civitas.PANEL_ARMY,t),!1}).on("click",".raid-merc",function(){var e=parseInt($(this).data("id"));civitas.MERCENARIES[e];return i.error("Not implemented yet."),!1}).on("click",".campaign-merc",function(){var e=parseInt($(this).data("id"));civitas.MERCENARIES[e];return i.error("Not implemented yet."),!1}).on("click",".disband-merc",function(){var e=parseInt($(this).data("id"));civitas.MERCENARIES[e];return i.error("Not implemented yet."),!1})},on_refresh:function(){var e="#panel-"+this.id,t=this.get_core(),i=t.get_settlement(),s=t.get_settlements(),a=i.get_buildings(),r=(i.get_resources(),t.get_achievements()),n=i.city_council(),e="#panel-"+this.id,o="<p>"+civitas.l("Mercenary armies are available to hire for a fixed price, they do not cost additional resources but they are only available for raiding and campaign missions, they do not participate in the defense of your city.")+"</p><p>"+civitas.l("Also, keep in mind that once a mercenary army is hired, they are at your disposal until the end of the current year.")+'</p><div class="hired-mercenaries-list">';if(i.mercenary.length>0){o+='<table class="normal">';for(var c=0;c<i.mercenary.length;c++){var l=civitas.MERCENARIES[i.mercenary[c].id];o+='<tr><td class="icon"><img src="'+civitas.ASSETS_URL+"images/armies/"+l.icon+'.png" /></td><td><p class="title">'+l.name+'</p><p class="description">'+l.description+'</p></td><td class="large"><a title="'+civitas.l("View info on this mercenary army.")+'" data-id="'+i.mercenary[c].id+'" class="tips view-merc" href="#">'+civitas.l("view")+'</a> <a title="'+civitas.l("Send this mercenary army on a raiding mission. Depending on the success of the mission, they will return with coins and/or resources.")+'" data-id="'+c+'" class="tips raid-merc" href="#">'+civitas.l("raid")+'</a> <a title="'+civitas.l("Send this mercenary arm on a campaign towards a city. Depending on the success of the mission, they will return with prisoniers (future soldiers for your army), coins and/or resources. Winning a campaign will grant you fame and prestige.")+'" data-id="'+c+'" class="tips campaign-merc" href="#">'+civitas.l("campaign")+'</a> <a title="'+civitas.l("Disband this mercenary army? They will be available for hire later when you need them.")+'" data-id="'+c+'" class="tips disband-merc" href="#">'+civitas.l("release")+"</a></td></tr>"}o+="</table>"}else o+="<p>"+civitas.l("You have no mercenary armies hired for your city. Go to the World Market Trades and hire one.")+"</p>";o+="</div>",$("#panel-"+this.id+" #tab-mercenary").empty().append(o);var d=i.get_status();o="",i.can_diplomacy()||(o+="<p>"+civitas.l("You will need to construct an Embassy before being able to propose treaties and pacts to other cities.")+"</p>"),o+='<div class="settlements-list"><table class="normal">';for(var c=1;c<s.length;c++)o+='<tr><td class="icon"><img src="'+civitas.ASSETS_URL+"images/avatars/avatar"+s[c].get_ruler_avatar()+'.png" /></td><td><p><span class="title">'+(s[c].is_city()?"City of":"Village of")+" "+s[c].get_name()+'</span> <span class="description">'+civitas.l("Leader")+": "+s[c].get_ruler_name()+"</span></p>"+civitas.ui.progress(d[s[c].get_id()].influence,"big")+'</td><td class="large"><a data-name="'+s[c].get_name()+'" title="'+civitas.l("View info about this settlement.")+'" class="tips view-settlement" href="#">'+civitas.l("view")+'</a> <a data-name="'+s[c].get_name()+'" title="'+civitas.l("Send a spy to this settlement.")+'" data-id="'+c+'" class="tips spy" href="#">'+civitas.l("spy")+'</a> <a data-name="'+s[c].get_name()+'" title="'+civitas.l("Propose a pact to this settlement`s ruler.")+'" class="tips pact" href="#">'+civitas.l("pact")+'</a> <a data-name="'+s[c].get_name()+'" title="'+civitas.l("Send goods to this settlement.")+'" data-id="'+c+'" class="tips send-goods" href="#">'+civitas.l("send")+'</a> <a data-name="'+s[c].get_name()+'" title="'+civitas.l("Declare war to this settlement.")+'" data-id="'+c+'" class="tips declare-war" href="#">'+civitas.l("war")+"</a></td></tr>";o+="</table></div>",$("#panel-"+this.id+" #tab-diplomacy").empty().append(o),o="";for(var c=0;c<r.length;c++){var h=t.get_achievement_by_id(r[c].id);h!==!1&&(o+='<div class="achievement"><div class="left"><div class="ach img"></div></div><div class="right"><div class="inner"><h2>'+h.name+"</h2>"+h.description+'</div><div class="time" title="'+r[c].date+'"><strong>'+civitas.utils.time_since(r[c].date)+"</strong> ago</div></div></div>")}if($("#panel-"+this.id+" .achievements-list").empty().append(o),o='<div class="column"><dl><dt>'+civitas.l("Current date")+'</dt><dd class="citydate">'+t.get_date()+"</dd><dt>"+civitas.l("Ruler")+"</dt><dd>"+i.get_ruler_name()+"</dd><dt>"+civitas.l("Climate")+"</dt><dd>"+i.get_climate().name.capitalize()+"</dd><dt>"+civitas.l("Personality")+"</dt><dd>"+i.get_personality().name.capitalize()+"</dd><dt>"+civitas.l("Nationality")+"</dt><dd>"+i.get_nationality().name.capitalize()+"</dd><dt>"+civitas.l("Population")+"</dt><dd>"+civitas.utils.nice_numbers(i.get_population())+"</dd><dt>"+civitas.l("Religion")+"</dt><dd>"+i.get_religion().name.capitalize()+"</dd><dt>"+civitas.l("Level")+"</dt><dd>"+civitas.ui.progress(100*i.get_level()/civitas.MAX_SETTLEMENT_LEVEL,"small",i.get_level())+"</dd><dt>"+civitas.l("Prestige")+"</dt><dd>"+civitas.ui.progress(100*i.get_prestige()/civitas.MAX_PRESTIGE_VALUE,"small",i.get_prestige())+"</dd><dt>"+civitas.l("Espionage")+"</dt><dd>"+civitas.ui.progress(100*i.get_espionage()/civitas.MAX_ESPIONAGE_VALUE,"small",i.get_espionage())+"</dd><dt>"+civitas.l("Faith")+"</dt><dd>"+civitas.ui.progress(100*i.get_faith()/civitas.MAX_FAITH_VALUE,"small",i.get_faith())+"</dd><dt>"+civitas.l("Research")+"</dt><dd>"+civitas.ui.progress(100*i.get_research()/civitas.MAX_RESEARCH_VALUE,"small",i.get_research())+"</dd></dl></div>",n.length>0){o+='<div class="column"><ul class="advices">';for(var u=0;u<n.length;u++)o+="<li>"+n[u]+"</li>";o+="</ul></div>"}$("#panel-"+this.id+" #tab-info").empty().append(o),o='<table class="normal"><thead><tr><td></td><td class="center">'+civitas.l("Level")+"</td><td>"+civitas.l("Raises")+"</td><td>"+civitas.l("Uses")+"</td></tr></thead>";for(var p=0,m={fame:0,espionage:0,research:0},v=0;v<a.length;v++)if(a[v].is_municipal_building()){var _=a[v].get_building_data();if(o+="<tr"+(a[v].has_problems()===!1?"":' class="notify"')+"><td>"+a[v].get_name()+'</td><td class="center">'+a[v].get_level()+"</td><td>",_.production)for(var g in _.production)m[g]+=a[v].has_problems()===!1?a[v].get_level()*_.production[g]:0,o+=" +"+a[v].get_level()*_.production[g]+" "+civitas.ui.resource_small_img(g);if(o+="</td><td>",_.materials)for(var g in _.materials)p+=a[v].has_problems()===!1?_.materials[g]:0,o+=" -"+_.materials[g]+" "+civitas.ui.resource_small_img(g);o+="</td></tr>"}var f="";for(var g in m)m[g]>0&&(f+=" +"+m[g]+" "+civitas.ui.resource_small_img(g));o+="<tfoot><tr><td>"+civitas.l("Total")+"</td><td></td><td>"+f+"</td><td>-"+p+" "+civitas.ui.resource_small_img("coins")+"</td></tr></tfoot></table>",$("#panel-"+this.id+" #tab-municipal").empty().append(o),o='<table class="normal"><thead><tr><td></td><td class="center">'+civitas.l("Level")+"</td><td>"+civitas.l("Tax")+"</td><td>"+civitas.l("Materials")+"</td></tr></thead>";for(var y=0,v=0;v<a.length;v++)if(a[v].is_housing_building()){var _=a[v].get_building_data();if(o+="<tr"+(a[v].has_problems()===!1?"":' class="notify"')+"><td>"+a[v].get_name()+'</td><td class="center">'+a[v].get_level()+"</td><td>",_.tax&&(y+=a[v].has_problems()===!1?a[v].get_level()*_.tax:0,o+=" +"+a[v].get_level()*_.tax+" "+civitas.ui.resource_small_img("coins")),o+="</td><td>",_.materials)for(var g in _.materials)o+=" -"+_.materials[g]+" "+civitas.ui.resource_small_img(g);o+="</td></tr>"}o+="<tfoot><tr><td>"+civitas.l("Income")+"</td><td></td><td>+"+y+" "+civitas.ui.resource_small_img("coins")+"</td><td></td></tr></tfoot></table>",$("#panel-"+this.id+" #tab-housing").empty().append(o),o='<table class="normal"><thead><tr><td></td><td class="center">'+civitas.l("Level")+"</td><td>"+civitas.l("Production")+"</td><td>"+civitas.l("Materials")+'</td><td class="center">'+civitas.l("Stopped")+"</td></tr></thead>";for(var v=0;v<a.length;v++)if(a[v].is_production_building()&&a[v].is_municipal_building()===!1){var _=a[v].get_building_data();if(o+="<tr"+(a[v].has_problems()===!1?"":' class="notify"')+"><td>"+a[v].get_name()+'</td><td class="center">'+a[v].get_level()+"</td><td>",_.production)for(var g in _.production)o+=" +"+a[v].get_level()*_.production[g]+" "+civitas.ui.resource_small_img(g);if(o+="</td><td>",_.materials)for(var g in _.materials)o+=" -"+_.materials[g]+" "+civitas.ui.resource_small_img(g);o+='</td><td class="center">'+(a[v].is_producing()===!0?civitas.l("no"):civitas.l("yes"))+"</td></tr>"}o+='<tfoot><tr><td></td><td class="center">'+civitas.l("Level")+"</td><td>"+civitas.l("Production")+"</td><td>"+civitas.l("Materials")+'</td><td class="center">'+civitas.l("Stopped")+"</td></tr></tfoot></table>",$("#panel-"+this.id+" #tab-production").empty().append(o),o="",i.can_recruit_soldiers()||(o+="<p>"+civitas.l("You will need to construct a Military Camp or Castle before being able to recruit soldiers in your city.")+"</p>"),o+='<div class="army-list"></div><div class="army-recruiter">';for(var g in civitas.SOLDIERS){o+="<fieldset><legend>"+g+'</legend><div class="cost"><dl class="nomg">';for(var E in civitas.SOLDIERS[g].cost)o+="<dt>"+civitas.utils.nice_numbers(civitas.SOLDIERS[g].cost[E])+"</dt><dd>"+civitas.ui.resource_small_img(E)+"</dd>";o+='</dl></div><div class="info"><dl class="nomg"><dt>Attack</dt><dd>'+civitas.SOLDIERS[g].attack+"</dd><dt>Defense</dt><dd>"+civitas.SOLDIERS[g].defense+'</dd></dl></div><img data-handle="'+g+'" title="'+civitas.l("Recruit")+" "+g+'" class="tips recruit-soldier" src="'+civitas.ASSETS_URL+"images/armies/"+g.toLowerCase()+'.png" /></fieldset>'}o+="</div>",$("#panel-"+this.id+" #tab-army").empty().append(o),o="<fieldset><legend>"+civitas.l("Current Army")+"</legend>"+civitas.ui.army_list(i.get_army_total(),!0)+"</fieldset>",$(e+" .army-list").empty().append(o),o="",i.can_build_ships()||(o+="<p>"+civitas.l("You will need to construct a Shipyard before being able to construct ships in your city.")+"</p>"),o+='<div class="navy-list"></div><div class="navy-recruiter">';for(var g in civitas.SHIPS){o+="<fieldset><legend>"+g+'</legend><div class="cost"><dl class="nomg">';for(var E in civitas.SHIPS[g].cost)o+="<dt>"+civitas.utils.nice_numbers(civitas.SHIPS[g].cost[E])+"</dt><dd>"+civitas.ui.resource_small_img(E)+"</dd>";o+='</dl></div><div class="info"><dl class="nomg"><dt>'+civitas.l("Attack")+"</dt><dd>"+civitas.SHIPS[g].attack+"</dd><dt>"+civitas.l("Defense")+"</dt><dd>"+civitas.SHIPS[g].defense+'</dd></dl></div><img data-handle="'+g+'" title="'+civitas.l("Recruit")+" "+g+'" class="tips recruit-ship" src="'+civitas.ASSETS_URL+"images/armies/"+g.toLowerCase().replace(/ /g,"_")+'.png" /></fieldset>'}o+="</div>",$("#panel-"+this.id+" #tab-navy").empty().append(o),o="<fieldset><legend>"+civitas.l("Current Navy")+"</legend>"+civitas.ui.navy_list(i.get_navy_total(),!0)+"</fieldset>",$(e+" .navy-list").empty().append(o)}},civitas.PANEL_ARMY={template:'<div id="panel-army" class="panel"><header><span class="title"></span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div></div>',id:"army",on_show:function(e){var t=e.data;$(this.handle+" header .title").html(t.name),$(this.handle+" .contents").append(civitas.ui.tabs(["Info","Soldiers","Ships"])),$(this.handle+" #tab-info").append('<img class="avatar" src="'+civitas.ASSETS_URL+"images/armies/"+(void 0!==t.icon?t.icon:"22")+'.png" /><p>'+t.description+"</p>"),$(this.handle+" #tab-soldiers").append(civitas.ui.army_list(t)),$(this.handle+" #tab-ships").append(civitas.ui.navy_list(t))}},civitas.PANEL_BUILDINGS={template:'<div id="panel-buildings" class="panel"><header><span class="title">'+civitas.l("City Buildings")+'</span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div></div>',id:"buildings",on_show:function(e){var t=this.get_core(),i=t.get_settlement(),s=(i.get_resources(),this.handle),a='<div class="left buildings">',r=civitas["SETTLEMENT_BUILDINGS_"+i.get_climate().name.toUpperCase()];a+='<div class="tabs"><ul>';for(var n in civitas.BUILDINGS_CATEGORIES)a+='<li><a href="#tab-'+n.toLowerCase()+'">'+n+"</a></li>";a+="</ul>";for(var n in civitas.BUILDINGS_CATEGORIES){a+='<div id="tab-'+n.toLowerCase()+'" class="bldg-tabs">';for(var o=0;o<civitas.BUILDINGS_CATEGORIES[n].length;o++){var c=civitas.BUILDINGS_CATEGORIES[n][o];if($.inArray(c,r)!==-1){var l=civitas.BUILDINGS[civitas.BUILDINGS.findIndexM(c)],d=i.is_building_built(l.handle);a+='<div data-handle="'+l.handle+'" class="building-item'+(d===!0?" disabled":"")+'"><span class="title">'+l.name+'</span><img class="building" src="'+civitas.ASSETS_URL+"images/buildings/"+("house"===l.handle.slice(0,-1)?l.handle.slice(0,-1):l.handle)+'1.png" /></div>'}}a+="</div>"}a+='</div></div><div class="buildings-info right"><div class="b-desc"></div><fieldset><legend>'+civitas.l("Cost")+'</legend><div class="b-cost"></div></fieldset><fieldset class="materials"><legend>'+civitas.l("Materials")+'</legend><div class="b-mats"></div></fieldset><fieldset class="production"><legend>'+civitas.l("Production")+'</legend><div class="b-prod"></div></fieldset><fieldset class="extra"><legend>'+civitas.l("Extra materials")+'</legend><div class="b-chance"></div></fieldset><fieldset class="storage"><legend>'+civitas.l("Storage")+'</legend><div class="b-store"></div></fieldset><fieldset class="taxes"><legend>'+civitas.l("Taxes")+'</legend><div class="b-tax"></div></fieldset><fieldset><legend>'+civitas.l("Requirements")+'</legend><div class="b-req"></div></fieldset><div class="toolbar"></div></div>',$(s+" .contents").append(a),$(s).on("click",".building-item",function(){$(s).addClass("expanded"),$(s+" .building-item").removeClass("active"),$(this).addClass("active"),$(s+" .b-chance, "+s+" .b-tax, "+s+" .b-store, "+s+" .b-req, "+s+" .b-cost, "+s+" .b-name, "+s+" .b-desc, "+s+" .b-mats, "+s+" .b-prod, "+s+" .toolbar").empty();var e=$(this).data("handle"),a=civitas.BUILDINGS[civitas.BUILDINGS.findIndexM(e)];$(s+" header .title").html(civitas.l("City Buildings")+" - "+a.name),$(s+" .b-desc").html(a.description);var r='<dl class="nomg">';for(var n in a.cost)r+="<dt>"+civitas.utils.nice_numbers(a.cost[n])+'</dt><dd><img class="tips" title="'+civitas.utils.get_resource_name(n)+'" src="'+civitas.ASSETS_URL+"images/resources/"+n+'_small.png" /></dd>';if(r+="</dl>",$(s+" .b-cost").append(r),void 0!==a.requires){if(r='<dl class="nomg">',void 0!==a.requires.buildings)if("object"==typeof a.requires.buildings)for(var o=0;o<a.requires.buildings.length;o++)r+="<dt>"+civitas.l("Building")+"</dt><dd>"+t.get_building_config_data(a.requires.buildings[o]).name+"</dd>";else r+="<dt>"+civitas.l("Building")+"</dt><dd>"+t.get_building_config_data(a.requires.buildings).name+"</dd>";r+="<dt>"+civitas.l("City level")+"</dt><dd>"+a.requires.settlement_level+"</dd></dl>",$(s+" .b-req").append(r)}if(void 0!==a.chance){r='<dl class="nomg">';for(var c in a.chance)r+="<dt>"+100*a.chance[c]+'%</dt><dd><img class="tips" title="'+civitas.utils.get_resource_name(c)+'" src="'+civitas.ASSETS_URL+"images/resources/"+c+'_small.png" /></dd>';r+="</dl>",$(s+" .b-chance").append(r),$("fieldset.extra").show()}else $("fieldset.extra").hide();if(a.is_production===!0){if($("fieldset.taxes, fieldset.production, fieldset.materials, fieldset.storage").hide(),void 0!==a.production){r='<dl class="nomg">';for(var n in a.production)r+="<dt>"+a.production[n]+'</dt><dd><img class="tips" title="'+civitas.utils.get_resource_name(n)+'" src="'+civitas.ASSETS_URL+"images/resources/"+n+'_small.png" /></dd>';r+="</dl>",$(s+" .b-prod").append(r),$("fieldset.production").show()}if(void 0!==a.materials){r='<dl class="nomg">';for(var n in a.materials)r+="<dt>"+a.materials[n]+'</dt><dd><img class="tips" title="'+civitas.utils.get_resource_name(n)+'" src="'+civitas.ASSETS_URL+"images/resources/"+n+'_small.png" /></dd>';r+="</dl>",$(s+" .b-mats").append(r),$("fieldset.materials").show()}}else if(a.is_housing===!0){if($("fieldset.production, fieldset.storage").hide(),void 0!==a.materials){r='<dl class="nomg">';for(var n in a.materials)r+="<dt>"+a.materials[n]+'</dt><dd><img class="tips" title="'+civitas.utils.get_resource_name(n)+'" src="'+civitas.ASSETS_URL+"images/resources/"+n+'_small.png" /></dd>';r+="</dl>",$(s+" .b-mats").append(r),$("fieldset.materials").show()}void 0!==a.tax&&(r='<dl class="nomg"><dt>Tax</dt><dd>'+a.tax+'<img class="tips" title="'+civitas.l("Coins")+'" src="'+civitas.ASSETS_URL+'images/resources/coins_small.png" /></dd></dl>',$(s+" .b-tax").append(r),$("fieldset.taxes").show())}else void 0!==a.storage?($("fieldset.taxes, fieldset.production, fieldset.materials").hide(),r='<dl class="nomg"><dt>'+a.storage+'</dt><dd><img class="tips" title="'+civitas.l("Storage Space")+'" src="'+civitas.ASSETS_URL+'images/resources/storage_small.png" /></dd></dl>',$(s+" .b-store").append(r),$("fieldset.storage").show()):$("fieldset.taxes, fieldset.production, fieldset.materials, fieldset.storage").hide();return i.is_building_built(a.handle)!==!0?$(s+" .toolbar").append('<a href="#" class="btn build" data-handle="'+a.handle+'">'+civitas.l("Build")+"</a>"):$(s+" .toolbar").append(civitas.l("You already constructed this building.")),$(s+" .right").show(),!1}).on("click",".btn.build",function(){var e=$(this).data("handle");return i.build(e)!==!1&&($(s+" .building-item[data-handle="+e+"]").addClass("disabled"),$(s+" .toolbar").empty().append(civitas.l("You already have this building."))),!1})}},civitas.PANEL_TRADES={template:'<div id="panel-trades" class="panel"><header><span class="title">'+civitas.l("World Market")+'</span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div></div>',id:"trades",on_show:function(e){var t=this,i=this.get_core(),s=i.get_settlement(),a=this.handle,r="";r+=civitas.ui.tabs([civitas.l("Export"),civitas.l("Import"),civitas.l("Mercenaries"),civitas.l("BlackMarket"),civitas.l("Prices")]),$(a+" .contents").append(r),$(a+" #tab-import").append("<p>"+civitas.l("Below is a list of goods that the other cities in the world are looking to sell. The goods replenish every three months, so plan accordingly. You will need to build a Trading Post before being able to sell goods.")+'</p><div class="contents"></div>'),$(a+" #tab-export").append("<p>"+civitas.l("Below is a list of goods that the other cities in the world are looking to buy. The goods replenish every three months, so plan accordingly. You will need to build a Trading Post before being able to buy goods.")+'</p><div class="contents"></div>'),$(a+" #tab-mercenaries").append("<p>"+civitas.l("Below is a list of mercenary armies that are looking for hire. Mercenaries are available only for raiding and conquest missions, they do not join your city so they will not participate in defense.")+'</p><div class="contents"></div>'),$(a+" #tab-blackmarket").append("<p>"+civitas.l("The Black Market is a way to dump your excess materials when you`re in need of emptying your warehouses, but expect a steep price drop (taxes for all Black Market trades are <strong>")+civitas.BLACK_MARKET_DISCOUNT+civitas.l("%</strong>). The goods will be taken immediately from your warehouses but you will receive the coins at the <strong>start of the next month</strong>. Also, you get <strong>no prestige</strong> from Black Market trades.")+'</p><div class="contents"></div>'),$(a+" #tab-prices").append('<div class="contents"></div>'),this.on_refresh(),$(a).on("click",".buy:not(.disabled)",function(){if(!s.can_trade())return i.error(civitas.l("You will need to construct a Trading Post before being able to trade resources with other settlements.")),!1;var e=$(this).data("settlement"),a=$(this).data("resource");return s.buy_from_settlement(e,a)!==!1&&t.on_refresh(),!1}).on("click",".sell:not(.disabled)",function(){if(!s.can_trade())return i.error(civitas.l("You will need to construct a Trading Post before being able to trade resources with other settlements.")),!1;var e=$(this).data("settlement"),a=$(this).data("resource");return s.sell_to_settlement(e,a)!==!1&&t.on_refresh(),!1}).on("click",".bmarket",function(){var e=$(".bm-materials").val(),a=$(".bm-quantity").val(),r=$(".bm-qty-manual").val(),n=""===r?parseInt(a):parseInt(r);return"0"!==e&&n>0?s.list_black_market(e,n)&&t.on_refresh():i.error(civitas.l("Select a resource and the amount of it you want to place on the Black Market.")),!1}).on("click",".recruit:not(.disabled)",function(){var e=$(this).data("handle");return s.recruit_mercenary_army(e)!==!1&&t.on_refresh(),!1}).on("click",".view-army:not(.disabled)",function(){var e=parseInt($(this).data("id")),t=civitas.MERCENARIES[e];return i.open_panel(civitas.PANEL_ARMY,t),!1})},on_refresh:function(){var e=this.get_core(),t=e.get_settlement(),i=e.get_settlements(),s='<table class="normal">';s+="<thead><tr><td>"+civitas.l("Resources")+': <select class="bm-materials"></select></td><td>'+civitas.l("Quantity")+': <select class="bm-quantity"><option value="0">-- '+civitas.l("select")+' --</option><option value="10">10</option><option value="100">100</option><option value="1000">1000</option><option value="10000">10000</option></select> '+civitas.l("or enter manually")+' <input type="text" placeholder="'+civitas.l("amount")+'" class="small bm-qty-manual" /></td><td><a title="'+civitas.l("List goods on Black Market")+'" class="tips bmarket" href="#">'+civitas.l("list")+"</a></td></tr></thead>",s+="<tbody></tbody></table>",$("#tab-blackmarket > .contents").empty().append(s);var s="",a=e.get_black_market();for(var r in a)s+="<tr><td>"+civitas.l("Amount")+": "+a[r].amount+civitas.ui.resource_small_img(r)+"</td><td>"+civitas.l("Total price")+": "+a[r].price+civitas.ui.resource_small_img("coins")+"</td><td>&nbsp;</td></tr>";$("#tab-blackmarket > .contents > table > tbody").empty().append(s);var s='<option value="0">-- '+civitas.l("select")+" --</option>",n=t.get_resources();for(var r in n)$.inArray(r,civitas.NON_RESOURCES)===-1&&(s+='<option value="'+r+'"> '+civitas.utils.get_resource_name(r)+"</option>");$(".bm-materials").empty().append(s);for(var s='<table class="normal"><thead><tr><td>'+civitas.l("City")+'</td><td class="center">'+civitas.l("Goods")+'</td><td class="center">'+civitas.l("Amount")+'</td><td class="center">'+civitas.l("Price")+'</td><td class="center">'+civitas.l("Discount")+'</td><td class="center">'+civitas.l("City Price")+'</td><td class="center">'+civitas.l("Total price")+"</td><td></td></tr></thead>",o=0;o<i.length;o++){var t=i[o],c=i[o].get_trades(),n=t.get_resources();if(null!==c){var l=c.imports;for(var r in l){var d=Math.ceil(civitas.RESOURCES[r].price*civitas.TRADES_DISCOUNT/100),h=Math.ceil(civitas.RESOURCES[r].price-d);s+="<tr><td>"+i[o].get_name()+'</td><td class="center">'+civitas.ui.resource_small_img(r)+'</td><td class="center">'+l[r]+'</td><td class="center">'+civitas.RESOURCES[r].price+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+d+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+h+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+Math.ceil(h*l[r])+civitas.ui.resource_small_img("coins")+'</td><td class="center"><a title="'+civitas.l("Sell those goods")+'" data-resource="'+r+'" data-settlement="'+i[o].get_name()+'" class="tips sell'+(0===l[r]?" disabled":"")+'" href="#">'+civitas.l("sell")+"</a></td></tr>"}}}s+="<tfoot><tr><td>"+civitas.l("City")+'</td><td class="center">'+civitas.l("Goods")+'</td><td class="center">'+civitas.l("Amount")+'</td><td class="center">'+civitas.l("Price")+'</td><td class="center">'+civitas.l("Discount")+'</td><td class="center">'+civitas.l("City Price")+'</td><td class="center">'+civitas.l("Total price")+"</td><td></td></tr></tfoot></table>",$("#tab-export > .contents").empty().append(s);for(var s='<table class="mercenaries">',u=0;u<civitas.MERCENARIES.length;u++)s+='<tr><td class="icon"><img src="'+civitas.ASSETS_URL+"images/armies/"+civitas.MERCENARIES[u].icon+'.png" /></td><td><p class="title">'+civitas.MERCENARIES[u].name+'</p><p class="description">'+civitas.MERCENARIES[u].description+"</p></td><td>"+civitas.utils.nice_numbers(civitas.MERCENARIES[u].cost)+civitas.ui.resource_small_img("coins")+'</td><td class="medium"><a title="'+civitas.l("View info on this mercenary army")+'" data-id="'+u+'" class="tips view-army" href="#">view</a> '+civitas.ui.panel_btn("recruit",civitas.l("Recruit this mercenary army"),civitas.MERCENARIES[u].handle,"recruit",t.is_mercenary_recruited(civitas.MERCENARIES[u].handle))+"</td></tr>";s+="</table>",$("#tab-mercenaries > .contents").empty().append(s);for(var s='<table class="normal"><thead><tr><td>'+civitas.l("City")+'</td><td class="center">'+civitas.l("Goods")+'</td><td class="center">'+civitas.l("Amount")+'</td><td class="center">'+civitas.l("Price")+'</td><td class="center">'+civitas.l("Tax")+'</td><td class="center">'+civitas.l("City Price")+'</td><td class="center">'+civitas.l("Total price")+"</td><td></td></tr></thead>",o=0;o<i.length;o++){var t=i[o],c=i[o].get_trades(),n=t.get_resources();if(null!==c){var p=c.exports;for(var r in p){var d=Math.ceil(civitas.RESOURCES[r].price*civitas.TRADES_ADDITION/100),h=Math.ceil(civitas.RESOURCES[r].price+d);s+="<tr><td>"+i[o].get_name()+'</td><td class="center">'+civitas.ui.resource_small_img(r)+'</td><td class="center">'+p[r]+'</td><td class="center">'+civitas.RESOURCES[r].price+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+d+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+h+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+Math.ceil(h*p[r])+civitas.ui.resource_small_img("coins")+'</td><td class="center"><a title="'+civitas.l("Buy those goods")+'" data-resource="'+r+'" data-settlement="'+i[o].get_name()+'" class="tips buy'+(0===p[r]?" disabled":"")+'" href="#">'+civitas.l("buy")+"</a></td></tr>"}}}s+="<tfoot><tr><td>"+civitas.l("City")+'</td><td class="center">'+civitas.l("Goods")+'</td><td class="center">'+civitas.l("Amount")+'</td><td class="center">'+civitas.l("Price")+'</td><td class="center">'+civitas.l("Tax")+'</td><td class="center">'+civitas.l("City Price")+'</td><td class="center">'+civitas.l("Total price")+"</td><td></td></tr></tfoot></table>",$("#tab-import > .contents").empty().append(s);var s='<table class="normal"><thead><tr><td>'+civitas.l("Resource")+'</td><td class="center">'+civitas.l("Icon")+'</td><td class="center">'+civitas.l("Price")+'</td><td class="center tips" title="This is the price you get for selling one unit of the resource to another settlement, minus the <strong>'+civitas.TRADES_DISCOUNT+'%</strong> export taxes.">'+civitas.l("Sell Price")+'</td><td class="center tips" title="This is the price you get for buying one unit of the resource from another settlement, plus the <strong>'+civitas.TRADES_ADDITION+'%</strong> import taxes.">'+civitas.l("Buy Price")+'</td><td class="center tips" title="This is the price you get for placing one unit of the resource on the Black Market, minus the <strong>'+civitas.BLACK_MARKET_DISCOUNT+'%</strong> taxes.">'+civitas.l("BM Price")+'</td><td class="center tips" title="If the resource is listed as produced, that possibility depends on the location and climate of your settlement (ex. tropical settlements can build <strong>Sugar Farms</strong> and produce <strong>Sugar</strong>).">'+civitas.l("Type")+"</td></tr></thead>";for(var r in civitas.RESOURCES)if($.inArray(r,civitas.NON_RESOURCES)===-1){var d=Math.ceil(civitas.RESOURCES[r].price*civitas.TRADES_ADDITION/100),m=Math.ceil(civitas.RESOURCES[r].price*civitas.TRADES_DISCOUNT/100),v=Math.ceil(civitas.RESOURCES[r].price*civitas.BLACK_MARKET_DISCOUNT/100);s+="<tr><td>"+civitas.RESOURCES[r].name+'</td><td class="center">'+civitas.ui.resource_small_img(r)+'</td><td class="center">'+civitas.RESOURCES[r].price+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+(civitas.RESOURCES[r].price-m)+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+(civitas.RESOURCES[r].price+d)+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+(civitas.RESOURCES[r].price-v)+civitas.ui.resource_small_img("coins")+'</td><td class="center">'+(civitas.RESOURCES[r].imported===!0?civitas.l("imported"):civitas.l("produced"))+"</td></tr>"}s+="<tfoot><tr><td>"+civitas.l("Resource")+'</td><td class="center">'+civitas.l("Icon")+'</td><td class="center">'+civitas.l("Price")+'</td><td class="center">'+civitas.l("Sell Price")+'</td><td class="center">'+civitas.l("Buy Price")+'</td><td class="center">'+civitas.l("BM Price")+'</td><td class="center">'+civitas.l("Type")+"</td></tr></tfoot></table>",$("#tab-prices > .contents").empty().append(s)}},civitas.PANEL_CHURCH={template:'<div id="panel-church" class="panel"><header><span class="title">'+civitas.l("Church")+'</span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div><footer class="footer clearfix"><a class="tips demolish btn" title="'+civitas.l("Demolish this building")+'"></a><a class="tips pause start btn" title="'+civitas.l("Control (start/pause) production")+'"></a><a class="tips upgrade btn" title="'+civitas.l("Upgrade building")+'"></a></footer></div>',id:"church",on_show:function(e){var t=this;this.params_data=e.data;var i=this.get_core(),s=this.handle,a=this.get_core().get_settlement(),r=i.get_settlement().get_building_by_handle(this.params_data.handle);r.get_level();$(s+" header .title").html(this.params_data.name),$(s+" .contents").append(civitas.ui.tabs([civitas.l("Info"),civitas.l("Religion")])),this.on_refresh(),$(s).on("click",".religion",function(){var e=parseInt($(this).data("id"));return confirm(civitas.l("Are you sure you want to switch religions? You will lose all your accumulated faith!"))===!0&&a.change_religion(e),!1}),r.is_upgradable()?$(s).on("click",".upgrade",function(){return confirm(civitas.l("Are you sure you want to upgrade this building?"))===!0&&r.upgrade()&&(r.is_upgradable()||$(s+" .footer .upgrade").remove()),!1
}):$(s+" .footer .upgrade").remove(),r.is_marketplace()?$(s+" .footer .demolish").remove():$(s).on("click",".demolish",function(){return confirm(civitas.l("Are you sure you want to demolish this building?"))===!0&&r.demolish()&&(t.destroy(),i.refresh()),!1}),r.is_production_building()?(r.is_producing()?$(s+" .pause").removeClass("start"):$(s+" .start").removeClass("pause"),$(s).on("click",".pause",function(){return r.stop_production(),$(this).removeClass("pause").addClass("start"),!1}).on("click",".start",function(){return $(this).removeClass("start").addClass("pause"),r.start_production(),!1})):$(s+" .start, "+s+" .pause").remove()},on_refresh:function(){var e=this.get_core().get_settlement(),t=this.get_core().get_settlement().get_building_by_handle(this.params_data.handle),i=t.get_level(),s="<p>"+this.params_data.description+"</p><dl>"+civitas.ui.cost_panel(this.params_data.cost)+civitas.ui.materials_panel(this.params_data.materials)+civitas.ui.production_panel(this.params_data.production,i)+civitas.ui.requires_panel(this.params_data.requires)+civitas.ui.chance_panel(this.params_data.chance,i)+civitas.ui.tax_panel(this.params_data.tax,i)+civitas.ui.storage_panel(this.params_data.storage,i)+"</dl>";$("#panel-"+this.id+" #tab-info").empty().append(s),s='<div class="section">'+civitas.ui.progress(100*e.get_faith()/civitas.MAX_FAITH_VALUE,"large",e.get_faith())+'</div><p>Changing your settlement`s religion requires 1000 faith and resets your settlement`s faith. Each religion gives you access to different heroes in your Tavern and gives you a boost to the influence with the cities sharing the same religion.</p><div class="religion-list">';for(var a=0;a<civitas.RELIGIONS.length;a++)s+='<div data-handle="'+civitas.RELIGIONS[a]+'" data-id="'+a+'" class="religion'+(e.get_religion().id===a?" selected":"")+'"><span>'+civitas.RELIGIONS[a].capitalize()+"</span></div>";s+="</div>",$("#panel-"+this.id+" #tab-religion").empty().append(s)}},civitas.PANEL_EMBASSY={template:'<div id="panel-embassy" class="panel"><header><span class="title">'+civitas.l("Embassy")+'</span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div><footer class="footer"><a class="tips demolish btn" title="'+civitas.l("Demolish this building")+'"></a><a class="tips pause start btn" title="'+civitas.l("Control (start/pause) production")+'"></a><a class="tips upgrade btn" title="'+civitas.l("Upgrade building")+'"></a></footer></div>',id:"embassy",on_show:function(e){var t=this;this.params_data=e.data;var i=this.get_core(),s=this.handle,a=i.get_settlement().get_building_by_handle(this.params_data.handle);a.get_level();$(s+" header .title").html(this.params_data.name);var r=civitas.ui.tabs([civitas.l("Info"),civitas.l("Espionage")]);$(s+" .contents").append(r),this.on_refresh(),a.is_upgradable()?$(s).on("click",".upgrade",function(){return confirm(civitas.l("Are you sure you want to upgrade this building?"))===!0&&a.upgrade()&&(a.is_upgradable()||$(s+" .footer .upgrade").remove()),!1}):$(s+" .footer .upgrade").remove(),a.is_marketplace()?$(s+" .footer .demolish").remove():$(s).on("click",".demolish",function(){return confirm(civitas.l("Are you sure you want to demolish this building?"))===!0&&a.demolish()&&(t.destroy(),i.refresh()),!1}),a.is_production_building()?(a.is_producing()?$(s+" .pause").removeClass("start"):$(s+" .start").removeClass("pause"),$(s).on("click",".pause",function(){return a.stop_production(),$(this).removeClass("pause").addClass("start"),!1}).on("click",".start",function(){return $(this).removeClass("start").addClass("pause"),a.start_production(),!1})):$(s+" .start, "+s+" .pause").remove()},on_refresh:function(){var e=this.get_core().get_settlement(),t=this.get_core().get_settlement().get_building_by_handle(this.params_data.handle),i=t.get_level(),s="<p>"+this.params_data.description+"</p><dl>"+civitas.ui.cost_panel(this.params_data.cost)+civitas.ui.materials_panel(this.params_data.materials)+civitas.ui.production_panel(this.params_data.production,i)+civitas.ui.requires_panel(this.params_data.requires)+civitas.ui.chance_panel(this.params_data.chance,i)+civitas.ui.tax_panel(this.params_data.tax,i)+civitas.ui.storage_panel(this.params_data.storage,i)+"</dl>";$("#panel-"+this.id+" #tab-info").empty().append(s),s='<div class="section">'+civitas.ui.progress(100*e.get_espionage()/civitas.MAX_ESPIONAGE_VALUE,"large",e.get_espionage())+"</div>",$("#panel-"+this.id+" #tab-espionage").empty().append(s)}},civitas.PANEL_ACADEMY={template:'<div id="panel-academy" class="panel"><header><span class="title">'+civitas.l("Academy")+'</span><a class="tips btn close" title="'+civitas.l("Close this panel")+'"></a></header><div class="contents"></div><footer class="footer"><a class="tips demolish btn" title="'+civitas.l("Demolish this building")+'"></a><a class="tips pause start btn" title="'+civitas.l("Control (start/pause) production")+'"></a><a class="tips upgrade btn" title="'+civitas.l("Upgrade building")+'"></a></footer></div>',id:"academy",on_show:function(e){var t=this;this.params_data=e.data;var i=this.get_core(),s=this.handle,a=i.get_settlement().get_building_by_handle(this.params_data.handle);a.get_level();$(s+" header .title").html(this.params_data.name);var r=civitas.ui.tabs([civitas.l("Info"),civitas.l("Research")]);$(s+" .contents").append(r),this.on_refresh(),a.is_upgradable()?$(s).on("click",".upgrade",function(){return confirm(civitas.l("Are you sure you want to upgrade this building?"))===!0&&a.upgrade()&&(a.is_upgradable()||$(s+" .footer .upgrade").remove()),!1}):$(s+" .footer .upgrade").remove(),a.is_marketplace()?$(s+" .footer .demolish").remove():$(s).on("click",".demolish",function(){return confirm(civitas.l("Are you sure you want to demolish this building?"))===!0&&a.demolish()&&(t.destroy(),i.refresh()),!1}),a.is_production_building()?(a.is_producing()?$(s+" .pause").removeClass("start"):$(s+" .start").removeClass("pause"),$(s).on("click",".pause",function(){return a.stop_production(),$(this).removeClass("pause").addClass("start"),!1}).on("click",".start",function(){return $(this).removeClass("start").addClass("pause"),a.start_production(),!1})):$(s+" .start, "+s+" .pause").remove()},on_refresh:function(){var e=this.get_core().get_settlement(),t=this.get_core().get_settlement().get_building_by_handle(this.params_data.handle),i=t.get_level(),s="<p>"+this.params_data.description+"</p><dl>"+civitas.ui.cost_panel(this.params_data.cost)+civitas.ui.materials_panel(this.params_data.materials)+civitas.ui.production_panel(this.params_data.production,i)+civitas.ui.requires_panel(this.params_data.requires)+civitas.ui.chance_panel(this.params_data.chance,i)+civitas.ui.tax_panel(this.params_data.tax,i)+civitas.ui.storage_panel(this.params_data.storage,i)+"</dl>";$("#panel-"+this.id+" #tab-info").empty().append(s),s='<div class="section">'+civitas.ui.progress(100*e.get_research()/civitas.MAX_RESEARCH_VALUE,"large",e.get_research())+"</div>",$("#panel-"+this.id+" #tab-research").empty().append(s)}},civitas.WINDOW_OPTIONS={id:"options",template:'<section id="window-options" class="window"><div class="logo">Civitas</div><fieldset><div class="new-game"><p>'+civitas.l("Choose your city details well, climate changes and game difficulty affects your building options and resources.")+'</p><dl><dt class="clearfix">'+civitas.l("Your Name")+':</dt><dd><input type="text" class="name text-input" /></dd><dt class="clearfix">'+civitas.l("City Name")+':</dt><dd><input type="text" class="cityname text-input" /></dd><dt class="clearfix">'+civitas.l("Nationality")+':</dt><dd><select class="nation text-input"></select></dd><dt class="clearfix">'+civitas.l("Climate")+':</dt><dd><select class="climate text-input"></select></dd><dt class="clearfix">'+civitas.l("Difficulty")+':</dt><dd><select class="difficulty text-input"><option value="1">'+civitas.l("Easy")+'</option><option value="2">'+civitas.l("Medium")+'</option><option value="3">'+civitas.l("Hard")+'</option><option value="4">'+civitas.l("Hardcore")+'</option></select></dd><dt class="clearfix">'+civitas.l("Avatar")+':</dt><dd class="avatar-select-container"><div class="avatar-select"></div><div class="scrollbar"><div class="up"></div><div class="down"></div></div></dd></dl><a href="#" class="do-start highlight button">'+civitas.l("Start Playing")+'</a></div><a href="#" class="do-pause button">'+civitas.l("Pause")+'</a><a href="#" class="do-restart button">'+civitas.l("Restart")+'</a><a href="#" class="do-save button">'+civitas.l("Save / Load")+'</a><ul class="save-slots"><li data-id="1"><span class="date">'+civitas.l("empty save game")+'</span><span title="'+civitas.l("Delete this save game")+'" class="tips delete"></span><span title="'+civitas.l("Save your game here")+'" class="tips save"></span><span title="'+civitas.l("Load this save game")+'" class="tips load"></span></a><li data-id="2"><span class="date">'+civitas.l("empty save game")+'</span><span title="'+civitas.l("Delete this save game")+'" class="tips delete"></span><span title="'+civitas.l("Save your game here")+'" class="tips save"></span><span title="'+civitas.l("Load this save game")+'" class="tips load"></span></a><li data-id="3"><span class="date">'+civitas.l("empty save game")+'</span><span title="'+civitas.l("Delete this save game")+'" class="tips delete"></span><span title="'+civitas.l("Save your game here")+'" class="tips save"></span><span title="'+civitas.l("Load this save game")+'" class="tips load"></span></a></ul><a href="#" class="do-options button">'+civitas.l("Options")+'</a><div class="options-game"></div><a href="#" class="do-about button">'+civitas.l("About")+'</a><div class="about-game"><a class="github" href="https://github.com/sizeofcat/civitas"><img class="tips" title="'+civitas.l("Visit the project page on GitHub")+'" src="../images/ui/github.png" /></a><p>'+civitas.l('Civitas is written by <a href="https://sizeof.cat">sizeof(cat)</a>.')+"</p><p>"+civitas.l("Big thanks to")+':</p><ul><li><a href="https://soundcloud.com/shantifax">Shantifax</a> for the music (Glandula Pinealis).</li><li>Brendan Eich for Javascript.</li><li><a href="http://bluebyte.com">Blue Byte</a> for Anno 1404.</li></ul></div><br /><a href="#" class="do-resume button">'+civitas.l("Resume Playing")+"</a></fieldset></section>",on_show:function(){var e=this,t=1,i=this.get_core(),s="#window-"+this.id,a=i.get_storage_data();if(i.get_mode()!==civitas.MODE_SINGLEPLAYER)$(".do-save").hide();else{a!==!1?($(".new-game").hide(),$(".do-pause, .do-restart, .do-resume, .do-options, .save-slots > li span.save").show()):($(".new-game").show(),$(".do-pause, .do-restart, .do-resume, .do-options, .save-slots > li span.save").hide());for(var r=!1,n=1;n<=3;n++){var o;(o=i.get_storage_data("save"+n))?($(".save-slots > li[data-id="+n+"] > span.load").show(),$(".save-slots > li[data-id="+n+"] > span.date").html(civitas.utils.time_since(o.date)+" ago"),r=!0):$(".save-slots > li[data-id="+n+"] > span.load, .save-slots > li[data-id="+n+"] > span.delete").hide()}r===!1&&a===!1&&$(".do-save, .save-slots").hide()}for(var n=1;n<civitas.CLIMATES.length;n++)$(s+" .climate").append('<option value="'+civitas["CLIMATE_"+civitas.CLIMATES[n].toUpperCase()]+'">'+civitas.CLIMATES[n].capitalize()+"</option>");for(var n=1;n<civitas.NATIONS.length;n++)$(s+" .nation").append('<option value="'+civitas["NATION_"+civitas.NATIONS[n].toUpperCase()]+'">'+civitas.NATIONS[n].capitalize()+"</option>");for(var n=1;n<=civitas.AVATARS;n++)$(s+" .avatar-select").append('<img src="'+civitas.ASSETS_URL+"images/avatars/avatar"+n+'.png" />');$(s+" .options-game").append(civitas.ui.tabs([civitas.l("Sounds"),civitas.l("UI"),civitas.l("Gameplay")])),$(s+" #tab-sounds").append('<div><a href="#" class="music-control ui-control '+(this.core.get_settings("music")===!0?"on":"off")+'">'+civitas.l("toggle music")+'</a><input class="music-volume" type="range" min="0" max="1" step="0.1" '+(this.core.get_settings("music")!==!0?"disabled":"")+" /></div>"),$(s+" #tab-ui").append('<div><a href="#" class="console-control ui-control '+(this.core.get_settings("console")===!0?"on":"off")+'">'+civitas.l("toggle console")+"</a></div>"),$(s+" .tabs").tabs(),$(s).on("click",".do-start",function(){var a=$(s+" .name").val(),r=$(s+" .cityname").val(),n=parseInt($(s+" .nation").val()),o=parseInt($(s+" .climate").val()),c=parseInt($(s+" .difficulty").val());return""===a?(i.error("Enter your ruler name, for example <strong>Ramses</strong>.","Error",!0),!1):""===r?(i.error("Enter your city name, for example <strong>Alexandria</strong>.","Error",!0),!1):(i.show_loader(),i.start_game(a,r,n,o,t,c),e.destroy(),!1)}).on("click",".down",function(){t<civitas.AVATARS&&(t+=1),$(s+" .avatar-select").scrollTo("+=64px",500)}).on("click",".up",function(){t>1&&(t-=1),$(s+" .avatar-select").scrollTo("-=64px",500)}).on("click",".do-resume",function(){return i.hide_loader(),i.unpause(),e.destroy(),!1}).on("click",".do-pause",function(){return i.is_paused()===!0?($(this).removeClass("highlight").html(civitas.l("Pause")),i.show_loader(),i.unpause()):($(this).addClass("highlight").html(civitas.l("Unpause")),i.hide_loader(),i.pause()),!1}).on("click",".do-options",function(){return $(s+" .options-game").slideToggle(),!1}).on("click",".do-about",function(){return $(s+" .about-game").slideToggle(),!1}).on("click",".do-restart",function(){return confirm(civitas.l("Are you sure you want to restart the game? You wll lose all progress!"))===!0&&(i.reset_storage_data(),document.location.reload()),!1}).on("click",".do-save",function(){return i.get_mode()===civitas.MODE_SINGLEPLAYER&&$(s+" .save-slots").slideToggle(),!1}).on("click",".save-slots > li > .save",function(){if(i.get_mode()===civitas.MODE_SINGLEPLAYER){var e=$(this).parent(),t=parseInt(e.data("id"));if(t>=1&&t<=3&&confirm(civitas.l("Are you sure you want to save the game in this slot? An already existing save will be overwritten!"))===!0){var s=i.export(!0,t);e.children("span.load, span.delete").show(),e.children("span.date").html(civitas.utils.time_since(s.date)+" ago")}}return!1}).on("click",".save-slots > li > .delete",function(){if(i.get_mode()===civitas.MODE_SINGLEPLAYER){var e=$(this).parent(),t=parseInt(e.data("id"));t>=1&&t<=3&&confirm(civitas.l("Are you sure you want to delete the save game from this slot? All data from that game will be lost!"))===!0&&(i.reset_storage_data("save"+t),e.children("span.load, span.delete").hide(),e.children("span.date").html(civitas.l("empty save game")),e.children("span.save").show())}return!1}).on("click",".save-slots > li > .load",function(){if(i.get_mode()===civitas.MODE_SINGLEPLAYER){var e=$(this).parent(),t=parseInt(e.data("id"));t>=1&&t<=3&&confirm(civitas.l("Are you sure you want to load the game from this slot? An already existing game will be lost!"))===!0&&(i.swap_storage_data("save"+t,"live")!==!1?document.location.reload():(i.error("There was a problem loading the game data, it is probably corrupted. Save game data will be deleted now."),i.reset_storage_data("save"+t),e.children("span.load, span.delete").hide(),e.children("span.date").html(civitas.l("empty save game")),e.children("span.save").show()))}return!1}).on("click",".music-control",function(){return $(this).hasClass("on")?($(this).removeClass("on").addClass("off"),$(".music-volume").attr("disabled",!0),i.set_settings_music(!0)):($(this).removeClass("off").addClass("on"),$(".music-volume").attr("disabled",!1),i.set_settings_music(!1)),!1}).on("click",".console-control",function(){return $(this).hasClass("on")?($(this).removeClass("on").addClass("off"),i.set_settings_console(!1)):($(this).removeClass("off").addClass("on"),i.set_settings_console(!0)),!1}).on("change",".music-volume",function(){var e=$(this).val();return i.music.volume=e,!1})},on_hide:function(){this.get_core().hide_loader()}};